<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!-- git web interface version 1.4.5-rc0.GIT-dirty, (C) 2005-2006, Kay Sievers <kay.sievers@vrfy.org>, Christian Gierke -->
<!-- git core binaries version 1.6.1.1 -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="generator" content="gitweb/1.4.5-rc0.GIT-dirty git/1.6.1.1"/>
<meta name="robots" content="index, nofollow"/>
<title>git.kernel.org - boot/syslinux/syslinux.git/blob - core/isolinux.asm</title>
<link rel="stylesheet" type="text/css" href="gitweb.css"/>
<link rel="alternate" title="boot/syslinux/syslinux.gitlog RSS feed" href="/?p=boot/syslinux/syslinux.git;a=rss" type="application/rss+xml" />
<link rel="alternate" title="boot/syslinux/syslinux.gitlog Atom feed" href="/?p=boot/syslinux/syslinux.git;a=atom" type="application/atom+xml" />
<link rel="shortcut icon" href="git-favicon.png" type="image/png"/>
</head>
<body>
<div class="page_header">
<a title="git homepage" href="http://git.or.cz/"><img src="git-logo.png" width="72" height="27" alt="git" class="logo"/></a><a href="/">/pub/scm</a> / <a href="/?p=boot/syslinux/syslinux.git;a=summary">boot/syslinux/syslinux.git</a> / blob
<form method="get" action="/" enctype="application/x-www-form-urlencoded">
<div class="search">
<input type="hidden" name="p" value="boot/syslinux/syslinux.git"  />
<input type="hidden" name="a" value="search"  />
<input type="hidden" name="h" value="HEAD"  />
<select name="st" >
<option selected="selected" value="commit">commit</option>
<option value="author">author</option>
<option value="committer">committer</option>
<option value="pickaxe">pickaxe</option>
</select><sup><a href="/?p=boot/syslinux/syslinux.git;a=search_help">?</a></sup> search:
<input type="text" name="s"  />
</div>
</form>
</div>
<div class="page_nav">
<a href="/?p=boot/syslinux/syslinux.git;a=summary">summary</a> | <a href="/?p=boot/syslinux/syslinux.git;a=shortlog">shortlog</a> | <a href="/?p=boot/syslinux/syslinux.git;a=log">log</a> | <a href="/?p=boot/syslinux/syslinux.git;a=commit;h=HEAD">commit</a> | <a href="/?p=boot/syslinux/syslinux.git;a=commitdiff;h=HEAD">commitdiff</a> | <a href="/?p=boot/syslinux/syslinux.git;a=tree;h=b106d1fc14c146652ece9df7023c7fe3726a5cba;hb=HEAD">tree</a><br/>
<a href="/?p=boot/syslinux/syslinux.git;a=history;f=core/isolinux.asm;h=b85ecd36d82011809dc98bf5269324ee581286c1;hb=HEAD">history</a> | <a href="/?p=boot/syslinux/syslinux.git;a=blob_plain;f=core/isolinux.asm;h=b85ecd36d82011809dc98bf5269324ee581286c1">raw</a> | <a href="/?p=boot/syslinux/syslinux.git;a=blob;f=core/isolinux.asm;hb=HEAD">HEAD</a><br/>
</div>
<div class="header">
<a class="title" href="/?p=boot/syslinux/syslinux.git;a=commit;h=HEAD">Don&#39;t set the autocr flag on the serial console; clean up crap</a>
</div>
<div class="page_path"><a title="tree root" href="/?p=boot/syslinux/syslinux.git;a=tree;hb=HEAD">[boot/syslinux/syslinux.git]</a> / <a title="core" href="/?p=boot/syslinux/syslinux.git;a=tree;f=core;hb=HEAD">core</a> / <a title="core/isolinux.asm" href="/?p=boot/syslinux/syslinux.git;a=blob_plain;f=core/isolinux.asm;hb=HEAD">isolinux.asm</a><br/></div>
<div class="page_body">
<div class="pre"><a id="l1" href="#l1" class="linenr">   1</a> ;&nbsp;-*-&nbsp;fundamental&nbsp;-*-&nbsp;(asm-mode&nbsp;sucks)</div>
<div class="pre"><a id="l2" href="#l2" class="linenr">   2</a> ;&nbsp;****************************************************************************</div>
<div class="pre"><a id="l3" href="#l3" class="linenr">   3</a> ;</div>
<div class="pre"><a id="l4" href="#l4" class="linenr">   4</a> ;&nbsp;&nbsp;isolinux.asm</div>
<div class="pre"><a id="l5" href="#l5" class="linenr">   5</a> ;</div>
<div class="pre"><a id="l6" href="#l6" class="linenr">   6</a> ;&nbsp;&nbsp;A&nbsp;program&nbsp;to&nbsp;boot&nbsp;Linux&nbsp;kernels&nbsp;off&nbsp;a&nbsp;CD-ROM&nbsp;using&nbsp;the&nbsp;El&nbsp;Torito</div>
<div class="pre"><a id="l7" href="#l7" class="linenr">   7</a> ;&nbsp;&nbsp;boot&nbsp;standard&nbsp;in&nbsp;&quot;no&nbsp;emulation&quot;&nbsp;mode,&nbsp;making&nbsp;the&nbsp;entire&nbsp;filesystem</div>
<div class="pre"><a id="l8" href="#l8" class="linenr">   8</a> ;&nbsp;&nbsp;available.&nbsp;&nbsp;It&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;SYSLINUX&nbsp;boot&nbsp;loader&nbsp;for&nbsp;MS-DOS</div>
<div class="pre"><a id="l9" href="#l9" class="linenr">   9</a> ;&nbsp;&nbsp;floppies.</div>
<div class="pre"><a id="l10" href="#l10" class="linenr">  10</a> ;</div>
<div class="pre"><a id="l11" href="#l11" class="linenr">  11</a> ;&nbsp;&nbsp;&nbsp;Copyright&nbsp;1994-2009&nbsp;H.&nbsp;Peter&nbsp;Anvin&nbsp;-&nbsp;All&nbsp;Rights&nbsp;Reserved</div>
<div class="pre"><a id="l12" href="#l12" class="linenr">  12</a> ;&nbsp;&nbsp;&nbsp;Copyright&nbsp;2009&nbsp;Intel&nbsp;Corporation;&nbsp;author:&nbsp;H.&nbsp;Peter&nbsp;Anvin</div>
<div class="pre"><a id="l13" href="#l13" class="linenr">  13</a> ;</div>
<div class="pre"><a id="l14" href="#l14" class="linenr">  14</a> ;&nbsp;&nbsp;This&nbsp;program&nbsp;is&nbsp;free&nbsp;software;&nbsp;you&nbsp;can&nbsp;redistribute&nbsp;it&nbsp;and/or&nbsp;modify</div>
<div class="pre"><a id="l15" href="#l15" class="linenr">  15</a> ;&nbsp;&nbsp;it&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;as&nbsp;published&nbsp;by</div>
<div class="pre"><a id="l16" href="#l16" class="linenr">  16</a> ;&nbsp;&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation,&nbsp;Inc.,&nbsp;53&nbsp;Temple&nbsp;Place&nbsp;Ste&nbsp;330,</div>
<div class="pre"><a id="l17" href="#l17" class="linenr">  17</a> ;&nbsp;&nbsp;Boston&nbsp;MA&nbsp;02111-1307,&nbsp;USA;&nbsp;either&nbsp;version&nbsp;2&nbsp;of&nbsp;the&nbsp;License,&nbsp;or</div>
<div class="pre"><a id="l18" href="#l18" class="linenr">  18</a> ;&nbsp;&nbsp;(at&nbsp;your&nbsp;option)&nbsp;any&nbsp;later&nbsp;version;&nbsp;incorporated&nbsp;herein&nbsp;by&nbsp;reference.</div>
<div class="pre"><a id="l19" href="#l19" class="linenr">  19</a> ;</div>
<div class="pre"><a id="l20" href="#l20" class="linenr">  20</a> ;&nbsp;****************************************************************************</div>
<div class="pre"><a id="l21" href="#l21" class="linenr">  21</a> </div>
<div class="pre"><a id="l22" href="#l22" class="linenr">  22</a> %define&nbsp;IS_ISOLINUX&nbsp;1</div>
<div class="pre"><a id="l23" href="#l23" class="linenr">  23</a> %include&nbsp;&quot;head.inc&quot;</div>
<div class="pre"><a id="l24" href="#l24" class="linenr">  24</a> </div>
<div class="pre"><a id="l25" href="#l25" class="linenr">  25</a> ;</div>
<div class="pre"><a id="l26" href="#l26" class="linenr">  26</a> ;&nbsp;Some&nbsp;semi-configurable&nbsp;constants...&nbsp;change&nbsp;on&nbsp;your&nbsp;own&nbsp;risk.</div>
<div class="pre"><a id="l27" href="#l27" class="linenr">  27</a> ;</div>
<div class="pre"><a id="l28" href="#l28" class="linenr">  28</a> my_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;isolinux_id</div>
<div class="pre"><a id="l29" href="#l29" class="linenr">  29</a> FILENAME_MAX_LG2&nbsp;equ&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;log2(Max&nbsp;filename&nbsp;size&nbsp;Including&nbsp;final&nbsp;null)</div>
<div class="pre"><a id="l30" href="#l30" class="linenr">  30</a> FILENAME_MAX&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;(1&nbsp;&lt;&lt;&nbsp;FILENAME_MAX_LG2)</div>
<div class="pre"><a id="l31" href="#l31" class="linenr">  31</a> NULLFILE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Zero&nbsp;byte&nbsp;==&nbsp;null&nbsp;file&nbsp;name</div>
<div class="pre"><a id="l32" href="#l32" class="linenr">  32</a> NULLOFFSET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Position&nbsp;in&nbsp;which&nbsp;to&nbsp;look</div>
<div class="pre"><a id="l33" href="#l33" class="linenr">  33</a> retry_count&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;How&nbsp;patient&nbsp;are&nbsp;we&nbsp;with&nbsp;the&nbsp;BIOS?</div>
<div class="pre"><a id="l34" href="#l34" class="linenr">  34</a> %assign&nbsp;HIGHMEM_SLOP&nbsp;128*1024&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Avoid&nbsp;this&nbsp;much&nbsp;memory&nbsp;near&nbsp;the&nbsp;top</div>
<div class="pre"><a id="l35" href="#l35" class="linenr">  35</a> MAX_OPEN_LG2&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;log2(Max&nbsp;number&nbsp;of&nbsp;open&nbsp;files)</div>
<div class="pre"><a id="l36" href="#l36" class="linenr">  36</a> MAX_OPEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;(1&nbsp;&lt;&lt;&nbsp;MAX_OPEN_LG2)</div>
<div class="pre"><a id="l37" href="#l37" class="linenr">  37</a> SECTOR_SHIFT&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;2048&nbsp;bytes/sector&nbsp;(El&nbsp;Torito&nbsp;requirement)</div>
<div class="pre"><a id="l38" href="#l38" class="linenr">  38</a> SECTOR_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;(1&nbsp;&lt;&lt;&nbsp;SECTOR_SHIFT)</div>
<div class="pre"><a id="l39" href="#l39" class="linenr">  39</a> </div>
<div class="pre"><a id="l40" href="#l40" class="linenr">  40</a> ROOT_DIR_WORD&nbsp;&nbsp;&nbsp;equ&nbsp;0x002F</div>
<div class="pre"><a id="l41" href="#l41" class="linenr">  41</a> </div>
<div class="pre"><a id="l42" href="#l42" class="linenr">  42</a> ;</div>
<div class="pre"><a id="l43" href="#l43" class="linenr">  43</a> ;&nbsp;The&nbsp;following&nbsp;structure&nbsp;is&nbsp;used&nbsp;for&nbsp;&quot;virtual&nbsp;kernels&quot;;&nbsp;i.e.&nbsp;LILO-style</div>
<div class="pre"><a id="l44" href="#l44" class="linenr">  44</a> ;&nbsp;option&nbsp;labels.&nbsp;&nbsp;The&nbsp;options&nbsp;we&nbsp;permit&nbsp;here&nbsp;are&nbsp;`kernel&#39;&nbsp;and&nbsp;`append</div>
<div class="pre"><a id="l45" href="#l45" class="linenr">  45</a> ;&nbsp;Since&nbsp;there&nbsp;is&nbsp;no&nbsp;room&nbsp;in&nbsp;the&nbsp;bottom&nbsp;64K&nbsp;for&nbsp;all&nbsp;of&nbsp;these,&nbsp;we</div>
<div class="pre"><a id="l46" href="#l46" class="linenr">  46</a> ;&nbsp;stick&nbsp;them&nbsp;in&nbsp;high&nbsp;memory&nbsp;and&nbsp;copy&nbsp;them&nbsp;down&nbsp;before&nbsp;we&nbsp;need&nbsp;them.</div>
<div class="pre"><a id="l47" href="#l47" class="linenr">  47</a> ;</div>
<div class="pre"><a id="l48" href="#l48" class="linenr">  48</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struc&nbsp;vkernel</div>
<div class="pre"><a id="l49" href="#l49" class="linenr">  49</a> vk_vname:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;FILENAME_MAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Virtual&nbsp;name&nbsp;**MUST&nbsp;BE&nbsp;FIRST!**</div>
<div class="pre"><a id="l50" href="#l50" class="linenr">  50</a> vk_rname:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;FILENAME_MAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Real&nbsp;name</div>
<div class="pre"><a id="l51" href="#l51" class="linenr">  51</a> vk_appendlen:&nbsp;&nbsp;&nbsp;resw&nbsp;1</div>
<div class="pre"><a id="l52" href="#l52" class="linenr">  52</a> vk_type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Type&nbsp;of&nbsp;file</div>
<div class="pre"><a id="l53" href="#l53" class="linenr">  53</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;4</div>
<div class="pre"><a id="l54" href="#l54" class="linenr">  54</a> vk_append:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;max_cmd_len+1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Command&nbsp;line</div>
<div class="pre"><a id="l55" href="#l55" class="linenr">  55</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;4</div>
<div class="pre"><a id="l56" href="#l56" class="linenr">  56</a> vk_end:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Should&nbsp;be&nbsp;&lt;=&nbsp;vk_size</div>
<div class="pre"><a id="l57" href="#l57" class="linenr">  57</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endstruc</div>
<div class="pre"><a id="l58" href="#l58" class="linenr">  58</a> </div>
<div class="pre"><a id="l59" href="#l59" class="linenr">  59</a> ;</div>
<div class="pre"><a id="l60" href="#l60" class="linenr">  60</a> ;&nbsp;File&nbsp;structure.&nbsp;&nbsp;This&nbsp;holds&nbsp;the&nbsp;information&nbsp;for&nbsp;each&nbsp;currently&nbsp;open&nbsp;file.</div>
<div class="pre"><a id="l61" href="#l61" class="linenr">  61</a> ;</div>
<div class="pre"><a id="l62" href="#l62" class="linenr">  62</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struc&nbsp;open_file_t</div>
<div class="pre"><a id="l63" href="#l63" class="linenr">  63</a> file_sector&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sector&nbsp;pointer&nbsp;(0&nbsp;=&nbsp;structure&nbsp;free)</div>
<div class="pre"><a id="l64" href="#l64" class="linenr">  64</a> file_bytesleft&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Number&nbsp;of&nbsp;bytes&nbsp;left</div>
<div class="pre"><a id="l65" href="#l65" class="linenr">  65</a> file_left&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Number&nbsp;of&nbsp;sectors&nbsp;left</div>
<div class="pre"><a id="l66" href="#l66" class="linenr">  66</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Unused</div>
<div class="pre"><a id="l67" href="#l67" class="linenr">  67</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endstruc</div>
<div class="pre"><a id="l68" href="#l68" class="linenr">  68</a> </div>
<div class="pre"><a id="l69" href="#l69" class="linenr">  69</a> %ifndef&nbsp;DEPEND</div>
<div class="pre"><a id="l70" href="#l70" class="linenr">  70</a> %if&nbsp;(open_file_t_size&nbsp;&amp;&nbsp;(open_file_t_size-1))</div>
<div class="pre"><a id="l71" href="#l71" class="linenr">  71</a> %error&nbsp;&quot;open_file_t&nbsp;is&nbsp;not&nbsp;a&nbsp;power&nbsp;of&nbsp;2&quot;</div>
<div class="pre"><a id="l72" href="#l72" class="linenr">  72</a> %endif</div>
<div class="pre"><a id="l73" href="#l73" class="linenr">  73</a> %endif</div>
<div class="pre"><a id="l74" href="#l74" class="linenr">  74</a> </div>
<div class="pre"><a id="l75" href="#l75" class="linenr">  75</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struc&nbsp;dir_t</div>
<div class="pre"><a id="l76" href="#l76" class="linenr">  76</a> dir_lba&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Directory&nbsp;start&nbsp;(LBA)</div>
<div class="pre"><a id="l77" href="#l77" class="linenr">  77</a> dir_len&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Length&nbsp;in&nbsp;bytes</div>
<div class="pre"><a id="l78" href="#l78" class="linenr">  78</a> dir_clust&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Length&nbsp;in&nbsp;clusters</div>
<div class="pre"><a id="l79" href="#l79" class="linenr">  79</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endstruc</div>
<div class="pre"><a id="l80" href="#l80" class="linenr">  80</a> </div>
<div class="pre"><a id="l81" href="#l81" class="linenr">  81</a> ;&nbsp;---------------------------------------------------------------------------</div>
<div class="pre"><a id="l82" href="#l82" class="linenr">  82</a> ;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;CODE</div>
<div class="pre"><a id="l83" href="#l83" class="linenr">  83</a> ;&nbsp;---------------------------------------------------------------------------</div>
<div class="pre"><a id="l84" href="#l84" class="linenr">  84</a> </div>
<div class="pre"><a id="l85" href="#l85" class="linenr">  85</a> ;</div>
<div class="pre"><a id="l86" href="#l86" class="linenr">  86</a> ;&nbsp;Memory&nbsp;below&nbsp;this&nbsp;point&nbsp;is&nbsp;reserved&nbsp;for&nbsp;the&nbsp;BIOS&nbsp;and&nbsp;the&nbsp;MBR</div>
<div class="pre"><a id="l87" href="#l87" class="linenr">  87</a> ;</div>
<div class="pre"><a id="l88" href="#l88" class="linenr">  88</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;section&nbsp;.earlybss</div>
<div class="pre"><a id="l89" href="#l89" class="linenr">  89</a> trackbufsize&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;8192</div>
<div class="pre"><a id="l90" href="#l90" class="linenr">  90</a> trackbuf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;trackbufsize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Track&nbsp;buffer&nbsp;goes&nbsp;here</div>
<div class="pre"><a id="l91" href="#l91" class="linenr">  91</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ends&nbsp;at&nbsp;2800h</div>
<div class="pre"><a id="l92" href="#l92" class="linenr">  92</a> </div>
<div class="pre"><a id="l93" href="#l93" class="linenr">  93</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Some&nbsp;of&nbsp;these&nbsp;are&nbsp;touched&nbsp;before&nbsp;the&nbsp;whole&nbsp;image</div>
<div class="pre"><a id="l94" href="#l94" class="linenr">  94</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;is&nbsp;loaded.&nbsp;&nbsp;DO&nbsp;NOT&nbsp;move&nbsp;this&nbsp;to&nbsp;.uibss.</div>
<div class="pre"><a id="l95" href="#l95" class="linenr">  95</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;section&nbsp;.bss2</div>
<div class="pre"><a id="l96" href="#l96" class="linenr">  96</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;4</div>
<div class="pre"><a id="l97" href="#l97" class="linenr">  97</a> ISOFileName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ISO&nbsp;filename&nbsp;canonicalization&nbsp;buffer</div>
<div class="pre"><a id="l98" href="#l98" class="linenr">  98</a> ISOFileNameEnd&nbsp;&nbsp;equ&nbsp;$</div>
<div class="pre"><a id="l99" href="#l99" class="linenr">  99</a> CurrentDir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;dir_t_size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Current&nbsp;directory</div>
<div class="pre"><a id="l100" href="#l100" class="linenr"> 100</a> RootDir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;dir_t_size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Root&nbsp;directory</div>
<div class="pre"><a id="l101" href="#l101" class="linenr"> 101</a> FirstSecSum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Checksum&nbsp;of&nbsp;bytes&nbsp;64-2048</div>
<div class="pre"><a id="l102" href="#l102" class="linenr"> 102</a> ImageDwords&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;isolinux.bin&nbsp;size,&nbsp;dwords</div>
<div class="pre"><a id="l103" href="#l103" class="linenr"> 103</a> InitStack&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Initial&nbsp;stack&nbsp;pointer&nbsp;(SS:SP)</div>
<div class="pre"><a id="l104" href="#l104" class="linenr"> 104</a> DiskSys&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Last&nbsp;INT&nbsp;13h&nbsp;call</div>
<div class="pre"><a id="l105" href="#l105" class="linenr"> 105</a> ImageSectors&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;isolinux.bin&nbsp;size,&nbsp;sectors</div>
<div class="pre"><a id="l106" href="#l106" class="linenr"> 106</a> ;&nbsp;These&nbsp;following&nbsp;two&nbsp;are&nbsp;accessed&nbsp;as&nbsp;a&nbsp;single&nbsp;dword...</div>
<div class="pre"><a id="l107" href="#l107" class="linenr"> 107</a> GetlinsecPtr&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;The&nbsp;sector-read&nbsp;pointer</div>
<div class="pre"><a id="l108" href="#l108" class="linenr"> 108</a> BIOSName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Display&nbsp;string&nbsp;for&nbsp;BIOS&nbsp;type</div>
<div class="pre"><a id="l109" href="#l109" class="linenr"> 109</a> %define&nbsp;HAVE_BIOSNAME&nbsp;1</div>
<div class="pre"><a id="l110" href="#l110" class="linenr"> 110</a> BIOSType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1</div>
<div class="pre"><a id="l111" href="#l111" class="linenr"> 111</a> DiskError&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Error&nbsp;code&nbsp;for&nbsp;disk&nbsp;I/O</div>
<div class="pre"><a id="l112" href="#l112" class="linenr"> 112</a> DriveNumber&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;CD-ROM&nbsp;BIOS&nbsp;drive&nbsp;number</div>
<div class="pre"><a id="l113" href="#l113" class="linenr"> 113</a> ISOFlags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Flags&nbsp;for&nbsp;ISO&nbsp;directory&nbsp;search</div>
<div class="pre"><a id="l114" href="#l114" class="linenr"> 114</a> RetryCount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Used&nbsp;for&nbsp;disk&nbsp;access&nbsp;retries</div>
<div class="pre"><a id="l115" href="#l115" class="linenr"> 115</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;8</div>
<div class="pre"><a id="l116" href="#l116" class="linenr"> 116</a> bsHidden&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resq&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Used&nbsp;in&nbsp;hybrid&nbsp;mode</div>
<div class="pre"><a id="l117" href="#l117" class="linenr"> 117</a> bsSecPerTrack&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Used&nbsp;in&nbsp;hybrid&nbsp;mode</div>
<div class="pre"><a id="l118" href="#l118" class="linenr"> 118</a> bsHeads&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Used&nbsp;in&nbsp;hybrid&nbsp;mode</div>
<div class="pre"><a id="l119" href="#l119" class="linenr"> 119</a> </div>
<div class="pre"><a id="l120" href="#l120" class="linenr"> 120</a> _spec_start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;$</div>
<div class="pre"><a id="l121" href="#l121" class="linenr"> 121</a> </div>
<div class="pre"><a id="l122" href="#l122" class="linenr"> 122</a> ;</div>
<div class="pre"><a id="l123" href="#l123" class="linenr"> 123</a> ;&nbsp;El&nbsp;Torito&nbsp;spec&nbsp;packet</div>
<div class="pre"><a id="l124" href="#l124" class="linenr"> 124</a> ;</div>
<div class="pre"><a id="l125" href="#l125" class="linenr"> 125</a> </div>
<div class="pre"><a id="l126" href="#l126" class="linenr"> 126</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;8</div>
<div class="pre"><a id="l127" href="#l127" class="linenr"> 127</a> spec_packet:&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Size&nbsp;of&nbsp;packet</div>
<div class="pre"><a id="l128" href="#l128" class="linenr"> 128</a> sp_media:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Media&nbsp;type</div>
<div class="pre"><a id="l129" href="#l129" class="linenr"> 129</a> sp_drive:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Drive&nbsp;number</div>
<div class="pre"><a id="l130" href="#l130" class="linenr"> 130</a> sp_controller:&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Controller&nbsp;index</div>
<div class="pre"><a id="l131" href="#l131" class="linenr"> 131</a> sp_lba:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;LBA&nbsp;for&nbsp;emulated&nbsp;disk&nbsp;image</div>
<div class="pre"><a id="l132" href="#l132" class="linenr"> 132</a> sp_devspec:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;IDE/SCSI&nbsp;information</div>
<div class="pre"><a id="l133" href="#l133" class="linenr"> 133</a> sp_buffer:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;User-provided&nbsp;buffer</div>
<div class="pre"><a id="l134" href="#l134" class="linenr"> 134</a> sp_loadseg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load&nbsp;segment</div>
<div class="pre"><a id="l135" href="#l135" class="linenr"> 135</a> sp_sectors:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sector&nbsp;count</div>
<div class="pre"><a id="l136" href="#l136" class="linenr"> 136</a> sp_chs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Simulated&nbsp;CHS&nbsp;geometry</div>
<div class="pre"><a id="l137" href="#l137" class="linenr"> 137</a> sp_dummy:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Scratch,&nbsp;safe&nbsp;to&nbsp;overwrite</div>
<div class="pre"><a id="l138" href="#l138" class="linenr"> 138</a> </div>
<div class="pre"><a id="l139" href="#l139" class="linenr"> 139</a> ;</div>
<div class="pre"><a id="l140" href="#l140" class="linenr"> 140</a> ;&nbsp;EBIOS&nbsp;drive&nbsp;parameter&nbsp;packet</div>
<div class="pre"><a id="l141" href="#l141" class="linenr"> 141</a> ;</div>
<div class="pre"><a id="l142" href="#l142" class="linenr"> 142</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;8</div>
<div class="pre"><a id="l143" href="#l143" class="linenr"> 143</a> drive_params:&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Buffer&nbsp;size</div>
<div class="pre"><a id="l144" href="#l144" class="linenr"> 144</a> dp_flags:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Information&nbsp;flags</div>
<div class="pre"><a id="l145" href="#l145" class="linenr"> 145</a> dp_cyl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Physical&nbsp;cylinders</div>
<div class="pre"><a id="l146" href="#l146" class="linenr"> 146</a> dp_head:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Physical&nbsp;heads</div>
<div class="pre"><a id="l147" href="#l147" class="linenr"> 147</a> dp_sec:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Physical&nbsp;sectors/track</div>
<div class="pre"><a id="l148" href="#l148" class="linenr"> 148</a> dp_totalsec:&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Total&nbsp;sectors</div>
<div class="pre"><a id="l149" href="#l149" class="linenr"> 149</a> dp_secsize:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Bytes&nbsp;per&nbsp;sector</div>
<div class="pre"><a id="l150" href="#l150" class="linenr"> 150</a> dp_dpte:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Device&nbsp;Parameter&nbsp;Table</div>
<div class="pre"><a id="l151" href="#l151" class="linenr"> 151</a> dp_dpi_key:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;0BEDDh&nbsp;if&nbsp;rest&nbsp;valid</div>
<div class="pre"><a id="l152" href="#l152" class="linenr"> 152</a> dp_dpi_len:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;DPI&nbsp;len</div>
<div class="pre"><a id="l153" href="#l153" class="linenr"> 153</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1</div>
<div class="pre"><a id="l154" href="#l154" class="linenr"> 154</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1</div>
<div class="pre"><a id="l155" href="#l155" class="linenr"> 155</a> dp_bus:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Host&nbsp;bus&nbsp;type</div>
<div class="pre"><a id="l156" href="#l156" class="linenr"> 156</a> dp_interface:&nbsp;&nbsp;&nbsp;resb&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Interface&nbsp;type</div>
<div class="pre"><a id="l157" href="#l157" class="linenr"> 157</a> db_i_path:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Interface&nbsp;path</div>
<div class="pre"><a id="l158" href="#l158" class="linenr"> 158</a> db_d_path:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Device&nbsp;path</div>
<div class="pre"><a id="l159" href="#l159" class="linenr"> 159</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1</div>
<div class="pre"><a id="l160" href="#l160" class="linenr"> 160</a> db_dpi_csum:&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Checksum&nbsp;for&nbsp;DPI&nbsp;info</div>
<div class="pre"><a id="l161" href="#l161" class="linenr"> 161</a> </div>
<div class="pre"><a id="l162" href="#l162" class="linenr"> 162</a> ;</div>
<div class="pre"><a id="l163" href="#l163" class="linenr"> 163</a> ;&nbsp;EBIOS&nbsp;disk&nbsp;address&nbsp;packet</div>
<div class="pre"><a id="l164" href="#l164" class="linenr"> 164</a> ;</div>
<div class="pre"><a id="l165" href="#l165" class="linenr"> 165</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;8</div>
<div class="pre"><a id="l166" href="#l166" class="linenr"> 166</a> dapa:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Packet&nbsp;size</div>
<div class="pre"><a id="l167" href="#l167" class="linenr"> 167</a> .count:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Block&nbsp;count</div>
<div class="pre"><a id="l168" href="#l168" class="linenr"> 168</a> .off:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Offset&nbsp;of&nbsp;buffer</div>
<div class="pre"><a id="l169" href="#l169" class="linenr"> 169</a> .seg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Segment&nbsp;of&nbsp;buffer</div>
<div class="pre"><a id="l170" href="#l170" class="linenr"> 170</a> .lba:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;LBA&nbsp;(LSW,&nbsp;MSW)</div>
<div class="pre"><a id="l171" href="#l171" class="linenr"> 171</a> </div>
<div class="pre"><a id="l172" href="#l172" class="linenr"> 172</a> ;</div>
<div class="pre"><a id="l173" href="#l173" class="linenr"> 173</a> ;&nbsp;Spec&nbsp;packet&nbsp;for&nbsp;disk&nbsp;image&nbsp;emulation</div>
<div class="pre"><a id="l174" href="#l174" class="linenr"> 174</a> ;</div>
<div class="pre"><a id="l175" href="#l175" class="linenr"> 175</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;8</div>
<div class="pre"><a id="l176" href="#l176" class="linenr"> 176</a> dspec_packet:&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Size&nbsp;of&nbsp;packet</div>
<div class="pre"><a id="l177" href="#l177" class="linenr"> 177</a> dsp_media:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Media&nbsp;type</div>
<div class="pre"><a id="l178" href="#l178" class="linenr"> 178</a> dsp_drive:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Drive&nbsp;number</div>
<div class="pre"><a id="l179" href="#l179" class="linenr"> 179</a> dsp_controller:&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Controller&nbsp;index</div>
<div class="pre"><a id="l180" href="#l180" class="linenr"> 180</a> dsp_lba:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resd&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;LBA&nbsp;for&nbsp;emulated&nbsp;disk&nbsp;image</div>
<div class="pre"><a id="l181" href="#l181" class="linenr"> 181</a> dsp_devspec:&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;IDE/SCSI&nbsp;information</div>
<div class="pre"><a id="l182" href="#l182" class="linenr"> 182</a> dsp_buffer:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;User-provided&nbsp;buffer</div>
<div class="pre"><a id="l183" href="#l183" class="linenr"> 183</a> dsp_loadseg:&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load&nbsp;segment</div>
<div class="pre"><a id="l184" href="#l184" class="linenr"> 184</a> dsp_sectors:&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sector&nbsp;count</div>
<div class="pre"><a id="l185" href="#l185" class="linenr"> 185</a> dsp_chs:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Simulated&nbsp;CHS&nbsp;geometry</div>
<div class="pre"><a id="l186" href="#l186" class="linenr"> 186</a> dsp_dummy:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Scratch,&nbsp;safe&nbsp;to&nbsp;overwrite</div>
<div class="pre"><a id="l187" href="#l187" class="linenr"> 187</a> </div>
<div class="pre"><a id="l188" href="#l188" class="linenr"> 188</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;4</div>
<div class="pre"><a id="l189" href="#l189" class="linenr"> 189</a> _spec_end&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;$</div>
<div class="pre"><a id="l190" href="#l190" class="linenr"> 190</a> _spec_len&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;_spec_end&nbsp;-&nbsp;_spec_start</div>
<div class="pre"><a id="l191" href="#l191" class="linenr"> 191</a> </div>
<div class="pre"><a id="l192" href="#l192" class="linenr"> 192</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignb&nbsp;open_file_t_size</div>
<div class="pre"><a id="l193" href="#l193" class="linenr"> 193</a> Files&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resb&nbsp;MAX_OPEN*open_file_t_size</div>
<div class="pre"><a id="l194" href="#l194" class="linenr"> 194</a> </div>
<div class="pre"><a id="l195" href="#l195" class="linenr"> 195</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;section&nbsp;.text</div>
<div class="pre"><a id="l196" href="#l196" class="linenr"> 196</a> ;;</div>
<div class="pre"><a id="l197" href="#l197" class="linenr"> 197</a> ;;&nbsp;Primary&nbsp;entry&nbsp;point.&nbsp;&nbsp;Because&nbsp;BIOSes&nbsp;are&nbsp;buggy,&nbsp;we&nbsp;only&nbsp;load&nbsp;the&nbsp;first</div>
<div class="pre"><a id="l198" href="#l198" class="linenr"> 198</a> ;;&nbsp;CD-ROM&nbsp;sector&nbsp;(2K)&nbsp;of&nbsp;the&nbsp;file,&nbsp;so&nbsp;the&nbsp;number&nbsp;one&nbsp;priority&nbsp;is&nbsp;actually</div>
<div class="pre"><a id="l199" href="#l199" class="linenr"> 199</a> ;;&nbsp;loading&nbsp;the&nbsp;rest.</div>
<div class="pre"><a id="l200" href="#l200" class="linenr"> 200</a> ;;</div>
<div class="pre"><a id="l201" href="#l201" class="linenr"> 201</a> StackBuf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;$-44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;44&nbsp;bytes&nbsp;needed&nbsp;for</div>
<div class="pre"><a id="l202" href="#l202" class="linenr"> 202</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;the&nbsp;bootsector&nbsp;chainloading</div>
<div class="pre"><a id="l203" href="#l203" class="linenr"> 203</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;code!</div>
<div class="pre"><a id="l204" href="#l204" class="linenr"> 204</a> OrigESDI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;StackBuf-4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;The&nbsp;high&nbsp;dword&nbsp;on&nbsp;the&nbsp;stack</div>
<div class="pre"><a id="l205" href="#l205" class="linenr"> 205</a> </div>
<div class="pre"><a id="l206" href="#l206" class="linenr"> 206</a> bootsec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;$</div>
<div class="pre"><a id="l207" href="#l207" class="linenr"> 207</a> </div>
<div class="pre"><a id="l208" href="#l208" class="linenr"> 208</a> _start:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Far&nbsp;jump&nbsp;makes&nbsp;sure&nbsp;we&nbsp;canonicalize&nbsp;the&nbsp;address</div>
<div class="pre"><a id="l209" href="#l209" class="linenr"> 209</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cli</div>
<div class="pre"><a id="l210" href="#l210" class="linenr"> 210</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;0:_start1</div>
<div class="pre"><a id="l211" href="#l211" class="linenr"> 211</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;8-($-$$)&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Pad&nbsp;to&nbsp;file&nbsp;offset&nbsp;8</div>
<div class="pre"><a id="l212" href="#l212" class="linenr"> 212</a> </div>
<div class="pre"><a id="l213" href="#l213" class="linenr"> 213</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;table&nbsp;hopefully&nbsp;gets&nbsp;filled&nbsp;in&nbsp;by&nbsp;mkisofs&nbsp;using&nbsp;the</div>
<div class="pre"><a id="l214" href="#l214" class="linenr"> 214</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;-boot-info-table&nbsp;option.&nbsp;&nbsp;If&nbsp;not,&nbsp;the&nbsp;values&nbsp;in&nbsp;this</div>
<div class="pre"><a id="l215" href="#l215" class="linenr"> 215</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;table&nbsp;are&nbsp;default&nbsp;values&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;to&nbsp;get&nbsp;us&nbsp;what</div>
<div class="pre"><a id="l216" href="#l216" class="linenr"> 216</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;we&nbsp;need,&nbsp;at&nbsp;least&nbsp;under&nbsp;a&nbsp;certain&nbsp;set&nbsp;of&nbsp;assumptions.</div>
<div class="pre"><a id="l217" href="#l217" class="linenr"> 217</a> bi_pvd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;LBA&nbsp;of&nbsp;primary&nbsp;volume&nbsp;descriptor</div>
<div class="pre"><a id="l218" href="#l218" class="linenr"> 218</a> bi_file:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;LBA&nbsp;of&nbsp;boot&nbsp;file</div>
<div class="pre"><a id="l219" href="#l219" class="linenr"> 219</a> bi_length:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;0xdeadbeef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Length&nbsp;of&nbsp;boot&nbsp;file</div>
<div class="pre"><a id="l220" href="#l220" class="linenr"> 220</a> bi_csum:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;0xdeadbeef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Checksum&nbsp;of&nbsp;boot&nbsp;file</div>
<div class="pre"><a id="l221" href="#l221" class="linenr"> 221</a> bi_reserved:&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;10&nbsp;dd&nbsp;0xdeadbeef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Reserved</div>
<div class="pre"><a id="l222" href="#l222" class="linenr"> 222</a> bi_end:</div>
<div class="pre"><a id="l223" href="#l223" class="linenr"> 223</a> </div>
<div class="pre"><a id="l224" href="#l224" class="linenr"> 224</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Custom&nbsp;entry&nbsp;point&nbsp;for&nbsp;the&nbsp;hybrid-mode&nbsp;disk.</div>
<div class="pre"><a id="l225" href="#l225" class="linenr"> 225</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;The&nbsp;following&nbsp;values&nbsp;will&nbsp;have&nbsp;been&nbsp;pushed&nbsp;onto&nbsp;the</div>
<div class="pre"><a id="l226" href="#l226" class="linenr"> 226</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;entry&nbsp;stack:</div>
<div class="pre"><a id="l227" href="#l227" class="linenr"> 227</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;ES</div>
<div class="pre"><a id="l228" href="#l228" class="linenr"> 228</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;DI</div>
<div class="pre"><a id="l229" href="#l229" class="linenr"> 229</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;DX&nbsp;(including&nbsp;drive&nbsp;number)</div>
<div class="pre"><a id="l230" href="#l230" class="linenr"> 230</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;partition&nbsp;offset&nbsp;(qword)</div>
<div class="pre"><a id="l231" href="#l231" class="linenr"> 231</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;EBIOS&nbsp;flag</div>
<div class="pre"><a id="l232" href="#l232" class="linenr"> 232</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;CBIOS&nbsp;Sectors</div>
<div class="pre"><a id="l233" href="#l233" class="linenr"> 233</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;CBIOS&nbsp;Heads</div>
<div class="pre"><a id="l234" href="#l234" class="linenr"> 234</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(top&nbsp;of&nbsp;stack)</div>
<div class="pre"><a id="l235" href="#l235" class="linenr"> 235</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l236" href="#l236" class="linenr"> 236</a> %ifndef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l237" href="#l237" class="linenr"> 237</a> _hybrid_signature:</div>
<div class="pre"><a id="l238" href="#l238" class="linenr"> 238</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;0x0defe3f7</div>
<div class="pre"><a id="l239" href="#l239" class="linenr"> 239</a> _start_hybrid:</div>
<div class="pre"><a id="l240" href="#l240" class="linenr"> 240</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;word&nbsp;[cs:bsHeads]</div>
<div class="pre"><a id="l241" href="#l241" class="linenr"> 241</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;word&nbsp;[cs:bsSecPerTrack]</div>
<div class="pre"><a id="l242" href="#l242" class="linenr"> 242</a> </div>
<div class="pre"><a id="l243" href="#l243" class="linenr"> 243</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ax</div>
<div class="pre"><a id="l244" href="#l244" class="linenr"> 244</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,bios_cbios</div>
<div class="pre"><a id="l245" href="#l245" class="linenr"> 245</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;ax,ax</div>
<div class="pre"><a id="l246" href="#l246" class="linenr"> 246</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.cbios</div>
<div class="pre"><a id="l247" href="#l247" class="linenr"> 247</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,bios_ebios</div>
<div class="pre"><a id="l248" href="#l248" class="linenr"> 248</a> .cbios:</div>
<div class="pre"><a id="l249" href="#l249" class="linenr"> 249</a> </div>
<div class="pre"><a id="l250" href="#l250" class="linenr"> 250</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;dword&nbsp;[cs:bsHidden]</div>
<div class="pre"><a id="l251" href="#l251" class="linenr"> 251</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;dword&nbsp;[cs:bsHidden+4]</div>
<div class="pre"><a id="l252" href="#l252" class="linenr"> 252</a> </div>
<div class="pre"><a id="l253" href="#l253" class="linenr"> 253</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;dx</div>
<div class="pre"><a id="l254" href="#l254" class="linenr"> 254</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;di</div>
<div class="pre"><a id="l255" href="#l255" class="linenr"> 255</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;es</div>
<div class="pre"><a id="l256" href="#l256" class="linenr"> 256</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;_start_common</div>
<div class="pre"><a id="l257" href="#l257" class="linenr"> 257</a> %endif</div>
<div class="pre"><a id="l258" href="#l258" class="linenr"> 258</a> </div>
<div class="pre"><a id="l259" href="#l259" class="linenr"> 259</a> _start1:</div>
<div class="pre"><a id="l260" href="#l260" class="linenr"> 260</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,bios_cdrom</div>
<div class="pre"><a id="l261" href="#l261" class="linenr"> 261</a> _start_common:</div>
<div class="pre"><a id="l262" href="#l262" class="linenr"> 262</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[cs:InitStack],sp&nbsp;&nbsp;&nbsp;;&nbsp;Save&nbsp;initial&nbsp;stack&nbsp;pointer</div>
<div class="pre"><a id="l263" href="#l263" class="linenr"> 263</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[cs:InitStack+2],ss</div>
<div class="pre"><a id="l264" href="#l264" class="linenr"> 264</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ax,ax</div>
<div class="pre"><a id="l265" href="#l265" class="linenr"> 265</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ss,ax</div>
<div class="pre"><a id="l266" href="#l266" class="linenr"> 266</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;sp,StackBuf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;up&nbsp;stack</div>
<div class="pre"><a id="l267" href="#l267" class="linenr"> 267</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;es&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Save&nbsp;initial&nbsp;ES:DI&nbsp;-&gt;&nbsp;$PnP&nbsp;pointer</div>
<div class="pre"><a id="l268" href="#l268" class="linenr"> 268</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di</div>
<div class="pre"><a id="l269" href="#l269" class="linenr"> 269</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ds,ax</div>
<div class="pre"><a id="l270" href="#l270" class="linenr"> 270</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;es,ax</div>
<div class="pre"><a id="l271" href="#l271" class="linenr"> 271</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;fs,ax</div>
<div class="pre"><a id="l272" href="#l272" class="linenr"> 272</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;gs,ax</div>
<div class="pre"><a id="l273" href="#l273" class="linenr"> 273</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sti</div>
<div class="pre"><a id="l274" href="#l274" class="linenr"> 274</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cld</div>
<div class="pre"><a id="l275" href="#l275" class="linenr"> 275</a> </div>
<div class="pre"><a id="l276" href="#l276" class="linenr"> 276</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[BIOSType],si</div>
<div class="pre"><a id="l277" href="#l277" class="linenr"> 277</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si]</div>
<div class="pre"><a id="l278" href="#l278" class="linenr"> 278</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[GetlinsecPtr],eax</div>
<div class="pre"><a id="l279" href="#l279" class="linenr"> 279</a> </div>
<div class="pre"><a id="l280" href="#l280" class="linenr"> 280</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Show&nbsp;signs&nbsp;of&nbsp;life</div>
<div class="pre"><a id="l281" href="#l281" class="linenr"> 281</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,syslinux_banner</div>
<div class="pre"><a id="l282" href="#l282" class="linenr"> 282</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr_early</div>
<div class="pre"><a id="l283" href="#l283" class="linenr"> 283</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l284" href="#l284" class="linenr"> 284</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,copyright_str</div>
<div class="pre"><a id="l285" href="#l285" class="linenr"> 285</a> %else</div>
<div class="pre"><a id="l286" href="#l286" class="linenr"> 286</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,[BIOSName]</div>
<div class="pre"><a id="l287" href="#l287" class="linenr"> 287</a> %endif</div>
<div class="pre"><a id="l288" href="#l288" class="linenr"> 288</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr_early</div>
<div class="pre"><a id="l289" href="#l289" class="linenr"> 289</a> </div>
<div class="pre"><a id="l290" href="#l290" class="linenr"> 290</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l291" href="#l291" class="linenr"> 291</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Before&nbsp;modifying&nbsp;any&nbsp;memory,&nbsp;get&nbsp;the&nbsp;checksum&nbsp;of&nbsp;bytes</div>
<div class="pre"><a id="l292" href="#l292" class="linenr"> 292</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;64-2048</div>
<div class="pre"><a id="l293" href="#l293" class="linenr"> 293</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l294" href="#l294" class="linenr"> 294</a> initial_csum:&nbsp;&nbsp;&nbsp;xor&nbsp;edi,edi</div>
<div class="pre"><a id="l295" href="#l295" class="linenr"> 295</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,bi_end</div>
<div class="pre"><a id="l296" href="#l296" class="linenr"> 296</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,(SECTOR_SIZE-64)&nbsp;&gt;&gt;&nbsp;2</div>
<div class="pre"><a id="l297" href="#l297" class="linenr"> 297</a> .loop:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lodsd</div>
<div class="pre"><a id="l298" href="#l298" class="linenr"> 298</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;edi,eax</div>
<div class="pre"><a id="l299" href="#l299" class="linenr"> 299</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;.loop</div>
<div class="pre"><a id="l300" href="#l300" class="linenr"> 300</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[FirstSecSum],edi</div>
<div class="pre"><a id="l301" href="#l301" class="linenr"> 301</a> </div>
<div class="pre"><a id="l302" href="#l302" class="linenr"> 302</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[DriveNumber],dl</div>
<div class="pre"><a id="l303" href="#l303" class="linenr"> 303</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l304" href="#l304" class="linenr"> 304</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,startup_msg</div>
<div class="pre"><a id="l305" href="#l305" class="linenr"> 305</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l306" href="#l306" class="linenr"> 306</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,dl</div>
<div class="pre"><a id="l307" href="#l307" class="linenr"> 307</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex2</div>
<div class="pre"><a id="l308" href="#l308" class="linenr"> 308</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l309" href="#l309" class="linenr"> 309</a> %endif</div>
<div class="pre"><a id="l310" href="#l310" class="linenr"> 310</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l311" href="#l311" class="linenr"> 311</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Initialize&nbsp;spec&nbsp;packet&nbsp;buffers</div>
<div class="pre"><a id="l312" href="#l312" class="linenr"> 312</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l313" href="#l313" class="linenr"> 313</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,_spec_start</div>
<div class="pre"><a id="l314" href="#l314" class="linenr"> 314</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,_spec_len&nbsp;&gt;&gt;&nbsp;2</div>
<div class="pre"><a id="l315" href="#l315" class="linenr"> 315</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;eax,eax</div>
<div class="pre"><a id="l316" href="#l316" class="linenr"> 316</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rep&nbsp;stosd</div>
<div class="pre"><a id="l317" href="#l317" class="linenr"> 317</a> </div>
<div class="pre"><a id="l318" href="#l318" class="linenr"> 318</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Initialize&nbsp;length&nbsp;field&nbsp;of&nbsp;the&nbsp;various&nbsp;packets</div>
<div class="pre"><a id="l319" href="#l319" class="linenr"> 319</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[spec_packet],13h</div>
<div class="pre"><a id="l320" href="#l320" class="linenr"> 320</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[drive_params],30</div>
<div class="pre"><a id="l321" href="#l321" class="linenr"> 321</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[dapa],16</div>
<div class="pre"><a id="l322" href="#l322" class="linenr"> 322</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[dspec_packet],13h</div>
<div class="pre"><a id="l323" href="#l323" class="linenr"> 323</a> </div>
<div class="pre"><a id="l324" href="#l324" class="linenr"> 324</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Other&nbsp;nonzero&nbsp;fields</div>
<div class="pre"><a id="l325" href="#l325" class="linenr"> 325</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;word&nbsp;[dsp_sectors]</div>
<div class="pre"><a id="l326" href="#l326" class="linenr"> 326</a> </div>
<div class="pre"><a id="l327" href="#l327" class="linenr"> 327</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Are&nbsp;we&nbsp;just&nbsp;pretending&nbsp;to&nbsp;be&nbsp;a&nbsp;CD-ROM?</div>
<div class="pre"><a id="l328" href="#l328" class="linenr"> 328</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;word&nbsp;[BIOSType],bios_cdrom</div>
<div class="pre"><a id="l329" href="#l329" class="linenr"> 329</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;found_drive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;If&nbsp;so,&nbsp;no&nbsp;spec&nbsp;packet...</div>
<div class="pre"><a id="l330" href="#l330" class="linenr"> 330</a> </div>
<div class="pre"><a id="l331" href="#l331" class="linenr"> 331</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Now&nbsp;figure&nbsp;out&nbsp;what&nbsp;we&#39;re&nbsp;actually&nbsp;doing</div>
<div class="pre"><a id="l332" href="#l332" class="linenr"> 332</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Note:&nbsp;use&nbsp;passed-in&nbsp;DL&nbsp;value&nbsp;rather&nbsp;than&nbsp;7Fh&nbsp;because</div>
<div class="pre"><a id="l333" href="#l333" class="linenr"> 333</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;at&nbsp;least&nbsp;some&nbsp;BIOSes&nbsp;will&nbsp;get&nbsp;the&nbsp;wrong&nbsp;value&nbsp;otherwise</div>
<div class="pre"><a id="l334" href="#l334" class="linenr"> 334</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,4B01h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Get&nbsp;disk&nbsp;emulation&nbsp;status</div>
<div class="pre"><a id="l335" href="#l335" class="linenr"> 335</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l336" href="#l336" class="linenr"> 336</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,spec_packet</div>
<div class="pre"><a id="l337" href="#l337" class="linenr"> 337</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;int13</div>
<div class="pre"><a id="l338" href="#l338" class="linenr"> 338</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jc&nbsp;award_hack&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;changed&nbsp;for&nbsp;BrokenAwardHack</div>
<div class="pre"><a id="l339" href="#l339" class="linenr"> 339</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l340" href="#l340" class="linenr"> 340</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;[sp_drive],dl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Should&nbsp;contain&nbsp;the&nbsp;drive&nbsp;number</div>
<div class="pre"><a id="l341" href="#l341" class="linenr"> 341</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;spec_query_failed</div>
<div class="pre"><a id="l342" href="#l342" class="linenr"> 342</a> </div>
<div class="pre"><a id="l343" href="#l343" class="linenr"> 343</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l344" href="#l344" class="linenr"> 344</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,spec_ok_msg</div>
<div class="pre"><a id="l345" href="#l345" class="linenr"> 345</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l346" href="#l346" class="linenr"> 346</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,byte&nbsp;[sp_drive]</div>
<div class="pre"><a id="l347" href="#l347" class="linenr"> 347</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex2</div>
<div class="pre"><a id="l348" href="#l348" class="linenr"> 348</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l349" href="#l349" class="linenr"> 349</a> %endif</div>
<div class="pre"><a id="l350" href="#l350" class="linenr"> 350</a> </div>
<div class="pre"><a id="l351" href="#l351" class="linenr"> 351</a> found_drive:</div>
<div class="pre"><a id="l352" href="#l352" class="linenr"> 352</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Alright,&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;drive.&nbsp;&nbsp;Now,&nbsp;try&nbsp;to&nbsp;find&nbsp;the</div>
<div class="pre"><a id="l353" href="#l353" class="linenr"> 353</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;boot&nbsp;file&nbsp;itself.&nbsp;&nbsp;If&nbsp;we&nbsp;have&nbsp;a&nbsp;boot&nbsp;info&nbsp;table,&nbsp;life&nbsp;is</div>
<div class="pre"><a id="l354" href="#l354" class="linenr"> 354</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;good;&nbsp;if&nbsp;not,&nbsp;we&nbsp;have&nbsp;to&nbsp;make&nbsp;some&nbsp;assumptions,&nbsp;and&nbsp;try</div>
<div class="pre"><a id="l355" href="#l355" class="linenr"> 355</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;to&nbsp;figure&nbsp;things&nbsp;out&nbsp;ourselves.&nbsp;&nbsp;In&nbsp;particular,&nbsp;the</div>
<div class="pre"><a id="l356" href="#l356" class="linenr"> 356</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;assumptions&nbsp;we&nbsp;have&nbsp;to&nbsp;make&nbsp;are:</div>
<div class="pre"><a id="l357" href="#l357" class="linenr"> 357</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;-&nbsp;single&nbsp;session&nbsp;only</div>
<div class="pre"><a id="l358" href="#l358" class="linenr"> 358</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;-&nbsp;only&nbsp;one&nbsp;boot&nbsp;entry&nbsp;(no&nbsp;menu&nbsp;or&nbsp;other&nbsp;alternatives)</div>
<div class="pre"><a id="l359" href="#l359" class="linenr"> 359</a> </div>
<div class="pre"><a id="l360" href="#l360" class="linenr"> 360</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;dword&nbsp;[bi_file],0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Address&nbsp;of&nbsp;code&nbsp;to&nbsp;load</div>
<div class="pre"><a id="l361" href="#l361" class="linenr"> 361</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;found_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Boot&nbsp;info&nbsp;table&nbsp;present&nbsp;:)</div>
<div class="pre"><a id="l362" href="#l362" class="linenr"> 362</a> </div>
<div class="pre"><a id="l363" href="#l363" class="linenr"> 363</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l364" href="#l364" class="linenr"> 364</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,noinfotable_msg</div>
<div class="pre"><a id="l365" href="#l365" class="linenr"> 365</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l366" href="#l366" class="linenr"> 366</a> %endif</div>
<div class="pre"><a id="l367" href="#l367" class="linenr"> 367</a> </div>
<div class="pre"><a id="l368" href="#l368" class="linenr"> 368</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;No&nbsp;such&nbsp;luck.&nbsp;&nbsp;See&nbsp;if&nbsp;the&nbsp;spec&nbsp;packet&nbsp;contained&nbsp;one.</div>
<div class="pre"><a id="l369" href="#l369" class="linenr"> 369</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[sp_lba]</div>
<div class="pre"><a id="l370" href="#l370" class="linenr"> 370</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;eax,eax</div>
<div class="pre"><a id="l371" href="#l371" class="linenr"> 371</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;set_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Good&nbsp;enough</div>
<div class="pre"><a id="l372" href="#l372" class="linenr"> 372</a> </div>
<div class="pre"><a id="l373" href="#l373" class="linenr"> 373</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l374" href="#l374" class="linenr"> 374</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,noinfoinspec_msg</div>
<div class="pre"><a id="l375" href="#l375" class="linenr"> 375</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l376" href="#l376" class="linenr"> 376</a> %endif</div>
<div class="pre"><a id="l377" href="#l377" class="linenr"> 377</a> </div>
<div class="pre"><a id="l378" href="#l378" class="linenr"> 378</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;No&nbsp;such&nbsp;luck.&nbsp;&nbsp;Get&nbsp;the&nbsp;Boot&nbsp;Record&nbsp;Volume,&nbsp;assuming&nbsp;single</div>
<div class="pre"><a id="l379" href="#l379" class="linenr"> 379</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;session&nbsp;disk,&nbsp;and&nbsp;that&nbsp;we&#39;re&nbsp;the&nbsp;first&nbsp;entry&nbsp;in&nbsp;the&nbsp;chain.</div>
<div class="pre"><a id="l380" href="#l380" class="linenr"> 380</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Assumed&nbsp;address&nbsp;of&nbsp;BRV</div>
<div class="pre"><a id="l381" href="#l381" class="linenr"> 381</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,trackbuf</div>
<div class="pre"><a id="l382" href="#l382" class="linenr"> 382</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getonesec</div>
<div class="pre"><a id="l383" href="#l383" class="linenr"> 383</a> </div>
<div class="pre"><a id="l384" href="#l384" class="linenr"> 384</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[trackbuf+47h]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Get&nbsp;boot&nbsp;catalog&nbsp;address</div>
<div class="pre"><a id="l385" href="#l385" class="linenr"> 385</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,trackbuf</div>
<div class="pre"><a id="l386" href="#l386" class="linenr"> 386</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getonesec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Get&nbsp;boot&nbsp;catalog</div>
<div class="pre"><a id="l387" href="#l387" class="linenr"> 387</a> </div>
<div class="pre"><a id="l388" href="#l388" class="linenr"> 388</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[trackbuf+28h]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;First&nbsp;boot&nbsp;entry</div>
<div class="pre"><a id="l389" href="#l389" class="linenr"> 389</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;And&nbsp;hope&nbsp;and&nbsp;pray&nbsp;this&nbsp;is&nbsp;us...</div>
<div class="pre"><a id="l390" href="#l390" class="linenr"> 390</a> </div>
<div class="pre"><a id="l391" href="#l391" class="linenr"> 391</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Some&nbsp;BIOSes&nbsp;apparently&nbsp;have&nbsp;limitations&nbsp;on&nbsp;the&nbsp;size</div>
<div class="pre"><a id="l392" href="#l392" class="linenr"> 392</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;that&nbsp;may&nbsp;be&nbsp;loaded&nbsp;(despite&nbsp;the&nbsp;El&nbsp;Torito&nbsp;spec&nbsp;being&nbsp;very</div>
<div class="pre"><a id="l393" href="#l393" class="linenr"> 393</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;clear&nbsp;on&nbsp;the&nbsp;fact&nbsp;that&nbsp;it&nbsp;must&nbsp;all&nbsp;be&nbsp;loaded.)&nbsp;&nbsp;Therefore,</div>
<div class="pre"><a id="l394" href="#l394" class="linenr"> 394</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;we&nbsp;load&nbsp;it&nbsp;ourselves,&nbsp;and&nbsp;*bleep*&nbsp;the&nbsp;BIOS.</div>
<div class="pre"><a id="l395" href="#l395" class="linenr"> 395</a> </div>
<div class="pre"><a id="l396" href="#l396" class="linenr"> 396</a> set_file:</div>
<div class="pre"><a id="l397" href="#l397" class="linenr"> 397</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bi_file],eax</div>
<div class="pre"><a id="l398" href="#l398" class="linenr"> 398</a> </div>
<div class="pre"><a id="l399" href="#l399" class="linenr"> 399</a> found_file:</div>
<div class="pre"><a id="l400" href="#l400" class="linenr"> 400</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;up&nbsp;boot&nbsp;file&nbsp;sizes</div>
<div class="pre"><a id="l401" href="#l401" class="linenr"> 401</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[bi_length]</div>
<div class="pre"><a id="l402" href="#l402" class="linenr"> 402</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;eax,SECTOR_SIZE-3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;...&nbsp;minus&nbsp;sector&nbsp;loaded</div>
<div class="pre"><a id="l403" href="#l403" class="linenr"> 403</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr&nbsp;eax,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;bytes-&gt;dwords</div>
<div class="pre"><a id="l404" href="#l404" class="linenr"> 404</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[ImageDwords],eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;boot&nbsp;file&nbsp;dwords</div>
<div class="pre"><a id="l405" href="#l405" class="linenr"> 405</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;eax,(2047&nbsp;&gt;&gt;&nbsp;2)</div>
<div class="pre"><a id="l406" href="#l406" class="linenr"> 406</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr&nbsp;eax,9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;dwords-&gt;sectors</div>
<div class="pre"><a id="l407" href="#l407" class="linenr"> 407</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[ImageSectors],ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;boot&nbsp;file&nbsp;sectors</div>
<div class="pre"><a id="l408" href="#l408" class="linenr"> 408</a> </div>
<div class="pre"><a id="l409" href="#l409" class="linenr"> 409</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[bi_file]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Address&nbsp;of&nbsp;code&nbsp;to&nbsp;load</div>
<div class="pre"><a id="l410" href="#l410" class="linenr"> 410</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Don&#39;t&nbsp;reload&nbsp;bootstrap&nbsp;code</div>
<div class="pre"><a id="l411" href="#l411" class="linenr"> 411</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l412" href="#l412" class="linenr"> 412</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,offset_msg</div>
<div class="pre"><a id="l413" href="#l413" class="linenr"> 413</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l414" href="#l414" class="linenr"> 414</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex8</div>
<div class="pre"><a id="l415" href="#l415" class="linenr"> 415</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l416" href="#l416" class="linenr"> 416</a> %endif</div>
<div class="pre"><a id="l417" href="#l417" class="linenr"> 417</a> </div>
<div class="pre"><a id="l418" href="#l418" class="linenr"> 418</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Just&nbsp;in&nbsp;case&nbsp;some&nbsp;BIOSes&nbsp;have&nbsp;problems&nbsp;with</div>
<div class="pre"><a id="l419" href="#l419" class="linenr"> 419</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;segment&nbsp;wraparound,&nbsp;use&nbsp;the&nbsp;normalized&nbsp;address</div>
<div class="pre"><a id="l420" href="#l420" class="linenr"> 420</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,((7C00h+2048)&nbsp;&gt;&gt;&nbsp;4)</div>
<div class="pre"><a id="l421" href="#l421" class="linenr"> 421</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;es,bx</div>
<div class="pre"><a id="l422" href="#l422" class="linenr"> 422</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;bx,bx</div>
<div class="pre"><a id="l423" href="#l423" class="linenr"> 423</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bp,[ImageSectors]</div>
<div class="pre"><a id="l424" href="#l424" class="linenr"> 424</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l425" href="#l425" class="linenr"> 425</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ax</div>
<div class="pre"><a id="l426" href="#l426" class="linenr"> 426</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,size_msg</div>
<div class="pre"><a id="l427" href="#l427" class="linenr"> 427</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l428" href="#l428" class="linenr"> 428</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,bp</div>
<div class="pre"><a id="l429" href="#l429" class="linenr"> 429</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex4</div>
<div class="pre"><a id="l430" href="#l430" class="linenr"> 430</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l431" href="#l431" class="linenr"> 431</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ax</div>
<div class="pre"><a id="l432" href="#l432" class="linenr"> 432</a> %endif</div>
<div class="pre"><a id="l433" href="#l433" class="linenr"> 433</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getlinsec</div>
<div class="pre"><a id="l434" href="#l434" class="linenr"> 434</a> </div>
<div class="pre"><a id="l435" href="#l435" class="linenr"> 435</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ds</div>
<div class="pre"><a id="l436" href="#l436" class="linenr"> 436</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;es</div>
<div class="pre"><a id="l437" href="#l437" class="linenr"> 437</a> </div>
<div class="pre"><a id="l438" href="#l438" class="linenr"> 438</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l439" href="#l439" class="linenr"> 439</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,loaded_msg</div>
<div class="pre"><a id="l440" href="#l440" class="linenr"> 440</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l441" href="#l441" class="linenr"> 441</a> %endif</div>
<div class="pre"><a id="l442" href="#l442" class="linenr"> 442</a> </div>
<div class="pre"><a id="l443" href="#l443" class="linenr"> 443</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;on&nbsp;the&nbsp;loaded&nbsp;image.</div>
<div class="pre"><a id="l444" href="#l444" class="linenr"> 444</a> verify_image:</div>
<div class="pre"><a id="l445" href="#l445" class="linenr"> 445</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,7C00h+2048</div>
<div class="pre"><a id="l446" href="#l446" class="linenr"> 446</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,es</div>
<div class="pre"><a id="l447" href="#l447" class="linenr"> 447</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ecx,[ImageDwords]</div>
<div class="pre"><a id="l448" href="#l448" class="linenr"> 448</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;edi,[FirstSecSum]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;First&nbsp;sector&nbsp;checksum</div>
<div class="pre"><a id="l449" href="#l449" class="linenr"> 449</a> .loop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;es&nbsp;lodsd</div>
<div class="pre"><a id="l450" href="#l450" class="linenr"> 450</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;edi,eax</div>
<div class="pre"><a id="l451" href="#l451" class="linenr"> 451</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;ecx</div>
<div class="pre"><a id="l452" href="#l452" class="linenr"> 452</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.done</div>
<div class="pre"><a id="l453" href="#l453" class="linenr"> 453</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;si,si</div>
<div class="pre"><a id="l454" href="#l454" class="linenr"> 454</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.loop</div>
<div class="pre"><a id="l455" href="#l455" class="linenr"> 455</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;SI&nbsp;wrapped&nbsp;around,&nbsp;advance&nbsp;ES</div>
<div class="pre"><a id="l456" href="#l456" class="linenr"> 456</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;bx,1000h</div>
<div class="pre"><a id="l457" href="#l457" class="linenr"> 457</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;es,bx</div>
<div class="pre"><a id="l458" href="#l458" class="linenr"> 458</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;short&nbsp;.loop</div>
<div class="pre"><a id="l459" href="#l459" class="linenr"> 459</a> .done:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,ds</div>
<div class="pre"><a id="l460" href="#l460" class="linenr"> 460</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;es,ax</div>
<div class="pre"><a id="l461" href="#l461" class="linenr"> 461</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;[bi_csum],edi</div>
<div class="pre"><a id="l462" href="#l462" class="linenr"> 462</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;integrity_ok</div>
<div class="pre"><a id="l463" href="#l463" class="linenr"> 463</a> </div>
<div class="pre"><a id="l464" href="#l464" class="linenr"> 464</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,checkerr_msg</div>
<div class="pre"><a id="l465" href="#l465" class="linenr"> 465</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l466" href="#l466" class="linenr"> 466</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;kaboom</div>
<div class="pre"><a id="l467" href="#l467" class="linenr"> 467</a> </div>
<div class="pre"><a id="l468" href="#l468" class="linenr"> 468</a> integrity_ok:</div>
<div class="pre"><a id="l469" href="#l469" class="linenr"> 469</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l470" href="#l470" class="linenr"> 470</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,allread_msg</div>
<div class="pre"><a id="l471" href="#l471" class="linenr"> 471</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l472" href="#l472" class="linenr"> 472</a> %endif</div>
<div class="pre"><a id="l473" href="#l473" class="linenr"> 473</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;all_read&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Jump&nbsp;to&nbsp;main&nbsp;code</div>
<div class="pre"><a id="l474" href="#l474" class="linenr"> 474</a> </div>
<div class="pre"><a id="l475" href="#l475" class="linenr"> 475</a> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div class="pre"><a id="l476" href="#l476" class="linenr"> 476</a> ;;&nbsp;Start&nbsp;of&nbsp;BrokenAwardHack&nbsp;---&nbsp;10-nov-2002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Knut_Petersen@t-online.de</div>
<div class="pre"><a id="l477" href="#l477" class="linenr"> 477</a> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div class="pre"><a id="l478" href="#l478" class="linenr"> 478</a> ;;</div>
<div class="pre"><a id="l479" href="#l479" class="linenr"> 479</a> ;;&nbsp;There&nbsp;is&nbsp;a&nbsp;problem&nbsp;with&nbsp;certain&nbsp;versions&nbsp;of&nbsp;the&nbsp;AWARD&nbsp;BIOS&nbsp;...</div>
<div class="pre"><a id="l480" href="#l480" class="linenr"> 480</a> ;;&nbsp;the&nbsp;boot&nbsp;sector&nbsp;will&nbsp;be&nbsp;loaded&nbsp;and&nbsp;executed&nbsp;correctly,&nbsp;but,&nbsp;because&nbsp;the</div>
<div class="pre"><a id="l481" href="#l481" class="linenr"> 481</a> ;;&nbsp;int&nbsp;13&nbsp;vector&nbsp;points&nbsp;to&nbsp;the&nbsp;wrong&nbsp;code&nbsp;in&nbsp;the&nbsp;BIOS,&nbsp;every&nbsp;attempt&nbsp;to</div>
<div class="pre"><a id="l482" href="#l482" class="linenr"> 482</a> ;;&nbsp;load&nbsp;the&nbsp;spec&nbsp;packet&nbsp;will&nbsp;fail.&nbsp;We&nbsp;scan&nbsp;for&nbsp;the&nbsp;equivalent&nbsp;of</div>
<div class="pre"><a id="l483" href="#l483" class="linenr"> 483</a> ;;</div>
<div class="pre"><a id="l484" href="#l484" class="linenr"> 484</a> ;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ax,0201h</div>
<div class="pre"><a id="l485" href="#l485" class="linenr"> 485</a> ;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bx,7c00h</div>
<div class="pre"><a id="l486" href="#l486" class="linenr"> 486</a> ;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cx,0006h</div>
<div class="pre"><a id="l487" href="#l487" class="linenr"> 487</a> ;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx,0180h</div>
<div class="pre"><a id="l488" href="#l488" class="linenr"> 488</a> ;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushf</div>
<div class="pre"><a id="l489" href="#l489" class="linenr"> 489</a> ;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;&lt;direct&nbsp;far&gt;</div>
<div class="pre"><a id="l490" href="#l490" class="linenr"> 490</a> ;;</div>
<div class="pre"><a id="l491" href="#l491" class="linenr"> 491</a> ;;&nbsp;and&nbsp;use&nbsp;&lt;direct&nbsp;far&gt;&nbsp;as&nbsp;the&nbsp;new&nbsp;vector&nbsp;for&nbsp;int&nbsp;13.&nbsp;The&nbsp;code&nbsp;above&nbsp;is</div>
<div class="pre"><a id="l492" href="#l492" class="linenr"> 492</a> ;;&nbsp;used&nbsp;to&nbsp;load&nbsp;the&nbsp;boot&nbsp;code&nbsp;into&nbsp;ram,&nbsp;and&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;reason</div>
<div class="pre"><a id="l493" href="#l493" class="linenr"> 493</a> ;;&nbsp;for&nbsp;anybody&nbsp;to&nbsp;change&nbsp;it&nbsp;now&nbsp;or&nbsp;in&nbsp;the&nbsp;future.&nbsp;There&nbsp;are&nbsp;no&nbsp;opcodes</div>
<div class="pre"><a id="l494" href="#l494" class="linenr"> 494</a> ;;&nbsp;that&nbsp;use&nbsp;encodings&nbsp;relativ&nbsp;to&nbsp;IP,&nbsp;so&nbsp;scanning&nbsp;is&nbsp;easy.&nbsp;If&nbsp;we&nbsp;find&nbsp;the</div>
<div class="pre"><a id="l495" href="#l495" class="linenr"> 495</a> ;;&nbsp;code&nbsp;above&nbsp;in&nbsp;the&nbsp;BIOS&nbsp;code&nbsp;we&nbsp;can&nbsp;be&nbsp;pretty&nbsp;sure&nbsp;to&nbsp;run&nbsp;on&nbsp;a&nbsp;machine</div>
<div class="pre"><a id="l496" href="#l496" class="linenr"> 496</a> ;;&nbsp;with&nbsp;an&nbsp;broken&nbsp;AWARD&nbsp;BIOS&nbsp;...</div>
<div class="pre"><a id="l497" href="#l497" class="linenr"> 497</a> ;;</div>
<div class="pre"><a id="l498" href="#l498" class="linenr"> 498</a> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div class="pre"><a id="l499" href="#l499" class="linenr"> 499</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l500" href="#l500" class="linenr"> 500</a> %ifdef&nbsp;DEBUG_MESSAGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l501" href="#l501" class="linenr"> 501</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l502" href="#l502" class="linenr"> 502</a> award_notice&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Trying&nbsp;BrokenAwardHack&nbsp;first&nbsp;...&quot;,CR,LF,0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l503" href="#l503" class="linenr"> 503</a> award_not_orig&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;BAH:&nbsp;Original&nbsp;Int&nbsp;13&nbsp;vector&nbsp;&nbsp;&nbsp;:&nbsp;&quot;,0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l504" href="#l504" class="linenr"> 504</a> award_not_new&nbsp;&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;BAH:&nbsp;Int&nbsp;13&nbsp;vector&nbsp;changed&nbsp;to&nbsp;:&nbsp;&quot;,0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l505" href="#l505" class="linenr"> 505</a> award_not_succ&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;BAH:&nbsp;SUCCESS&quot;,CR,LF,0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l506" href="#l506" class="linenr"> 506</a> award_not_fail&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;BAH:&nbsp;FAILURE&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l507" href="#l507" class="linenr"> 507</a> award_not_crlf&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CR,LF,0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l508" href="#l508" class="linenr"> 508</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l509" href="#l509" class="linenr"> 509</a> %endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l510" href="#l510" class="linenr"> 510</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l511" href="#l511" class="linenr"> 511</a> award_oldint13&nbsp;&nbsp;dd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l512" href="#l512" class="linenr"> 512</a> award_string&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0b8h,1,2,0bbh,0,7ch,0b9h,6,0,0bah,80h,1,09ch,09ah&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l513" href="#l513" class="linenr"> 513</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;</div>
<div class="pre"><a id="l514" href="#l514" class="linenr"> 514</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div class="pre"><a id="l515" href="#l515" class="linenr"> 515</a> award_hack:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,spec_err_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Moved&nbsp;to&nbsp;this&nbsp;place&nbsp;from</div>
<div class="pre"><a id="l516" href="#l516" class="linenr"> 516</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writemsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;spec_query_faild</div>
<div class="pre"><a id="l517" href="#l517" class="linenr"> 517</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l518" href="#l518" class="linenr"> 518</a> %ifdef&nbsp;DEBUG_MESSAGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l519" href="#l519" class="linenr"> 519</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l520" href="#l520" class="linenr"> 520</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_notice&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;display&nbsp;our&nbsp;plan</div>
<div class="pre"><a id="l521" href="#l521" class="linenr"> 521</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writemsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l522" href="#l522" class="linenr"> 522</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_not_orig&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;display&nbsp;original&nbsp;int&nbsp;13</div>
<div class="pre"><a id="l523" href="#l523" class="linenr"> 523</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writemsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;vector</div>
<div class="pre"><a id="l524" href="#l524" class="linenr"> 524</a> %endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l525" href="#l525" class="linenr"> 525</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,[13h*4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l526" href="#l526" class="linenr"> 526</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[award_oldint13],eax&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l527" href="#l527" class="linenr"> 527</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l528" href="#l528" class="linenr"> 528</a> %ifdef&nbsp;DEBUG_MESSAGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l529" href="#l529" class="linenr"> 529</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l530" href="#l530" class="linenr"> 530</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writehex8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l531" href="#l531" class="linenr"> 531</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_not_crlf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l532" href="#l532" class="linenr"> 532</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writestr_early&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l533" href="#l533" class="linenr"> 533</a> %endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l534" href="#l534" class="linenr"> 534</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;&nbsp;es&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;save&nbsp;ES</div>
<div class="pre"><a id="l535" href="#l535" class="linenr"> 535</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ax,0f000h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ES&nbsp;=&nbsp;BIOS&nbsp;Seg</div>
<div class="pre"><a id="l536" href="#l536" class="linenr"> 536</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;es,ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l537" href="#l537" class="linenr"> 537</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cld&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l538" href="#l538" class="linenr"> 538</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;di,di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;start&nbsp;at&nbsp;ES:DI&nbsp;=&nbsp;f000:0</div>
<div class="pre"><a id="l539" href="#l539" class="linenr"> 539</a> award_loop:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;save&nbsp;DI</div>
<div class="pre"><a id="l540" href="#l540" class="linenr"> 540</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;scan&nbsp;for&nbsp;award_string</div>
<div class="pre"><a id="l541" href="#l541" class="linenr"> 541</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cx,7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;length&nbsp;of&nbsp;award_string&nbsp;=&nbsp;7dw</div>
<div class="pre"><a id="l542" href="#l542" class="linenr"> 542</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repz&nbsp;&nbsp;&nbsp;&nbsp;cmpsw&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;compare</div>
<div class="pre"><a id="l543" href="#l543" class="linenr"> 543</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;restore&nbsp;DI</div>
<div class="pre"><a id="l544" href="#l544" class="linenr"> 544</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jcxz&nbsp;&nbsp;&nbsp;&nbsp;award_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;jmp&nbsp;if&nbsp;found</div>
<div class="pre"><a id="l545" href="#l545" class="linenr"> 545</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;not&nbsp;found,&nbsp;inc&nbsp;di</div>
<div class="pre"><a id="l546" href="#l546" class="linenr"> 546</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jno&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;award_loop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l547" href="#l547" class="linenr"> 547</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l548" href="#l548" class="linenr"> 548</a> award_failed:&nbsp;&nbsp;&nbsp;pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;es&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;No,&nbsp;not&nbsp;this&nbsp;way&nbsp;:-((</div>
<div class="pre"><a id="l549" href="#l549" class="linenr"> 549</a> award_fail2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l550" href="#l550" class="linenr"> 550</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l551" href="#l551" class="linenr"> 551</a> %ifdef&nbsp;DEBUG_MESSAGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l552" href="#l552" class="linenr"> 552</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l553" href="#l553" class="linenr"> 553</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_not_fail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;display&nbsp;failure&nbsp;...</div>
<div class="pre"><a id="l554" href="#l554" class="linenr"> 554</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writemsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l555" href="#l555" class="linenr"> 555</a> %endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l556" href="#l556" class="linenr"> 556</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,[award_oldint13]&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;restore&nbsp;the&nbsp;original&nbsp;int</div>
<div class="pre"><a id="l557" href="#l557" class="linenr"> 557</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;13&nbsp;vector&nbsp;if&nbsp;there&nbsp;is&nbsp;one</div>
<div class="pre"><a id="l558" href="#l558" class="linenr"> 558</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spec_query_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;and&nbsp;try&nbsp;other&nbsp;workarounds</div>
<div class="pre"><a id="l559" href="#l559" class="linenr"> 559</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[13h*4],eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l560" href="#l560" class="linenr"> 560</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spec_query_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l561" href="#l561" class="linenr"> 561</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l562" href="#l562" class="linenr"> 562</a> award_found:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,[es:di+0eh]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;load&nbsp;possible&nbsp;int&nbsp;13&nbsp;addr</div>
<div class="pre"><a id="l563" href="#l563" class="linenr"> 563</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;es&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;restore&nbsp;ES</div>
<div class="pre"><a id="l564" href="#l564" class="linenr"> 564</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l565" href="#l565" class="linenr"> 565</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax,[award_oldint13]&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;give&nbsp;up&nbsp;if&nbsp;this&nbsp;is&nbsp;the</div>
<div class="pre"><a id="l566" href="#l566" class="linenr"> 566</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;award_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;active&nbsp;int&nbsp;13&nbsp;vector,</div>
<div class="pre"><a id="l567" href="#l567" class="linenr"> 567</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[13h*4],eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;otherwise&nbsp;change&nbsp;0:13h*4</div>
<div class="pre"><a id="l568" href="#l568" class="linenr"> 568</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l569" href="#l569" class="linenr"> 569</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l570" href="#l570" class="linenr"> 570</a> %ifdef&nbsp;DEBUG_MESSAGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l571" href="#l571" class="linenr"> 571</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l572" href="#l572" class="linenr"> 572</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;&nbsp;eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;display&nbsp;message&nbsp;and</div>
<div class="pre"><a id="l573" href="#l573" class="linenr"> 573</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_not_new&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;new&nbsp;vector&nbsp;address</div>
<div class="pre"><a id="l574" href="#l574" class="linenr"> 574</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writemsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l575" href="#l575" class="linenr"> 575</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l576" href="#l576" class="linenr"> 576</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writehex8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l577" href="#l577" class="linenr"> 577</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_not_crlf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l578" href="#l578" class="linenr"> 578</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writestr_early&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l579" href="#l579" class="linenr"> 579</a> %endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l580" href="#l580" class="linenr"> 580</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ax,4B01h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;try&nbsp;to&nbsp;read&nbsp;the&nbsp;spec&nbsp;packet</div>
<div class="pre"><a id="l581" href="#l581" class="linenr"> 581</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dl,[DriveNumber]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;now&nbsp;...&nbsp;it&nbsp;should&nbsp;not&nbsp;fail</div>
<div class="pre"><a id="l582" href="#l582" class="linenr"> 582</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,spec_packet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;any&nbsp;longer</div>
<div class="pre"><a id="l583" href="#l583" class="linenr"> 583</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l584" href="#l584" class="linenr"> 584</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;award_fail2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l585" href="#l585" class="linenr"> 585</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l586" href="#l586" class="linenr"> 586</a> %ifdef&nbsp;DEBUG_MESSAGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l587" href="#l587" class="linenr"> 587</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l588" href="#l588" class="linenr"> 588</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;si,award_not_succ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;display&nbsp;our&nbsp;SUCCESS</div>
<div class="pre"><a id="l589" href="#l589" class="linenr"> 589</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;&nbsp;writemsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l590" href="#l590" class="linenr"> 590</a> %endif&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l591" href="#l591" class="linenr"> 591</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;found_drive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;and&nbsp;leave&nbsp;error&nbsp;recovery&nbsp;code</div>
<div class="pre"><a id="l592" href="#l592" class="linenr"> 592</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l593" href="#l593" class="linenr"> 593</a> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div class="pre"><a id="l594" href="#l594" class="linenr"> 594</a> ;;&nbsp;End&nbsp;of&nbsp;BrokenAwardHack&nbsp;----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10-nov-2002&nbsp;Knut_Petersen@t-online.de</div>
<div class="pre"><a id="l595" href="#l595" class="linenr"> 595</a> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</div>
<div class="pre"><a id="l596" href="#l596" class="linenr"> 596</a> </div>
<div class="pre"><a id="l597" href="#l597" class="linenr"> 597</a> </div>
<div class="pre"><a id="l598" href="#l598" class="linenr"> 598</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;INT&nbsp;13h,&nbsp;AX=4B01h,&nbsp;DL=&lt;passed&nbsp;in&nbsp;value&gt;&nbsp;failed.</div>
<div class="pre"><a id="l599" href="#l599" class="linenr"> 599</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Try&nbsp;to&nbsp;scan&nbsp;the&nbsp;entire&nbsp;80h-FFh&nbsp;from&nbsp;the&nbsp;end.</div>
<div class="pre"><a id="l600" href="#l600" class="linenr"> 600</a> </div>
<div class="pre"><a id="l601" href="#l601" class="linenr"> 601</a> spec_query_failed:</div>
<div class="pre"><a id="l602" href="#l602" class="linenr"> 602</a> </div>
<div class="pre"><a id="l603" href="#l603" class="linenr"> 603</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;some&nbsp;code&nbsp;moved&nbsp;to&nbsp;BrokenAwardHack</div>
<div class="pre"><a id="l604" href="#l604" class="linenr"> 604</a> </div>
<div class="pre"><a id="l605" href="#l605" class="linenr"> 605</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,0FFh</div>
<div class="pre"><a id="l606" href="#l606" class="linenr"> 606</a> .test_loop:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pusha</div>
<div class="pre"><a id="l607" href="#l607" class="linenr"> 607</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,4B01h</div>
<div class="pre"><a id="l608" href="#l608" class="linenr"> 608</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,spec_packet</div>
<div class="pre"><a id="l609" href="#l609" class="linenr"> 609</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[si],13h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Size&nbsp;of&nbsp;buffer</div>
<div class="pre"><a id="l610" href="#l610" class="linenr"> 610</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;int13</div>
<div class="pre"><a id="l611" href="#l611" class="linenr"> 611</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popa</div>
<div class="pre"><a id="l612" href="#l612" class="linenr"> 612</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jc&nbsp;.still_broken</div>
<div class="pre"><a id="l613" href="#l613" class="linenr"> 613</a> </div>
<div class="pre"><a id="l614" href="#l614" class="linenr"> 614</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,maybe_msg</div>
<div class="pre"><a id="l615" href="#l615" class="linenr"> 615</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l616" href="#l616" class="linenr"> 616</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,dl</div>
<div class="pre"><a id="l617" href="#l617" class="linenr"> 617</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex2</div>
<div class="pre"><a id="l618" href="#l618" class="linenr"> 618</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l619" href="#l619" class="linenr"> 619</a> </div>
<div class="pre"><a id="l620" href="#l620" class="linenr"> 620</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;byte&nbsp;[sp_drive],dl</div>
<div class="pre"><a id="l621" href="#l621" class="linenr"> 621</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;.maybe_broken</div>
<div class="pre"><a id="l622" href="#l622" class="linenr"> 622</a> </div>
<div class="pre"><a id="l623" href="#l623" class="linenr"> 623</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Okay,&nbsp;good&nbsp;enough...</div>
<div class="pre"><a id="l624" href="#l624" class="linenr"> 624</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,alright_msg</div>
<div class="pre"><a id="l625" href="#l625" class="linenr"> 625</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l626" href="#l626" class="linenr"> 626</a> .found_drive0:&nbsp;&nbsp;mov&nbsp;[DriveNumber],dl</div>
<div class="pre"><a id="l627" href="#l627" class="linenr"> 627</a> .found_drive:&nbsp;&nbsp;&nbsp;jmp&nbsp;found_drive</div>
<div class="pre"><a id="l628" href="#l628" class="linenr"> 628</a> </div>
<div class="pre"><a id="l629" href="#l629" class="linenr"> 629</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Award&nbsp;BIOS&nbsp;4.51&nbsp;apparently&nbsp;passes&nbsp;garbage&nbsp;in&nbsp;sp_drive,</div>
<div class="pre"><a id="l630" href="#l630" class="linenr"> 630</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;but&nbsp;if&nbsp;this&nbsp;was&nbsp;the&nbsp;drive&nbsp;number&nbsp;originally&nbsp;passed&nbsp;in</div>
<div class="pre"><a id="l631" href="#l631" class="linenr"> 631</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;DL&nbsp;then&nbsp;consider&nbsp;it&nbsp;&quot;good&nbsp;enough&quot;</div>
<div class="pre"><a id="l632" href="#l632" class="linenr"> 632</a> .maybe_broken:</div>
<div class="pre"><a id="l633" href="#l633" class="linenr"> 633</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,[DriveNumber]</div>
<div class="pre"><a id="l634" href="#l634" class="linenr"> 634</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,dl</div>
<div class="pre"><a id="l635" href="#l635" class="linenr"> 635</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.found_drive</div>
<div class="pre"><a id="l636" href="#l636" class="linenr"> 636</a> </div>
<div class="pre"><a id="l637" href="#l637" class="linenr"> 637</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Intel&nbsp;Classic&nbsp;R+&nbsp;computer&nbsp;with&nbsp;Adaptec&nbsp;1542CP&nbsp;BIOS&nbsp;1.02</div>
<div class="pre"><a id="l638" href="#l638" class="linenr"> 638</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;passes&nbsp;garbage&nbsp;in&nbsp;sp_drive,&nbsp;and&nbsp;the&nbsp;drive&nbsp;number&nbsp;originally</div>
<div class="pre"><a id="l639" href="#l639" class="linenr"> 639</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;passed&nbsp;in&nbsp;DL&nbsp;does&nbsp;not&nbsp;have&nbsp;80h&nbsp;bit&nbsp;set.</div>
<div class="pre"><a id="l640" href="#l640" class="linenr"> 640</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;al,80h</div>
<div class="pre"><a id="l641" href="#l641" class="linenr"> 641</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,dl</div>
<div class="pre"><a id="l642" href="#l642" class="linenr"> 642</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.found_drive0</div>
<div class="pre"><a id="l643" href="#l643" class="linenr"> 643</a> </div>
<div class="pre"><a id="l644" href="#l644" class="linenr"> 644</a> .still_broken:&nbsp;&nbsp;dec&nbsp;dx</div>
<div class="pre"><a id="l645" href="#l645" class="linenr"> 645</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;dl,&nbsp;80h</div>
<div class="pre"><a id="l646" href="#l646" class="linenr"> 646</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnb&nbsp;.test_loop</div>
<div class="pre"><a id="l647" href="#l647" class="linenr"> 647</a> </div>
<div class="pre"><a id="l648" href="#l648" class="linenr"> 648</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;No&nbsp;spec&nbsp;packet&nbsp;anywhere.&nbsp;&nbsp;Some&nbsp;particularly&nbsp;pathetic</div>
<div class="pre"><a id="l649" href="#l649" class="linenr"> 649</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;BIOSes&nbsp;apparently&nbsp;don&#39;t&nbsp;even&nbsp;implement&nbsp;function</div>
<div class="pre"><a id="l650" href="#l650" class="linenr"> 650</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;4B01h,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;query&nbsp;a&nbsp;spec&nbsp;packet&nbsp;no&nbsp;matter</div>
<div class="pre"><a id="l651" href="#l651" class="linenr"> 651</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;what.&nbsp;&nbsp;If&nbsp;we&nbsp;got&nbsp;a&nbsp;drive&nbsp;number&nbsp;in&nbsp;DL,&nbsp;then&nbsp;try&nbsp;to</div>
<div class="pre"><a id="l652" href="#l652" class="linenr"> 652</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;use&nbsp;it,&nbsp;and&nbsp;if&nbsp;it&nbsp;works,&nbsp;then&nbsp;well...</div>
<div class="pre"><a id="l653" href="#l653" class="linenr"> 653</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l654" href="#l654" class="linenr"> 654</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;dl,81h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Should&nbsp;be&nbsp;81-FF&nbsp;at&nbsp;least</div>
<div class="pre"><a id="l655" href="#l655" class="linenr"> 655</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jb&nbsp;fatal_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;If&nbsp;not,&nbsp;it&#39;s&nbsp;hopeless</div>
<div class="pre"><a id="l656" href="#l656" class="linenr"> 656</a> </div>
<div class="pre"><a id="l657" href="#l657" class="linenr"> 657</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Write&nbsp;a&nbsp;warning&nbsp;to&nbsp;indicate&nbsp;we&#39;re&nbsp;on&nbsp;*very*&nbsp;thin&nbsp;ice&nbsp;now</div>
<div class="pre"><a id="l658" href="#l658" class="linenr"> 658</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,nospec_msg</div>
<div class="pre"><a id="l659" href="#l659" class="linenr"> 659</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l660" href="#l660" class="linenr"> 660</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,dl</div>
<div class="pre"><a id="l661" href="#l661" class="linenr"> 661</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex2</div>
<div class="pre"><a id="l662" href="#l662" class="linenr"> 662</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l663" href="#l663" class="linenr"> 663</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,trysbm_msg</div>
<div class="pre"><a id="l664" href="#l664" class="linenr"> 664</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l665" href="#l665" class="linenr"> 665</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;.found_drive&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Pray&nbsp;that&nbsp;this&nbsp;works...</div>
<div class="pre"><a id="l666" href="#l666" class="linenr"> 666</a> </div>
<div class="pre"><a id="l667" href="#l667" class="linenr"> 667</a> fatal_error:</div>
<div class="pre"><a id="l668" href="#l668" class="linenr"> 668</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,nothing_msg</div>
<div class="pre"><a id="l669" href="#l669" class="linenr"> 669</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l670" href="#l670" class="linenr"> 670</a> </div>
<div class="pre"><a id="l671" href="#l671" class="linenr"> 671</a> .norge:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;short&nbsp;.norge</div>
<div class="pre"><a id="l672" href="#l672" class="linenr"> 672</a> </div>
<div class="pre"><a id="l673" href="#l673" class="linenr"> 673</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Information&nbsp;message&nbsp;(DS:SI)&nbsp;output</div>
<div class="pre"><a id="l674" href="#l674" class="linenr"> 674</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Prefix&nbsp;with&nbsp;&quot;isolinux:&nbsp;&quot;</div>
<div class="pre"><a id="l675" href="#l675" class="linenr"> 675</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l676" href="#l676" class="linenr"> 676</a> writemsg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ax</div>
<div class="pre"><a id="l677" href="#l677" class="linenr"> 677</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;si</div>
<div class="pre"><a id="l678" href="#l678" class="linenr"> 678</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,isolinux_str</div>
<div class="pre"><a id="l679" href="#l679" class="linenr"> 679</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr_early</div>
<div class="pre"><a id="l680" href="#l680" class="linenr"> 680</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;si</div>
<div class="pre"><a id="l681" href="#l681" class="linenr"> 681</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr_early</div>
<div class="pre"><a id="l682" href="#l682" class="linenr"> 682</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ax</div>
<div class="pre"><a id="l683" href="#l683" class="linenr"> 683</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l684" href="#l684" class="linenr"> 684</a> </div>
<div class="pre"><a id="l685" href="#l685" class="linenr"> 685</a> ;</div>
<div class="pre"><a id="l686" href="#l686" class="linenr"> 686</a> ;&nbsp;Write&nbsp;a&nbsp;character&nbsp;to&nbsp;the&nbsp;screen.&nbsp;&nbsp;There&nbsp;is&nbsp;a&nbsp;more&nbsp;&quot;sophisticated&quot;</div>
<div class="pre"><a id="l687" href="#l687" class="linenr"> 687</a> ;&nbsp;version&nbsp;of&nbsp;this&nbsp;in&nbsp;the&nbsp;subsequent&nbsp;code,&nbsp;so&nbsp;we&nbsp;patch&nbsp;the&nbsp;pointer</div>
<div class="pre"><a id="l688" href="#l688" class="linenr"> 688</a> ;&nbsp;when&nbsp;appropriate.</div>
<div class="pre"><a id="l689" href="#l689" class="linenr"> 689</a> ;</div>
<div class="pre"><a id="l690" href="#l690" class="linenr"> 690</a> </div>
<div class="pre"><a id="l691" href="#l691" class="linenr"> 691</a> writechr:</div>
<div class="pre"><a id="l692" href="#l692" class="linenr"> 692</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;near&nbsp;writechr_simple&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;3-byte&nbsp;jump</div>
<div class="pre"><a id="l693" href="#l693" class="linenr"> 693</a> </div>
<div class="pre"><a id="l694" href="#l694" class="linenr"> 694</a> writechr_simple:</div>
<div class="pre"><a id="l695" href="#l695" class="linenr"> 695</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushfd</div>
<div class="pre"><a id="l696" href="#l696" class="linenr"> 696</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushad</div>
<div class="pre"><a id="l697" href="#l697" class="linenr"> 697</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,0Eh</div>
<div class="pre"><a id="l698" href="#l698" class="linenr"> 698</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;bx,bx</div>
<div class="pre"><a id="l699" href="#l699" class="linenr"> 699</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;10h</div>
<div class="pre"><a id="l700" href="#l700" class="linenr"> 700</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popad</div>
<div class="pre"><a id="l701" href="#l701" class="linenr"> 701</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popfd</div>
<div class="pre"><a id="l702" href="#l702" class="linenr"> 702</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l703" href="#l703" class="linenr"> 703</a> </div>
<div class="pre"><a id="l704" href="#l704" class="linenr"> 704</a> ;</div>
<div class="pre"><a id="l705" href="#l705" class="linenr"> 705</a> ;&nbsp;int13:&nbsp;save&nbsp;all&nbsp;the&nbsp;segment&nbsp;registers&nbsp;and&nbsp;call&nbsp;INT&nbsp;13h</div>
<div class="pre"><a id="l706" href="#l706" class="linenr"> 706</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Some&nbsp;CD-ROM&nbsp;BIOSes&nbsp;have&nbsp;been&nbsp;found&nbsp;to&nbsp;corrupt&nbsp;segment&nbsp;registers.</div>
<div class="pre"><a id="l707" href="#l707" class="linenr"> 707</a> ;</div>
<div class="pre"><a id="l708" href="#l708" class="linenr"> 708</a> int13:</div>
<div class="pre"><a id="l709" href="#l709" class="linenr"> 709</a> </div>
<div class="pre"><a id="l710" href="#l710" class="linenr"> 710</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ds</div>
<div class="pre"><a id="l711" href="#l711" class="linenr"> 711</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;es</div>
<div class="pre"><a id="l712" href="#l712" class="linenr"> 712</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;fs</div>
<div class="pre"><a id="l713" href="#l713" class="linenr"> 713</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;gs</div>
<div class="pre"><a id="l714" href="#l714" class="linenr"> 714</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;13h</div>
<div class="pre"><a id="l715" href="#l715" class="linenr"> 715</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;gs</div>
<div class="pre"><a id="l716" href="#l716" class="linenr"> 716</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;fs</div>
<div class="pre"><a id="l717" href="#l717" class="linenr"> 717</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;es</div>
<div class="pre"><a id="l718" href="#l718" class="linenr"> 718</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ds</div>
<div class="pre"><a id="l719" href="#l719" class="linenr"> 719</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l720" href="#l720" class="linenr"> 720</a> </div>
<div class="pre"><a id="l721" href="#l721" class="linenr"> 721</a> ;</div>
<div class="pre"><a id="l722" href="#l722" class="linenr"> 722</a> ;&nbsp;Get&nbsp;one&nbsp;sector.&nbsp;&nbsp;Convenience&nbsp;entry&nbsp;point.</div>
<div class="pre"><a id="l723" href="#l723" class="linenr"> 723</a> ;</div>
<div class="pre"><a id="l724" href="#l724" class="linenr"> 724</a> getonesec:</div>
<div class="pre"><a id="l725" href="#l725" class="linenr"> 725</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bp,1</div>
<div class="pre"><a id="l726" href="#l726" class="linenr"> 726</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Fall&nbsp;through&nbsp;to&nbsp;getlinsec</div>
<div class="pre"><a id="l727" href="#l727" class="linenr"> 727</a> </div>
<div class="pre"><a id="l728" href="#l728" class="linenr"> 728</a> ;</div>
<div class="pre"><a id="l729" href="#l729" class="linenr"> 729</a> ;&nbsp;Get&nbsp;linear&nbsp;sectors&nbsp;-&nbsp;EBIOS&nbsp;LBA&nbsp;addressing,&nbsp;2048-byte&nbsp;sectors.</div>
<div class="pre"><a id="l730" href="#l730" class="linenr"> 730</a> ;</div>
<div class="pre"><a id="l731" href="#l731" class="linenr"> 731</a> ;&nbsp;Input:</div>
<div class="pre"><a id="l732" href="#l732" class="linenr"> 732</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Linear&nbsp;sector&nbsp;number</div>
<div class="pre"><a id="l733" href="#l733" class="linenr"> 733</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ES:BX&nbsp;&nbsp;&nbsp;-&nbsp;Target&nbsp;buffer</div>
<div class="pre"><a id="l734" href="#l734" class="linenr"> 734</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Sector&nbsp;count</div>
<div class="pre"><a id="l735" href="#l735" class="linenr"> 735</a> ;</div>
<div class="pre"><a id="l736" href="#l736" class="linenr"> 736</a> getlinsec:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;word&nbsp;[cs:GetlinsecPtr]</div>
<div class="pre"><a id="l737" href="#l737" class="linenr"> 737</a> </div>
<div class="pre"><a id="l738" href="#l738" class="linenr"> 738</a> %ifndef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l739" href="#l739" class="linenr"> 739</a> </div>
<div class="pre"><a id="l740" href="#l740" class="linenr"> 740</a> ;</div>
<div class="pre"><a id="l741" href="#l741" class="linenr"> 741</a> ;&nbsp;First,&nbsp;the&nbsp;variants&nbsp;that&nbsp;we&nbsp;use&nbsp;when&nbsp;actually&nbsp;loading&nbsp;off&nbsp;a&nbsp;disk</div>
<div class="pre"><a id="l742" href="#l742" class="linenr"> 742</a> ;&nbsp;(hybrid&nbsp;mode.)&nbsp;&nbsp;These&nbsp;are&nbsp;adapted&nbsp;versions&nbsp;of&nbsp;the&nbsp;equivalent&nbsp;routines</div>
<div class="pre"><a id="l743" href="#l743" class="linenr"> 743</a> ;&nbsp;in&nbsp;ldlinux.asm.</div>
<div class="pre"><a id="l744" href="#l744" class="linenr"> 744</a> ;</div>
<div class="pre"><a id="l745" href="#l745" class="linenr"> 745</a> </div>
<div class="pre"><a id="l746" href="#l746" class="linenr"> 746</a> ;</div>
<div class="pre"><a id="l747" href="#l747" class="linenr"> 747</a> ;&nbsp;getlinsec_ebios:</div>
<div class="pre"><a id="l748" href="#l748" class="linenr"> 748</a> ;</div>
<div class="pre"><a id="l749" href="#l749" class="linenr"> 749</a> ;&nbsp;getlinsec&nbsp;implementation&nbsp;for&nbsp;floppy/HDD&nbsp;EBIOS&nbsp;(EDD)</div>
<div class="pre"><a id="l750" href="#l750" class="linenr"> 750</a> ;</div>
<div class="pre"><a id="l751" href="#l751" class="linenr"> 751</a> getlinsec_ebios:</div>
<div class="pre"><a id="l752" href="#l752" class="linenr"> 752</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;edx,edx</div>
<div class="pre"><a id="l753" href="#l753" class="linenr"> 753</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shld&nbsp;edx,eax,2</div>
<div class="pre"><a id="l754" href="#l754" class="linenr"> 754</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;eax,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;to&nbsp;HDD&nbsp;sectors</div>
<div class="pre"><a id="l755" href="#l755" class="linenr"> 755</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;eax,[bsHidden]</div>
<div class="pre"><a id="l756" href="#l756" class="linenr"> 756</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adc&nbsp;edx,[bsHidden+4]</div>
<div class="pre"><a id="l757" href="#l757" class="linenr"> 757</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;bp,2</div>
<div class="pre"><a id="l758" href="#l758" class="linenr"> 758</a> </div>
<div class="pre"><a id="l759" href="#l759" class="linenr"> 759</a> .loop:</div>
<div class="pre"><a id="l760" href="#l760" class="linenr"> 760</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sectors&nbsp;left</div>
<div class="pre"><a id="l761" href="#l761" class="linenr"> 761</a> .retry2:</div>
<div class="pre"><a id="l762" href="#l762" class="linenr"> 762</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;maxtrans&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Enforce&nbsp;maximum&nbsp;transfer&nbsp;size</div>
<div class="pre"><a id="l763" href="#l763" class="linenr"> 763</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;edi,bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sectors&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;read</div>
<div class="pre"><a id="l764" href="#l764" class="linenr"> 764</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,retry_count</div>
<div class="pre"><a id="l765" href="#l765" class="linenr"> 765</a> .retry:</div>
<div class="pre"><a id="l766" href="#l766" class="linenr"> 766</a> </div>
<div class="pre"><a id="l767" href="#l767" class="linenr"> 767</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Form&nbsp;DAPA&nbsp;on&nbsp;stack</div>
<div class="pre"><a id="l768" href="#l768" class="linenr"> 768</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;edx</div>
<div class="pre"><a id="l769" href="#l769" class="linenr"> 769</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;eax</div>
<div class="pre"><a id="l770" href="#l770" class="linenr"> 770</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;es</div>
<div class="pre"><a id="l771" href="#l771" class="linenr"> 771</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;bx</div>
<div class="pre"><a id="l772" href="#l772" class="linenr"> 772</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di</div>
<div class="pre"><a id="l773" href="#l773" class="linenr"> 773</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;word&nbsp;16</div>
<div class="pre"><a id="l774" href="#l774" class="linenr"> 774</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,sp</div>
<div class="pre"><a id="l775" href="#l775" class="linenr"> 775</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushad</div>
<div class="pre"><a id="l776" href="#l776" class="linenr"> 776</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l777" href="#l777" class="linenr"> 777</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ds</div>
<div class="pre"><a id="l778" href="#l778" class="linenr"> 778</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ss</div>
<div class="pre"><a id="l779" href="#l779" class="linenr"> 779</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;DS&nbsp;&lt;-&nbsp;SS</div>
<div class="pre"><a id="l780" href="#l780" class="linenr"> 780</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,42h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Extended&nbsp;Read</div>
<div class="pre"><a id="l781" href="#l781" class="linenr"> 781</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;13h</div>
<div class="pre"><a id="l782" href="#l782" class="linenr"> 782</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ds</div>
<div class="pre"><a id="l783" href="#l783" class="linenr"> 783</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popad</div>
<div class="pre"><a id="l784" href="#l784" class="linenr"> 784</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;sp,[si+16]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Remove&nbsp;DAPA</div>
<div class="pre"><a id="l785" href="#l785" class="linenr"> 785</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jc&nbsp;.error</div>
<div class="pre"><a id="l786" href="#l786" class="linenr"> 786</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;bp</div>
<div class="pre"><a id="l787" href="#l787" class="linenr"> 787</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;eax,edi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Advance&nbsp;sector&nbsp;pointer</div>
<div class="pre"><a id="l788" href="#l788" class="linenr"> 788</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adc&nbsp;edx,0</div>
<div class="pre"><a id="l789" href="#l789" class="linenr"> 789</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;bp,di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sectors&nbsp;left</div>
<div class="pre"><a id="l790" href="#l790" class="linenr"> 790</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;di,9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;512-byte&nbsp;sectors</div>
<div class="pre"><a id="l791" href="#l791" class="linenr"> 791</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;bx,di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Advance&nbsp;buffer&nbsp;pointer</div>
<div class="pre"><a id="l792" href="#l792" class="linenr"> 792</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;bp,bp</div>
<div class="pre"><a id="l793" href="#l793" class="linenr"> 793</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.loop</div>
<div class="pre"><a id="l794" href="#l794" class="linenr"> 794</a> </div>
<div class="pre"><a id="l795" href="#l795" class="linenr"> 795</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l796" href="#l796" class="linenr"> 796</a> </div>
<div class="pre"><a id="l797" href="#l797" class="linenr"> 797</a> .error:</div>
<div class="pre"><a id="l798" href="#l798" class="linenr"> 798</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Some&nbsp;systems&nbsp;seem&nbsp;to&nbsp;get&nbsp;&quot;stuck&quot;&nbsp;in&nbsp;an&nbsp;error&nbsp;state&nbsp;when</div>
<div class="pre"><a id="l799" href="#l799" class="linenr"> 799</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;using&nbsp;EBIOS.&nbsp;&nbsp;Doesn&#39;t&nbsp;happen&nbsp;when&nbsp;using&nbsp;CBIOS,&nbsp;which&nbsp;is</div>
<div class="pre"><a id="l800" href="#l800" class="linenr"> 800</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;good,&nbsp;since&nbsp;some&nbsp;other&nbsp;systems&nbsp;get&nbsp;timeout&nbsp;failures</div>
<div class="pre"><a id="l801" href="#l801" class="linenr"> 801</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;waiting&nbsp;for&nbsp;the&nbsp;floppy&nbsp;disk&nbsp;to&nbsp;spin&nbsp;up.</div>
<div class="pre"><a id="l802" href="#l802" class="linenr"> 802</a> </div>
<div class="pre"><a id="l803" href="#l803" class="linenr"> 803</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushad&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Try&nbsp;resetting&nbsp;the&nbsp;device</div>
<div class="pre"><a id="l804" href="#l804" class="linenr"> 804</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ax,ax</div>
<div class="pre"><a id="l805" href="#l805" class="linenr"> 805</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l806" href="#l806" class="linenr"> 806</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;13h</div>
<div class="pre"><a id="l807" href="#l807" class="linenr"> 807</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popad</div>
<div class="pre"><a id="l808" href="#l808" class="linenr"> 808</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;.retry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;CX--&nbsp;and&nbsp;jump&nbsp;if&nbsp;not&nbsp;zero</div>
<div class="pre"><a id="l809" href="#l809" class="linenr"> 809</a> </div>
<div class="pre"><a id="l810" href="#l810" class="linenr"> 810</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;shr&nbsp;word&nbsp;[MaxTransfer],1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Reduce&nbsp;the&nbsp;transfer&nbsp;size</div>
<div class="pre"><a id="l811" href="#l811" class="linenr"> 811</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;jnz&nbsp;.retry2</div>
<div class="pre"><a id="l812" href="#l812" class="linenr"> 812</a> </div>
<div class="pre"><a id="l813" href="#l813" class="linenr"> 813</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Total&nbsp;failure.&nbsp;&nbsp;Try&nbsp;falling&nbsp;back&nbsp;to&nbsp;CBIOS.</div>
<div class="pre"><a id="l814" href="#l814" class="linenr"> 814</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;word&nbsp;[GetlinsecPtr],&nbsp;getlinsec_cbios</div>
<div class="pre"><a id="l815" href="#l815" class="linenr"> 815</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;mov&nbsp;byte&nbsp;[MaxTransfer],63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;possibe&nbsp;CBIOS&nbsp;transfer</div>
<div class="pre"><a id="l816" href="#l816" class="linenr"> 816</a> </div>
<div class="pre"><a id="l817" href="#l817" class="linenr"> 817</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;bp</div>
<div class="pre"><a id="l818" href="#l818" class="linenr"> 818</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;getlinsec_cbios.loop</div>
<div class="pre"><a id="l819" href="#l819" class="linenr"> 819</a> </div>
<div class="pre"><a id="l820" href="#l820" class="linenr"> 820</a> ;</div>
<div class="pre"><a id="l821" href="#l821" class="linenr"> 821</a> ;&nbsp;getlinsec_cbios:</div>
<div class="pre"><a id="l822" href="#l822" class="linenr"> 822</a> ;</div>
<div class="pre"><a id="l823" href="#l823" class="linenr"> 823</a> ;&nbsp;getlinsec&nbsp;implementation&nbsp;for&nbsp;legacy&nbsp;CBIOS</div>
<div class="pre"><a id="l824" href="#l824" class="linenr"> 824</a> ;</div>
<div class="pre"><a id="l825" href="#l825" class="linenr"> 825</a> getlinsec_cbios:</div>
<div class="pre"><a id="l826" href="#l826" class="linenr"> 826</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;edx,edx</div>
<div class="pre"><a id="l827" href="#l827" class="linenr"> 827</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;eax,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;to&nbsp;HDD&nbsp;sectors</div>
<div class="pre"><a id="l828" href="#l828" class="linenr"> 828</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;eax,[bsHidden]</div>
<div class="pre"><a id="l829" href="#l829" class="linenr"> 829</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;bp,2</div>
<div class="pre"><a id="l830" href="#l830" class="linenr"> 830</a> </div>
<div class="pre"><a id="l831" href="#l831" class="linenr"> 831</a> .loop:</div>
<div class="pre"><a id="l832" href="#l832" class="linenr"> 832</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;edx</div>
<div class="pre"><a id="l833" href="#l833" class="linenr"> 833</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;eax</div>
<div class="pre"><a id="l834" href="#l834" class="linenr"> 834</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;bp</div>
<div class="pre"><a id="l835" href="#l835" class="linenr"> 835</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;bx</div>
<div class="pre"><a id="l836" href="#l836" class="linenr"> 836</a> </div>
<div class="pre"><a id="l837" href="#l837" class="linenr"> 837</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;esi,word&nbsp;[bsSecPerTrack]</div>
<div class="pre"><a id="l838" href="#l838" class="linenr"> 838</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;edi,word&nbsp;[bsHeads]</div>
<div class="pre"><a id="l839" href="#l839" class="linenr"> 839</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l840" href="#l840" class="linenr"> 840</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Dividing&nbsp;by&nbsp;sectors&nbsp;to&nbsp;get&nbsp;(track,sector):&nbsp;we&nbsp;may&nbsp;have</div>
<div class="pre"><a id="l841" href="#l841" class="linenr"> 841</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;up&nbsp;to&nbsp;2^18&nbsp;tracks,&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;use&nbsp;32-bit&nbsp;arithmetric.</div>
<div class="pre"><a id="l842" href="#l842" class="linenr"> 842</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l843" href="#l843" class="linenr"> 843</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;div&nbsp;esi</div>
<div class="pre"><a id="l844" href="#l844" class="linenr"> 844</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;cx,cx</div>
<div class="pre"><a id="l845" href="#l845" class="linenr"> 845</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;cx,dx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;CX&nbsp;&lt;-&nbsp;sector&nbsp;index&nbsp;(0-based)</div>
<div class="pre"><a id="l846" href="#l846" class="linenr"> 846</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;EDX&nbsp;&lt;-&nbsp;0</div>
<div class="pre"><a id="l847" href="#l847" class="linenr"> 847</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;eax&nbsp;=&nbsp;track&nbsp;#</div>
<div class="pre"><a id="l848" href="#l848" class="linenr"> 848</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;div&nbsp;edi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;track&nbsp;to&nbsp;head/cyl</div>
<div class="pre"><a id="l849" href="#l849" class="linenr"> 849</a> </div>
<div class="pre"><a id="l850" href="#l850" class="linenr"> 850</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;We&nbsp;should&nbsp;test&nbsp;this,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;fit...</div>
<div class="pre"><a id="l851" href="#l851" class="linenr"> 851</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;cmp&nbsp;eax,1023</div>
<div class="pre"><a id="l852" href="#l852" class="linenr"> 852</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ja&nbsp;.error</div>
<div class="pre"><a id="l853" href="#l853" class="linenr"> 853</a> </div>
<div class="pre"><a id="l854" href="#l854" class="linenr"> 854</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l855" href="#l855" class="linenr"> 855</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Now&nbsp;we&nbsp;have&nbsp;AX&nbsp;=&nbsp;cyl,&nbsp;DX&nbsp;=&nbsp;head,&nbsp;CX&nbsp;=&nbsp;sector&nbsp;(0-based),</div>
<div class="pre"><a id="l856" href="#l856" class="linenr"> 856</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;BP&nbsp;=&nbsp;sectors&nbsp;to&nbsp;transfer,&nbsp;SI&nbsp;=&nbsp;bsSecPerTrack,</div>
<div class="pre"><a id="l857" href="#l857" class="linenr"> 857</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ES:BX&nbsp;=&nbsp;data&nbsp;target</div>
<div class="pre"><a id="l858" href="#l858" class="linenr"> 858</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div>
<div class="pre"><a id="l859" href="#l859" class="linenr"> 859</a> </div>
<div class="pre"><a id="l860" href="#l860" class="linenr"> 860</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;maxtrans&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Enforce&nbsp;maximum&nbsp;transfer&nbsp;size</div>
<div class="pre"><a id="l861" href="#l861" class="linenr"> 861</a> </div>
<div class="pre"><a id="l862" href="#l862" class="linenr"> 862</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Must&nbsp;not&nbsp;cross&nbsp;track&nbsp;boundaries,&nbsp;so&nbsp;BP&nbsp;&lt;=&nbsp;SI-CX</div>
<div class="pre"><a id="l863" href="#l863" class="linenr"> 863</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;si,cx</div>
<div class="pre"><a id="l864" href="#l864" class="linenr"> 864</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;bp,si</div>
<div class="pre"><a id="l865" href="#l865" class="linenr"> 865</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jna&nbsp;.bp_ok</div>
<div class="pre"><a id="l866" href="#l866" class="linenr"> 866</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bp,si</div>
<div class="pre"><a id="l867" href="#l867" class="linenr"> 867</a> .bp_ok:</div>
<div class="pre"><a id="l868" href="#l868" class="linenr"> 868</a> </div>
<div class="pre"><a id="l869" href="#l869" class="linenr"> 869</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;ah,6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Because&nbsp;IBM&nbsp;was&nbsp;STOOPID</div>
<div class="pre"><a id="l870" href="#l870" class="linenr"> 870</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;and&nbsp;thought&nbsp;8&nbsp;bits&nbsp;were&nbsp;enough</div>
<div class="pre"><a id="l871" href="#l871" class="linenr"> 871</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;then&nbsp;thought&nbsp;10&nbsp;bits&nbsp;were&nbsp;enough...</div>
<div class="pre"><a id="l872" href="#l872" class="linenr"> 872</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;cx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sector&nbsp;numbers&nbsp;are&nbsp;1-based,&nbsp;sigh</div>
<div class="pre"><a id="l873" href="#l873" class="linenr"> 873</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;cl,ah</div>
<div class="pre"><a id="l874" href="#l874" class="linenr"> 874</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ch,al</div>
<div class="pre"><a id="l875" href="#l875" class="linenr"> 875</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dh,dl</div>
<div class="pre"><a id="l876" href="#l876" class="linenr"> 876</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l877" href="#l877" class="linenr"> 877</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;ax,bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sector&nbsp;to&nbsp;transfer&nbsp;count</div>
<div class="pre"><a id="l878" href="#l878" class="linenr"> 878</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,02h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Read&nbsp;sectors</div>
<div class="pre"><a id="l879" href="#l879" class="linenr"> 879</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bp,retry_count</div>
<div class="pre"><a id="l880" href="#l880" class="linenr"> 880</a> .retry:</div>
<div class="pre"><a id="l881" href="#l881" class="linenr"> 881</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushad</div>
<div class="pre"><a id="l882" href="#l882" class="linenr"> 882</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;13h</div>
<div class="pre"><a id="l883" href="#l883" class="linenr"> 883</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popad</div>
<div class="pre"><a id="l884" href="#l884" class="linenr"> 884</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jc&nbsp;.error</div>
<div class="pre"><a id="l885" href="#l885" class="linenr"> 885</a> .resume:</div>
<div class="pre"><a id="l886" href="#l886" class="linenr"> 886</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;ecx,al&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ECX&nbsp;&lt;-&nbsp;sectors&nbsp;transferred</div>
<div class="pre"><a id="l887" href="#l887" class="linenr"> 887</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;ax,9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;sectors&nbsp;in&nbsp;AL&nbsp;to&nbsp;bytes&nbsp;in&nbsp;AX</div>
<div class="pre"><a id="l888" href="#l888" class="linenr"> 888</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;bx</div>
<div class="pre"><a id="l889" href="#l889" class="linenr"> 889</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;bx,ax</div>
<div class="pre"><a id="l890" href="#l890" class="linenr"> 890</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;bp</div>
<div class="pre"><a id="l891" href="#l891" class="linenr"> 891</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;eax</div>
<div class="pre"><a id="l892" href="#l892" class="linenr"> 892</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;edx</div>
<div class="pre"><a id="l893" href="#l893" class="linenr"> 893</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;eax,ecx</div>
<div class="pre"><a id="l894" href="#l894" class="linenr"> 894</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;bp,cx</div>
<div class="pre"><a id="l895" href="#l895" class="linenr"> 895</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.loop</div>
<div class="pre"><a id="l896" href="#l896" class="linenr"> 896</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l897" href="#l897" class="linenr"> 897</a> </div>
<div class="pre"><a id="l898" href="#l898" class="linenr"> 898</a> .error:</div>
<div class="pre"><a id="l899" href="#l899" class="linenr"> 899</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;bp</div>
<div class="pre"><a id="l900" href="#l900" class="linenr"> 900</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.retry</div>
<div class="pre"><a id="l901" href="#l901" class="linenr"> 901</a> </div>
<div class="pre"><a id="l902" href="#l902" class="linenr"> 902</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;ax,bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sectors&nbsp;transferred&nbsp;&lt;-&nbsp;0</div>
<div class="pre"><a id="l903" href="#l903" class="linenr"> 903</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr&nbsp;word&nbsp;[MaxTransfer],1</div>
<div class="pre"><a id="l904" href="#l904" class="linenr"> 904</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.resume</div>
<div class="pre"><a id="l905" href="#l905" class="linenr"> 905</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;disk_error</div>
<div class="pre"><a id="l906" href="#l906" class="linenr"> 906</a> </div>
<div class="pre"><a id="l907" href="#l907" class="linenr"> 907</a> ;</div>
<div class="pre"><a id="l908" href="#l908" class="linenr"> 908</a> ;&nbsp;Truncate&nbsp;BP&nbsp;to&nbsp;MaxTransfer</div>
<div class="pre"><a id="l909" href="#l909" class="linenr"> 909</a> ;</div>
<div class="pre"><a id="l910" href="#l910" class="linenr"> 910</a> maxtrans:</div>
<div class="pre"><a id="l911" href="#l911" class="linenr"> 911</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;bp,[MaxTransfer]</div>
<div class="pre"><a id="l912" href="#l912" class="linenr"> 912</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jna&nbsp;.ok</div>
<div class="pre"><a id="l913" href="#l913" class="linenr"> 913</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bp,[MaxTransfer]</div>
<div class="pre"><a id="l914" href="#l914" class="linenr"> 914</a> .ok:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l915" href="#l915" class="linenr"> 915</a> </div>
<div class="pre"><a id="l916" href="#l916" class="linenr"> 916</a> %endif</div>
<div class="pre"><a id="l917" href="#l917" class="linenr"> 917</a> </div>
<div class="pre"><a id="l918" href="#l918" class="linenr"> 918</a> ;</div>
<div class="pre"><a id="l919" href="#l919" class="linenr"> 919</a> ;&nbsp;This&nbsp;is&nbsp;the&nbsp;variant&nbsp;we&nbsp;use&nbsp;for&nbsp;real&nbsp;CD-ROMs:</div>
<div class="pre"><a id="l920" href="#l920" class="linenr"> 920</a> ;&nbsp;LBA,&nbsp;2K&nbsp;sectors,&nbsp;some&nbsp;special&nbsp;error&nbsp;handling.</div>
<div class="pre"><a id="l921" href="#l921" class="linenr"> 921</a> ;</div>
<div class="pre"><a id="l922" href="#l922" class="linenr"> 922</a> getlinsec_cdrom:</div>
<div class="pre"><a id="l923" href="#l923" class="linenr"> 923</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,dapa&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load&nbsp;up&nbsp;the&nbsp;DAPA</div>
<div class="pre"><a id="l924" href="#l924" class="linenr"> 924</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[si+4],bx</div>
<div class="pre"><a id="l925" href="#l925" class="linenr"> 925</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[si+6],es</div>
<div class="pre"><a id="l926" href="#l926" class="linenr"> 926</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[si+8],eax</div>
<div class="pre"><a id="l927" href="#l927" class="linenr"> 927</a> .loop:</div>
<div class="pre"><a id="l928" href="#l928" class="linenr"> 928</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;bp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sectors&nbsp;left</div>
<div class="pre"><a id="l929" href="#l929" class="linenr"> 929</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;bp,[MaxTransferCD]</div>
<div class="pre"><a id="l930" href="#l930" class="linenr"> 930</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbe&nbsp;.bp_ok</div>
<div class="pre"><a id="l931" href="#l931" class="linenr"> 931</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bp,[MaxTransferCD]</div>
<div class="pre"><a id="l932" href="#l932" class="linenr"> 932</a> .bp_ok:</div>
<div class="pre"><a id="l933" href="#l933" class="linenr"> 933</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[si+2],bp</div>
<div class="pre"><a id="l934" href="#l934" class="linenr"> 934</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;si</div>
<div class="pre"><a id="l935" href="#l935" class="linenr"> 935</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l936" href="#l936" class="linenr"> 936</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,42h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Extended&nbsp;Read</div>
<div class="pre"><a id="l937" href="#l937" class="linenr"> 937</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;xint13</div>
<div class="pre"><a id="l938" href="#l938" class="linenr"> 938</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;si</div>
<div class="pre"><a id="l939" href="#l939" class="linenr"> 939</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;bp</div>
<div class="pre"><a id="l940" href="#l940" class="linenr"> 940</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;eax,word&nbsp;[si+2]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sectors&nbsp;we&nbsp;read</div>
<div class="pre"><a id="l941" href="#l941" class="linenr"> 941</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;[si+8],eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Advance&nbsp;sector&nbsp;pointer</div>
<div class="pre"><a id="l942" href="#l942" class="linenr"> 942</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;bp,ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sectors&nbsp;left</div>
<div class="pre"><a id="l943" href="#l943" class="linenr"> 943</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;ax,SECTOR_SHIFT-4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;2048-byte&nbsp;sectors&nbsp;-&gt;&nbsp;segment</div>
<div class="pre"><a id="l944" href="#l944" class="linenr"> 944</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;[si+6],ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Advance&nbsp;buffer&nbsp;pointer</div>
<div class="pre"><a id="l945" href="#l945" class="linenr"> 945</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;bp,bp</div>
<div class="pre"><a id="l946" href="#l946" class="linenr"> 946</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.loop</div>
<div class="pre"><a id="l947" href="#l947" class="linenr"> 947</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+8]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Next&nbsp;sector</div>
<div class="pre"><a id="l948" href="#l948" class="linenr"> 948</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l949" href="#l949" class="linenr"> 949</a> </div>
<div class="pre"><a id="l950" href="#l950" class="linenr"> 950</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;INT&nbsp;13h&nbsp;with&nbsp;retry</div>
<div class="pre"><a id="l951" href="#l951" class="linenr"> 951</a> xint13:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[RetryCount],retry_count</div>
<div class="pre"><a id="l952" href="#l952" class="linenr"> 952</a> .try:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushad</div>
<div class="pre"><a id="l953" href="#l953" class="linenr"> 953</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;int13</div>
<div class="pre"><a id="l954" href="#l954" class="linenr"> 954</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jc&nbsp;.error</div>
<div class="pre"><a id="l955" href="#l955" class="linenr"> 955</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;sp,byte&nbsp;8*4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Clean&nbsp;up&nbsp;stack</div>
<div class="pre"><a id="l956" href="#l956" class="linenr"> 956</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l957" href="#l957" class="linenr"> 957</a> .error:</div>
<div class="pre"><a id="l958" href="#l958" class="linenr"> 958</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[DiskError],ah&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Save&nbsp;error&nbsp;code</div>
<div class="pre"><a id="l959" href="#l959" class="linenr"> 959</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popad</div>
<div class="pre"><a id="l960" href="#l960" class="linenr"> 960</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[DiskSys],ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Save&nbsp;system&nbsp;call&nbsp;number</div>
<div class="pre"><a id="l961" href="#l961" class="linenr"> 961</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;byte&nbsp;[RetryCount]</div>
<div class="pre"><a id="l962" href="#l962" class="linenr"> 962</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.real_error</div>
<div class="pre"><a id="l963" href="#l963" class="linenr"> 963</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ax</div>
<div class="pre"><a id="l964" href="#l964" class="linenr"> 964</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,[RetryCount]</div>
<div class="pre"><a id="l965" href="#l965" class="linenr"> 965</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,[dapa+2]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sector&nbsp;transfer&nbsp;count</div>
<div class="pre"><a id="l966" href="#l966" class="linenr"> 966</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Only&nbsp;2&nbsp;attempts&nbsp;left</div>
<div class="pre"><a id="l967" href="#l967" class="linenr"> 967</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ja&nbsp;.nodanger</div>
<div class="pre"><a id="l968" href="#l968" class="linenr"> 968</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Drop&nbsp;transfer&nbsp;size&nbsp;to&nbsp;1</div>
<div class="pre"><a id="l969" href="#l969" class="linenr"> 969</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;short&nbsp;.setsize</div>
<div class="pre"><a id="l970" href="#l970" class="linenr"> 970</a> .nodanger:</div>
<div class="pre"><a id="l971" href="#l971" class="linenr"> 971</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,retry_count-2</div>
<div class="pre"><a id="l972" href="#l972" class="linenr"> 972</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ja&nbsp;.again&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;First&nbsp;time,&nbsp;just&nbsp;try&nbsp;again</div>
<div class="pre"><a id="l973" href="#l973" class="linenr"> 973</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr&nbsp;ah,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Otherwise,&nbsp;try&nbsp;to&nbsp;reduce</div>
<div class="pre"><a id="l974" href="#l974" class="linenr"> 974</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adc&nbsp;ah,0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;the&nbsp;max&nbsp;transfer&nbsp;size,&nbsp;but&nbsp;not&nbsp;to&nbsp;0</div>
<div class="pre"><a id="l975" href="#l975" class="linenr"> 975</a> .setsize:</div>
<div class="pre"><a id="l976" href="#l976" class="linenr"> 976</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[MaxTransferCD],ah</div>
<div class="pre"><a id="l977" href="#l977" class="linenr"> 977</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[dapa+2],ah</div>
<div class="pre"><a id="l978" href="#l978" class="linenr"> 978</a> .again:</div>
<div class="pre"><a id="l979" href="#l979" class="linenr"> 979</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ax</div>
<div class="pre"><a id="l980" href="#l980" class="linenr"> 980</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;.try</div>
<div class="pre"><a id="l981" href="#l981" class="linenr"> 981</a> </div>
<div class="pre"><a id="l982" href="#l982" class="linenr"> 982</a> .real_error:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,diskerr_msg</div>
<div class="pre"><a id="l983" href="#l983" class="linenr"> 983</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l984" href="#l984" class="linenr"> 984</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,[DiskError]</div>
<div class="pre"><a id="l985" href="#l985" class="linenr"> 985</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex2</div>
<div class="pre"><a id="l986" href="#l986" class="linenr"> 986</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,oncall_str</div>
<div class="pre"><a id="l987" href="#l987" class="linenr"> 987</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr_early</div>
<div class="pre"><a id="l988" href="#l988" class="linenr"> 988</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,[DiskSys]</div>
<div class="pre"><a id="l989" href="#l989" class="linenr"> 989</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex4</div>
<div class="pre"><a id="l990" href="#l990" class="linenr"> 990</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,ondrive_str</div>
<div class="pre"><a id="l991" href="#l991" class="linenr"> 991</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr_early</div>
<div class="pre"><a id="l992" href="#l992" class="linenr"> 992</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,dl</div>
<div class="pre"><a id="l993" href="#l993" class="linenr"> 993</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex2</div>
<div class="pre"><a id="l994" href="#l994" class="linenr"> 994</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l995" href="#l995" class="linenr"> 995</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Fall&nbsp;through&nbsp;to&nbsp;kaboom</div>
<div class="pre"><a id="l996" href="#l996" class="linenr"> 996</a> </div>
<div class="pre"><a id="l997" href="#l997" class="linenr"> 997</a> ;</div>
<div class="pre"><a id="l998" href="#l998" class="linenr"> 998</a> ;&nbsp;kaboom:&nbsp;write&nbsp;a&nbsp;message&nbsp;and&nbsp;bail&nbsp;out.&nbsp;&nbsp;Wait&nbsp;for&nbsp;a&nbsp;user&nbsp;keypress,</div>
<div class="pre"><a id="l999" href="#l999" class="linenr"> 999</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;do&nbsp;a&nbsp;hard&nbsp;reboot.</div>
<div class="pre"><a id="l1000" href="#l1000" class="linenr">1000</a> ;</div>
<div class="pre"><a id="l1001" href="#l1001" class="linenr">1001</a> disk_error:</div>
<div class="pre"><a id="l1002" href="#l1002" class="linenr">1002</a> kaboom:</div>
<div class="pre"><a id="l1003" href="#l1003" class="linenr">1003</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RESET_STACK_AND_SEGS&nbsp;AX</div>
<div class="pre"><a id="l1004" href="#l1004" class="linenr">1004</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,err_bootfailed</div>
<div class="pre"><a id="l1005" href="#l1005" class="linenr">1005</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr</div>
<div class="pre"><a id="l1006" href="#l1006" class="linenr">1006</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getchar</div>
<div class="pre"><a id="l1007" href="#l1007" class="linenr">1007</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cli</div>
<div class="pre"><a id="l1008" href="#l1008" class="linenr">1008</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;word&nbsp;[BIOS_magic],0&nbsp;;&nbsp;Cold&nbsp;reboot</div>
<div class="pre"><a id="l1009" href="#l1009" class="linenr">1009</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;0F000h:0FFF0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Reset&nbsp;vector&nbsp;address</div>
<div class="pre"><a id="l1010" href="#l1010" class="linenr">1010</a> </div>
<div class="pre"><a id="l1011" href="#l1011" class="linenr">1011</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1012" href="#l1012" class="linenr">1012</a> ;&nbsp;&nbsp;Common&nbsp;modules&nbsp;needed&nbsp;in&nbsp;the&nbsp;first&nbsp;sector</div>
<div class="pre"><a id="l1013" href="#l1013" class="linenr">1013</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1014" href="#l1014" class="linenr">1014</a> </div>
<div class="pre"><a id="l1015" href="#l1015" class="linenr">1015</a> %include&nbsp;&quot;writestr.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;String&nbsp;output</div>
<div class="pre"><a id="l1016" href="#l1016" class="linenr">1016</a> writestr_early&nbsp;&nbsp;equ&nbsp;writestr</div>
<div class="pre"><a id="l1017" href="#l1017" class="linenr">1017</a> %include&nbsp;&quot;writehex.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Hexadecimal&nbsp;output</div>
<div class="pre"><a id="l1018" href="#l1018" class="linenr">1018</a> </div>
<div class="pre"><a id="l1019" href="#l1019" class="linenr">1019</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1020" href="#l1020" class="linenr">1020</a> ;&nbsp;Data&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;first&nbsp;sector</div>
<div class="pre"><a id="l1021" href="#l1021" class="linenr">1021</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1022" href="#l1022" class="linenr">1022</a> </div>
<div class="pre"><a id="l1023" href="#l1023" class="linenr">1023</a> syslinux_banner&nbsp;db&nbsp;CR,&nbsp;LF,&nbsp;&#39;ISOLINUX&nbsp;&#39;,&nbsp;VERSION_STR,&nbsp;&#39;&nbsp;&#39;,&nbsp;DATE_STR,&nbsp;&#39;&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1024" href="#l1024" class="linenr">1024</a> copyright_str&nbsp;&nbsp;&nbsp;db&nbsp;&#39;&nbsp;Copyright&nbsp;(C)&nbsp;1994-&#39;</div>
<div class="pre"><a id="l1025" href="#l1025" class="linenr">1025</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;asciidec&nbsp;YEAR</div>
<div class="pre"><a id="l1026" href="#l1026" class="linenr">1026</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;&nbsp;H.&nbsp;Peter&nbsp;Anvin&nbsp;et&nbsp;al&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1027" href="#l1027" class="linenr">1027</a> isolinux_str&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;isolinux:&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1028" href="#l1028" class="linenr">1028</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1029" href="#l1029" class="linenr">1029</a> startup_msg:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Starting&nbsp;up,&nbsp;DL&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1030" href="#l1030" class="linenr">1030</a> spec_ok_msg:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Loaded&nbsp;spec&nbsp;packet&nbsp;OK,&nbsp;drive&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1031" href="#l1031" class="linenr">1031</a> secsize_msg:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Sector&nbsp;size&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1032" href="#l1032" class="linenr">1032</a> offset_msg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Main&nbsp;image&nbsp;LBA&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1033" href="#l1033" class="linenr">1033</a> size_msg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Sectors&nbsp;to&nbsp;load&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1034" href="#l1034" class="linenr">1034</a> loaded_msg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Loaded&nbsp;boot&nbsp;image,&nbsp;verifying...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1035" href="#l1035" class="linenr">1035</a> verify_msg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Image&nbsp;checksum&nbsp;verified.&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1036" href="#l1036" class="linenr">1036</a> allread_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Main&nbsp;image&nbsp;read,&nbsp;jumping&nbsp;to&nbsp;main&nbsp;code...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1037" href="#l1037" class="linenr">1037</a> %endif</div>
<div class="pre"><a id="l1038" href="#l1038" class="linenr">1038</a> noinfotable_msg&nbsp;db&nbsp;&#39;No&nbsp;boot&nbsp;info&nbsp;table,&nbsp;assuming&nbsp;single&nbsp;session&nbsp;disk...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1039" href="#l1039" class="linenr">1039</a> noinfoinspec_msg&nbsp;db&nbsp;&#39;Spec&nbsp;packet&nbsp;missing&nbsp;LBA&nbsp;information,&nbsp;trying&nbsp;to&nbsp;wing&nbsp;it...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1040" href="#l1040" class="linenr">1040</a> spec_err_msg:&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Loading&nbsp;spec&nbsp;packet&nbsp;failed,&nbsp;trying&nbsp;to&nbsp;wing&nbsp;it...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1041" href="#l1041" class="linenr">1041</a> maybe_msg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Found&nbsp;something&nbsp;at&nbsp;drive&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1042" href="#l1042" class="linenr">1042</a> alright_msg:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Looks&nbsp;reasonable,&nbsp;continuing...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1043" href="#l1043" class="linenr">1043</a> nospec_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Extremely&nbsp;broken&nbsp;BIOS&nbsp;detected,&nbsp;last&nbsp;attempt&nbsp;with&nbsp;drive&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1044" href="#l1044" class="linenr">1044</a> nothing_msg:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Failed&nbsp;to&nbsp;locate&nbsp;CD-ROM&nbsp;device;&nbsp;boot&nbsp;failed.&#39;,&nbsp;CR,&nbsp;LF</div>
<div class="pre"><a id="l1045" href="#l1045" class="linenr">1045</a> trysbm_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;See&nbsp;http://syslinux.zytor.com/sbm&nbsp;for&nbsp;more&nbsp;information.&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1046" href="#l1046" class="linenr">1046</a> diskerr_msg:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Disk&nbsp;error&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1047" href="#l1047" class="linenr">1047</a> oncall_str:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;,&nbsp;AX&nbsp;=&nbsp;&#39;,0</div>
<div class="pre"><a id="l1048" href="#l1048" class="linenr">1048</a> ondrive_str:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;,&nbsp;drive&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1049" href="#l1049" class="linenr">1049</a> checkerr_msg:&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Image&nbsp;checksum&nbsp;error,&nbsp;sorry...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1050" href="#l1050" class="linenr">1050</a> </div>
<div class="pre"><a id="l1051" href="#l1051" class="linenr">1051</a> err_bootfailed&nbsp;&nbsp;db&nbsp;CR,&nbsp;LF,&nbsp;&#39;Boot&nbsp;failed:&nbsp;press&nbsp;a&nbsp;key&nbsp;to&nbsp;retry...&#39;</div>
<div class="pre"><a id="l1052" href="#l1052" class="linenr">1052</a> bailmsg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;err_bootfailed</div>
<div class="pre"><a id="l1053" href="#l1053" class="linenr">1053</a> crlf_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;CR,&nbsp;LF</div>
<div class="pre"><a id="l1054" href="#l1054" class="linenr">1054</a> null_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;0</div>
<div class="pre"><a id="l1055" href="#l1055" class="linenr">1055</a> </div>
<div class="pre"><a id="l1056" href="#l1056" class="linenr">1056</a> bios_cdrom_str&nbsp;&nbsp;db&nbsp;&#39;ETCD&#39;,&nbsp;0</div>
<div class="pre"><a id="l1057" href="#l1057" class="linenr">1057</a> %ifndef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1058" href="#l1058" class="linenr">1058</a> bios_cbios_str&nbsp;&nbsp;db&nbsp;&#39;CHDD&#39;,&nbsp;0</div>
<div class="pre"><a id="l1059" href="#l1059" class="linenr">1059</a> bios_ebios_str&nbsp;&nbsp;db&nbsp;&#39;EHDD&#39;&nbsp;,0</div>
<div class="pre"><a id="l1060" href="#l1060" class="linenr">1060</a> %endif</div>
<div class="pre"><a id="l1061" href="#l1061" class="linenr">1061</a> </div>
<div class="pre"><a id="l1062" href="#l1062" class="linenr">1062</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignz&nbsp;4</div>
<div class="pre"><a id="l1063" href="#l1063" class="linenr">1063</a> bios_cdrom:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dw&nbsp;getlinsec_cdrom,&nbsp;bios_cdrom_str</div>
<div class="pre"><a id="l1064" href="#l1064" class="linenr">1064</a> %ifndef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1065" href="#l1065" class="linenr">1065</a> bios_cbios:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dw&nbsp;getlinsec_cbios,&nbsp;bios_cbios_str</div>
<div class="pre"><a id="l1066" href="#l1066" class="linenr">1066</a> bios_ebios:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dw&nbsp;getlinsec_ebios,&nbsp;bios_ebios_str</div>
<div class="pre"><a id="l1067" href="#l1067" class="linenr">1067</a> %endif</div>
<div class="pre"><a id="l1068" href="#l1068" class="linenr">1068</a> </div>
<div class="pre"><a id="l1069" href="#l1069" class="linenr">1069</a> ;&nbsp;Maximum&nbsp;transfer&nbsp;size</div>
<div class="pre"><a id="l1070" href="#l1070" class="linenr">1070</a> MaxTransfer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dw&nbsp;127&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Hard&nbsp;disk&nbsp;modes</div>
<div class="pre"><a id="l1071" href="#l1071" class="linenr">1071</a> MaxTransferCD&nbsp;&nbsp;&nbsp;dw&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;CD&nbsp;mode</div>
<div class="pre"><a id="l1072" href="#l1072" class="linenr">1072</a> </div>
<div class="pre"><a id="l1073" href="#l1073" class="linenr">1073</a> rl_checkpt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Must&nbsp;be&nbsp;&lt;=&nbsp;800h</div>
<div class="pre"><a id="l1074" href="#l1074" class="linenr">1074</a> </div>
<div class="pre"><a id="l1075" href="#l1075" class="linenr">1075</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;pads&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;sector&nbsp;0&nbsp;and&nbsp;errors&nbsp;out&nbsp;on</div>
<div class="pre"><a id="l1076" href="#l1076" class="linenr">1076</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;overflow.</div>
<div class="pre"><a id="l1077" href="#l1077" class="linenr">1077</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;2048-($-$$)&nbsp;db&nbsp;0</div>
<div class="pre"><a id="l1078" href="#l1078" class="linenr">1078</a> </div>
<div class="pre"><a id="l1079" href="#l1079" class="linenr">1079</a> ;&nbsp;----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1080" href="#l1080" class="linenr">1080</a> ;&nbsp;&nbsp;End&nbsp;of&nbsp;code&nbsp;and&nbsp;data&nbsp;that&nbsp;have&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;first&nbsp;sector</div>
<div class="pre"><a id="l1081" href="#l1081" class="linenr">1081</a> ;&nbsp;----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1082" href="#l1082" class="linenr">1082</a> </div>
<div class="pre"><a id="l1083" href="#l1083" class="linenr">1083</a> all_read:</div>
<div class="pre"><a id="l1084" href="#l1084" class="linenr">1084</a> </div>
<div class="pre"><a id="l1085" href="#l1085" class="linenr">1085</a> ;&nbsp;Test&nbsp;tracers</div>
<div class="pre"><a id="l1086" href="#l1086" class="linenr">1086</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;T&#39;</div>
<div class="pre"><a id="l1087" href="#l1087" class="linenr">1087</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;&gt;&#39;</div>
<div class="pre"><a id="l1088" href="#l1088" class="linenr">1088</a> </div>
<div class="pre"><a id="l1089" href="#l1089" class="linenr">1089</a> ;</div>
<div class="pre"><a id="l1090" href="#l1090" class="linenr">1090</a> ;&nbsp;Common&nbsp;initialization&nbsp;code</div>
<div class="pre"><a id="l1091" href="#l1091" class="linenr">1091</a> ;</div>
<div class="pre"><a id="l1092" href="#l1092" class="linenr">1092</a> %include&nbsp;&quot;init.inc&quot;</div>
<div class="pre"><a id="l1093" href="#l1093" class="linenr">1093</a> %include&nbsp;&quot;cpuinit.inc&quot;</div>
<div class="pre"><a id="l1094" href="#l1094" class="linenr">1094</a> </div>
<div class="pre"><a id="l1095" href="#l1095" class="linenr">1095</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Patch&nbsp;the&nbsp;writechr&nbsp;routine&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;full&nbsp;code</div>
<div class="pre"><a id="l1096" href="#l1096" class="linenr">1096</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;word&nbsp;[writechr+1],&nbsp;writechr_full-(writechr+3)</div>
<div class="pre"><a id="l1097" href="#l1097" class="linenr">1097</a> </div>
<div class="pre"><a id="l1098" href="#l1098" class="linenr">1098</a> ;&nbsp;Tell&nbsp;the&nbsp;user&nbsp;we&nbsp;got&nbsp;this&nbsp;far...</div>
<div class="pre"><a id="l1099" href="#l1099" class="linenr">1099</a> %ifndef&nbsp;DEBUG_MESSAGES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Gets&nbsp;messy&nbsp;with&nbsp;debugging&nbsp;on</div>
<div class="pre"><a id="l1100" href="#l1100" class="linenr">1100</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,copyright_str</div>
<div class="pre"><a id="l1101" href="#l1101" class="linenr">1101</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr_early</div>
<div class="pre"><a id="l1102" href="#l1102" class="linenr">1102</a> %endif</div>
<div class="pre"><a id="l1103" href="#l1103" class="linenr">1103</a> </div>
<div class="pre"><a id="l1104" href="#l1104" class="linenr">1104</a> ;</div>
<div class="pre"><a id="l1105" href="#l1105" class="linenr">1105</a> ;&nbsp;Now&nbsp;we&#39;re&nbsp;all&nbsp;set&nbsp;to&nbsp;start&nbsp;with&nbsp;our&nbsp;*real*&nbsp;business.&nbsp;&nbsp;First&nbsp;load&nbsp;the</div>
<div class="pre"><a id="l1106" href="#l1106" class="linenr">1106</a> ;&nbsp;configuration&nbsp;file&nbsp;(if&nbsp;any)&nbsp;and&nbsp;parse&nbsp;it.</div>
<div class="pre"><a id="l1107" href="#l1107" class="linenr">1107</a> ;</div>
<div class="pre"><a id="l1108" href="#l1108" class="linenr">1108</a> ;&nbsp;In&nbsp;previous&nbsp;versions&nbsp;I&nbsp;avoided&nbsp;using&nbsp;32-bit&nbsp;registers&nbsp;because&nbsp;of&nbsp;a</div>
<div class="pre"><a id="l1109" href="#l1109" class="linenr">1109</a> ;&nbsp;rumour&nbsp;some&nbsp;BIOSes&nbsp;clobbered&nbsp;the&nbsp;upper&nbsp;half&nbsp;of&nbsp;32-bit&nbsp;registers&nbsp;at</div>
<div class="pre"><a id="l1110" href="#l1110" class="linenr">1110</a> ;&nbsp;random.&nbsp;&nbsp;I&nbsp;figure,&nbsp;though,&nbsp;that&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;of&nbsp;those&nbsp;still&nbsp;left</div>
<div class="pre"><a id="l1111" href="#l1111" class="linenr">1111</a> ;&nbsp;they&nbsp;probably&nbsp;won&#39;t&nbsp;be&nbsp;trying&nbsp;to&nbsp;install&nbsp;Linux&nbsp;on&nbsp;them...</div>
<div class="pre"><a id="l1112" href="#l1112" class="linenr">1112</a> ;</div>
<div class="pre"><a id="l1113" href="#l1113" class="linenr">1113</a> ;&nbsp;The&nbsp;code&nbsp;is&nbsp;still&nbsp;ripe&nbsp;with&nbsp;16-bitisms,&nbsp;though.&nbsp;&nbsp;Not&nbsp;worth&nbsp;the&nbsp;hassle</div>
<div class="pre"><a id="l1114" href="#l1114" class="linenr">1114</a> ;&nbsp;to&nbsp;take&#39;m&nbsp;out.&nbsp;&nbsp;In&nbsp;fact,&nbsp;we&nbsp;may&nbsp;want&nbsp;to&nbsp;put&nbsp;them&nbsp;back&nbsp;if&nbsp;we&#39;re&nbsp;going</div>
<div class="pre"><a id="l1115" href="#l1115" class="linenr">1115</a> ;&nbsp;to&nbsp;boot&nbsp;ELKS&nbsp;at&nbsp;some&nbsp;point.</div>
<div class="pre"><a id="l1116" href="#l1116" class="linenr">1116</a> ;</div>
<div class="pre"><a id="l1117" href="#l1117" class="linenr">1117</a> </div>
<div class="pre"><a id="l1118" href="#l1118" class="linenr">1118</a> ;</div>
<div class="pre"><a id="l1119" href="#l1119" class="linenr">1119</a> ;&nbsp;Now,&nbsp;we&nbsp;need&nbsp;to&nbsp;sniff&nbsp;out&nbsp;the&nbsp;actual&nbsp;filesystem&nbsp;data&nbsp;structures.</div>
<div class="pre"><a id="l1120" href="#l1120" class="linenr">1120</a> ;&nbsp;mkisofs&nbsp;gave&nbsp;us&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;primary&nbsp;volume&nbsp;descriptor</div>
<div class="pre"><a id="l1121" href="#l1121" class="linenr">1121</a> ;&nbsp;(which&nbsp;will&nbsp;be&nbsp;at&nbsp;16&nbsp;only&nbsp;for&nbsp;a&nbsp;single-session&nbsp;disk!);&nbsp;from&nbsp;the&nbsp;PVD</div>
<div class="pre"><a id="l1122" href="#l1122" class="linenr">1122</a> ;&nbsp;we&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;find&nbsp;the&nbsp;rest&nbsp;of&nbsp;what&nbsp;we&nbsp;need&nbsp;to&nbsp;know.</div>
<div class="pre"><a id="l1123" href="#l1123" class="linenr">1123</a> ;</div>
<div class="pre"><a id="l1124" href="#l1124" class="linenr">1124</a> get_fs_structures:</div>
<div class="pre"><a id="l1125" href="#l1125" class="linenr">1125</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[bi_pvd]</div>
<div class="pre"><a id="l1126" href="#l1126" class="linenr">1126</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,trackbuf</div>
<div class="pre"><a id="l1127" href="#l1127" class="linenr">1127</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getonesec</div>
<div class="pre"><a id="l1128" href="#l1128" class="linenr">1128</a> </div>
<div class="pre"><a id="l1129" href="#l1129" class="linenr">1129</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[trackbuf+156+2]</div>
<div class="pre"><a id="l1130" href="#l1130" class="linenr">1130</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[RootDir+dir_lba],eax</div>
<div class="pre"><a id="l1131" href="#l1131" class="linenr">1131</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[CurrentDir+dir_lba],eax</div>
<div class="pre"><a id="l1132" href="#l1132" class="linenr">1132</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1133" href="#l1133" class="linenr">1133</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,dbg_rootdir_msg</div>
<div class="pre"><a id="l1134" href="#l1134" class="linenr">1134</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l1135" href="#l1135" class="linenr">1135</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex8</div>
<div class="pre"><a id="l1136" href="#l1136" class="linenr">1136</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l1137" href="#l1137" class="linenr">1137</a> %endif</div>
<div class="pre"><a id="l1138" href="#l1138" class="linenr">1138</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[trackbuf+156+10]</div>
<div class="pre"><a id="l1139" href="#l1139" class="linenr">1139</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[RootDir+dir_len],eax</div>
<div class="pre"><a id="l1140" href="#l1140" class="linenr">1140</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[CurrentDir+dir_len],eax</div>
<div class="pre"><a id="l1141" href="#l1141" class="linenr">1141</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;eax,SECTOR_SIZE-1</div>
<div class="pre"><a id="l1142" href="#l1142" class="linenr">1142</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr&nbsp;eax,SECTOR_SHIFT</div>
<div class="pre"><a id="l1143" href="#l1143" class="linenr">1143</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[RootDir+dir_clust],eax</div>
<div class="pre"><a id="l1144" href="#l1144" class="linenr">1144</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[CurrentDir+dir_clust],eax</div>
<div class="pre"><a id="l1145" href="#l1145" class="linenr">1145</a> </div>
<div class="pre"><a id="l1146" href="#l1146" class="linenr">1146</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Look&nbsp;for&nbsp;an&nbsp;isolinux&nbsp;directory,&nbsp;and&nbsp;if&nbsp;found,</div>
<div class="pre"><a id="l1147" href="#l1147" class="linenr">1147</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;make&nbsp;it&nbsp;the&nbsp;current&nbsp;directory&nbsp;instead&nbsp;of&nbsp;the&nbsp;root</div>
<div class="pre"><a id="l1148" href="#l1148" class="linenr">1148</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;directory.</div>
<div class="pre"><a id="l1149" href="#l1149" class="linenr">1149</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Also&nbsp;copy&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;directory&nbsp;to&nbsp;CurrentDirName</div>
<div class="pre"><a id="l1150" href="#l1150" class="linenr">1150</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;word&nbsp;[CurrentDirName],ROOT_DIR_WORD&nbsp;;&nbsp;Write&nbsp;&#39;/&#39;,0&nbsp;to&nbsp;the&nbsp;CurrentDirName</div>
<div class="pre"><a id="l1151" href="#l1151" class="linenr">1151</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,boot_dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Search&nbsp;for&nbsp;/boot/isolinux</div>
<div class="pre"><a id="l1152" href="#l1152" class="linenr">1152</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,02h</div>
<div class="pre"><a id="l1153" href="#l1153" class="linenr">1153</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di</div>
<div class="pre"><a id="l1154" href="#l1154" class="linenr">1154</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;searchdir_iso</div>
<div class="pre"><a id="l1155" href="#l1155" class="linenr">1155</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;di</div>
<div class="pre"><a id="l1156" href="#l1156" class="linenr">1156</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.found_dir</div>
<div class="pre"><a id="l1157" href="#l1157" class="linenr">1157</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,isolinux_dir</div>
<div class="pre"><a id="l1158" href="#l1158" class="linenr">1158</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,02h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Search&nbsp;for&nbsp;/isolinux</div>
<div class="pre"><a id="l1159" href="#l1159" class="linenr">1159</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di</div>
<div class="pre"><a id="l1160" href="#l1160" class="linenr">1160</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;searchdir_iso</div>
<div class="pre"><a id="l1161" href="#l1161" class="linenr">1161</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;di</div>
<div class="pre"><a id="l1162" href="#l1162" class="linenr">1162</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.no_isolinux_dir</div>
<div class="pre"><a id="l1163" href="#l1163" class="linenr">1163</a> .found_dir:</div>
<div class="pre"><a id="l1164" href="#l1164" class="linenr">1164</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Copy&nbsp;current&nbsp;directory&nbsp;name&nbsp;to&nbsp;CurrentDirName</div>
<div class="pre"><a id="l1165" href="#l1165" class="linenr">1165</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;si</div>
<div class="pre"><a id="l1166" href="#l1166" class="linenr">1166</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di</div>
<div class="pre"><a id="l1167" href="#l1167" class="linenr">1167</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,di</div>
<div class="pre"><a id="l1168" href="#l1168" class="linenr">1168</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,CurrentDirName</div>
<div class="pre"><a id="l1169" href="#l1169" class="linenr">1169</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;strcpy</div>
<div class="pre"><a id="l1170" href="#l1170" class="linenr">1170</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[di],0&nbsp;;done&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;not&nbsp;word&nbsp;aligned</div>
<div class="pre"><a id="l1171" href="#l1171" class="linenr">1171</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;di</div>
<div class="pre"><a id="l1172" href="#l1172" class="linenr">1172</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[di],&#39;/&#39;</div>
<div class="pre"><a id="l1173" href="#l1173" class="linenr">1173</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;di</div>
<div class="pre"><a id="l1174" href="#l1174" class="linenr">1174</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;si</div>
<div class="pre"><a id="l1175" href="#l1175" class="linenr">1175</a> </div>
<div class="pre"><a id="l1176" href="#l1176" class="linenr">1176</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[CurrentDir+dir_len],eax</div>
<div class="pre"><a id="l1177" href="#l1177" class="linenr">1177</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+file_left]</div>
<div class="pre"><a id="l1178" href="#l1178" class="linenr">1178</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[CurrentDir+dir_clust],eax</div>
<div class="pre"><a id="l1179" href="#l1179" class="linenr">1179</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;eax,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Free&nbsp;this&nbsp;file&nbsp;pointer&nbsp;entry</div>
<div class="pre"><a id="l1180" href="#l1180" class="linenr">1180</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;eax,[si+file_sector]</div>
<div class="pre"><a id="l1181" href="#l1181" class="linenr">1181</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[CurrentDir+dir_lba],eax</div>
<div class="pre"><a id="l1182" href="#l1182" class="linenr">1182</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1183" href="#l1183" class="linenr">1183</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;si</div>
<div class="pre"><a id="l1184" href="#l1184" class="linenr">1184</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,dbg_isodir_msg</div>
<div class="pre"><a id="l1185" href="#l1185" class="linenr">1185</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l1186" href="#l1186" class="linenr">1186</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;si</div>
<div class="pre"><a id="l1187" href="#l1187" class="linenr">1187</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writehex8</div>
<div class="pre"><a id="l1188" href="#l1188" class="linenr">1188</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;crlf</div>
<div class="pre"><a id="l1189" href="#l1189" class="linenr">1189</a> %endif</div>
<div class="pre"><a id="l1190" href="#l1190" class="linenr">1190</a> .no_isolinux_dir:</div>
<div class="pre"><a id="l1191" href="#l1191" class="linenr">1191</a> </div>
<div class="pre"><a id="l1192" href="#l1192" class="linenr">1192</a> ;</div>
<div class="pre"><a id="l1193" href="#l1193" class="linenr">1193</a> ;&nbsp;Locate&nbsp;the&nbsp;configuration&nbsp;file</div>
<div class="pre"><a id="l1194" href="#l1194" class="linenr">1194</a> ;</div>
<div class="pre"><a id="l1195" href="#l1195" class="linenr">1195</a> load_config:</div>
<div class="pre"><a id="l1196" href="#l1196" class="linenr">1196</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1197" href="#l1197" class="linenr">1197</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,dbg_config_msg</div>
<div class="pre"><a id="l1198" href="#l1198" class="linenr">1198</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l1199" href="#l1199" class="linenr">1199</a> %endif</div>
<div class="pre"><a id="l1200" href="#l1200" class="linenr">1200</a> </div>
<div class="pre"><a id="l1201" href="#l1201" class="linenr">1201</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,config_name</div>
<div class="pre"><a id="l1202" href="#l1202" class="linenr">1202</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,ConfigName</div>
<div class="pre"><a id="l1203" href="#l1203" class="linenr">1203</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;strcpy</div>
<div class="pre"><a id="l1204" href="#l1204" class="linenr">1204</a> </div>
<div class="pre"><a id="l1205" href="#l1205" class="linenr">1205</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,ConfigName</div>
<div class="pre"><a id="l1206" href="#l1206" class="linenr">1206</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;open</div>
<div class="pre"><a id="l1207" href="#l1207" class="linenr">1207</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;no_config_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Not&nbsp;found&nbsp;or&nbsp;empty</div>
<div class="pre"><a id="l1208" href="#l1208" class="linenr">1208</a> </div>
<div class="pre"><a id="l1209" href="#l1209" class="linenr">1209</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1210" href="#l1210" class="linenr">1210</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,dbg_configok_msg</div>
<div class="pre"><a id="l1211" href="#l1211" class="linenr">1211</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writemsg</div>
<div class="pre"><a id="l1212" href="#l1212" class="linenr">1212</a> %endif</div>
<div class="pre"><a id="l1213" href="#l1213" class="linenr">1213</a> </div>
<div class="pre"><a id="l1214" href="#l1214" class="linenr">1214</a> ;</div>
<div class="pre"><a id="l1215" href="#l1215" class="linenr">1215</a> ;&nbsp;Now&nbsp;we&nbsp;have&nbsp;the&nbsp;config&nbsp;file&nbsp;open.&nbsp;&nbsp;Parse&nbsp;the&nbsp;config&nbsp;file&nbsp;and</div>
<div class="pre"><a id="l1216" href="#l1216" class="linenr">1216</a> ;&nbsp;run&nbsp;the&nbsp;user&nbsp;interface.</div>
<div class="pre"><a id="l1217" href="#l1217" class="linenr">1217</a> ;</div>
<div class="pre"><a id="l1218" href="#l1218" class="linenr">1218</a> %include&nbsp;&quot;ui.inc&quot;</div>
<div class="pre"><a id="l1219" href="#l1219" class="linenr">1219</a> </div>
<div class="pre"><a id="l1220" href="#l1220" class="linenr">1220</a> ;</div>
<div class="pre"><a id="l1221" href="#l1221" class="linenr">1221</a> ;&nbsp;Enable&nbsp;disk&nbsp;emulation.&nbsp;&nbsp;The&nbsp;kind&nbsp;of&nbsp;disk&nbsp;we&nbsp;emulate&nbsp;is&nbsp;dependent&nbsp;on&nbsp;the</div>
<div class="pre"><a id="l1222" href="#l1222" class="linenr">1222</a> ;&nbsp;size&nbsp;of&nbsp;the&nbsp;file:&nbsp;1200K,&nbsp;1440K&nbsp;or&nbsp;2880K&nbsp;floppy,&nbsp;otherwise&nbsp;harddisk.</div>
<div class="pre"><a id="l1223" href="#l1223" class="linenr">1223</a> ;</div>
<div class="pre"><a id="l1224" href="#l1224" class="linenr">1224</a> is_disk_image:</div>
<div class="pre"><a id="l1225" href="#l1225" class="linenr">1225</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;CR</div>
<div class="pre"><a id="l1226" href="#l1226" class="linenr">1226</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;LF</div>
<div class="pre"><a id="l1227" href="#l1227" class="linenr">1227</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;D&#39;</div>
<div class="pre"><a id="l1228" href="#l1228" class="linenr">1228</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;:&#39;</div>
<div class="pre"><a id="l1229" href="#l1229" class="linenr">1229</a> </div>
<div class="pre"><a id="l1230" href="#l1230" class="linenr">1230</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;edx,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;File&nbsp;size</div>
<div class="pre"><a id="l1231" href="#l1231" class="linenr">1231</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,img_table</div>
<div class="pre"><a id="l1232" href="#l1232" class="linenr">1232</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,img_table_count</div>
<div class="pre"><a id="l1233" href="#l1233" class="linenr">1233</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+file_sector]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Starting&nbsp;LBA&nbsp;of&nbsp;file</div>
<div class="pre"><a id="l1234" href="#l1234" class="linenr">1234</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[dsp_lba],eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Location&nbsp;of&nbsp;file</div>
<div class="pre"><a id="l1235" href="#l1235" class="linenr">1235</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[dsp_drive],&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;00h&nbsp;floppy,&nbsp;80h&nbsp;hard&nbsp;disk</div>
<div class="pre"><a id="l1236" href="#l1236" class="linenr">1236</a> .search_table:</div>
<div class="pre"><a id="l1237" href="#l1237" class="linenr">1237</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;t&#39;</div>
<div class="pre"><a id="l1238" href="#l1238" class="linenr">1238</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[di+4]</div>
<div class="pre"><a id="l1239" href="#l1239" class="linenr">1239</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;edx,[di]</div>
<div class="pre"><a id="l1240" href="#l1240" class="linenr">1240</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.type_found</div>
<div class="pre"><a id="l1241" href="#l1241" class="linenr">1241</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;di,8</div>
<div class="pre"><a id="l1242" href="#l1242" class="linenr">1242</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;.search_table</div>
<div class="pre"><a id="l1243" href="#l1243" class="linenr">1243</a> </div>
<div class="pre"><a id="l1244" href="#l1244" class="linenr">1244</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Hard&nbsp;disk&nbsp;image.&nbsp;&nbsp;Need&nbsp;to&nbsp;examine&nbsp;the&nbsp;partition&nbsp;table</div>
<div class="pre"><a id="l1245" href="#l1245" class="linenr">1245</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;in&nbsp;order&nbsp;to&nbsp;deduce&nbsp;the&nbsp;C/H/S&nbsp;geometry.&nbsp;&nbsp;Sigh.</div>
<div class="pre"><a id="l1246" href="#l1246" class="linenr">1246</a> .hard_disk_image:</div>
<div class="pre"><a id="l1247" href="#l1247" class="linenr">1247</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;h&#39;</div>
<div class="pre"><a id="l1248" href="#l1248" class="linenr">1248</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;edx,512</div>
<div class="pre"><a id="l1249" href="#l1249" class="linenr">1249</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jb&nbsp;.bad_image</div>
<div class="pre"><a id="l1250" href="#l1250" class="linenr">1250</a> </div>
<div class="pre"><a id="l1251" href="#l1251" class="linenr">1251</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,trackbuf</div>
<div class="pre"><a id="l1252" href="#l1252" class="linenr">1252</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load&nbsp;1&nbsp;sector</div>
<div class="pre"><a id="l1253" href="#l1253" class="linenr">1253</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getfssec</div>
<div class="pre"><a id="l1254" href="#l1254" class="linenr">1254</a> </div>
<div class="pre"><a id="l1255" href="#l1255" class="linenr">1255</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;word&nbsp;[trackbuf+510],0aa55h&nbsp;&nbsp;;&nbsp;Boot&nbsp;signature</div>
<div class="pre"><a id="l1256" href="#l1256" class="linenr">1256</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;.bad_image&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Image&nbsp;not&nbsp;bootable</div>
<div class="pre"><a id="l1257" href="#l1257" class="linenr">1257</a> </div>
<div class="pre"><a id="l1258" href="#l1258" class="linenr">1258</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;4&nbsp;partition&nbsp;entries</div>
<div class="pre"><a id="l1259" href="#l1259" class="linenr">1259</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,trackbuf+446&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Start&nbsp;of&nbsp;partition&nbsp;table</div>
<div class="pre"><a id="l1260" href="#l1260" class="linenr">1260</a> </div>
<div class="pre"><a id="l1261" href="#l1261" class="linenr">1261</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ax,ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Highest&nbsp;sector(al)&nbsp;head(ah)</div>
<div class="pre"><a id="l1262" href="#l1262" class="linenr">1262</a> </div>
<div class="pre"><a id="l1263" href="#l1263" class="linenr">1263</a> .part_scan:</div>
<div class="pre"><a id="l1264" href="#l1264" class="linenr">1264</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;byte&nbsp;[di+4],&nbsp;0</div>
<div class="pre"><a id="l1265" href="#l1265" class="linenr">1265</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.part_loop</div>
<div class="pre"><a id="l1266" href="#l1266" class="linenr">1266</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;si,[di+1]</div>
<div class="pre"><a id="l1267" href="#l1267" class="linenr">1267</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;.hs_check</div>
<div class="pre"><a id="l1268" href="#l1268" class="linenr">1268</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;si,byte&nbsp;4</div>
<div class="pre"><a id="l1269" href="#l1269" class="linenr">1269</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;.hs_check</div>
<div class="pre"><a id="l1270" href="#l1270" class="linenr">1270</a> .part_loop:</div>
<div class="pre"><a id="l1271" href="#l1271" class="linenr">1271</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;di,byte&nbsp;16</div>
<div class="pre"><a id="l1272" href="#l1272" class="linenr">1272</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;.part_scan</div>
<div class="pre"><a id="l1273" href="#l1273" class="linenr">1273</a> </div>
<div class="pre"><a id="l1274" href="#l1274" class="linenr">1274</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;H/S</div>
<div class="pre"><a id="l1275" href="#l1275" class="linenr">1275</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;edx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;File&nbsp;size</div>
<div class="pre"><a id="l1276" href="#l1276" class="linenr">1276</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bl,ah</div>
<div class="pre"><a id="l1277" href="#l1277" class="linenr">1277</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;bh,bh</div>
<div class="pre"><a id="l1278" href="#l1278" class="linenr">1278</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;bx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;#&nbsp;of&nbsp;heads&nbsp;in&nbsp;BX</div>
<div class="pre"><a id="l1279" href="#l1279" class="linenr">1279</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ah,ah&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;#&nbsp;of&nbsp;sectors&nbsp;in&nbsp;AX</div>
<div class="pre"><a id="l1280" href="#l1280" class="linenr">1280</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cwde&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;EAX[31:16]&nbsp;&lt;-&nbsp;0</div>
<div class="pre"><a id="l1281" href="#l1281" class="linenr">1281</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mul&nbsp;bx</div>
<div class="pre"><a id="l1282" href="#l1282" class="linenr">1282</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;eax,9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;to&nbsp;bytes</div>
<div class="pre"><a id="l1283" href="#l1283" class="linenr">1283</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Now&nbsp;eax&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;per&nbsp;cylinder</div>
<div class="pre"><a id="l1284" href="#l1284" class="linenr">1284</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;File&nbsp;size</div>
<div class="pre"><a id="l1285" href="#l1285" class="linenr">1285</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;edx,edx</div>
<div class="pre"><a id="l1286" href="#l1286" class="linenr">1286</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;div&nbsp;ebx</div>
<div class="pre"><a id="l1287" href="#l1287" class="linenr">1287</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;edx,edx</div>
<div class="pre"><a id="l1288" href="#l1288" class="linenr">1288</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.no_remainder</div>
<div class="pre"><a id="l1289" href="#l1289" class="linenr">1289</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Fractional&nbsp;cylinder...</div>
<div class="pre"><a id="l1290" href="#l1290" class="linenr">1290</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Now&nbsp;(e)ax&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;cylinders</div>
<div class="pre"><a id="l1291" href="#l1291" class="linenr">1291</a> .no_remainder:&nbsp;&nbsp;cmp&nbsp;eax,1024</div>
<div class="pre"><a id="l1292" href="#l1292" class="linenr">1292</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jna&nbsp;.ok_cyl</div>
<div class="pre"><a id="l1293" href="#l1293" class="linenr">1293</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,1024&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;possible&nbsp;#</div>
<div class="pre"><a id="l1294" href="#l1294" class="linenr">1294</a> .ok_cyl:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;to&nbsp;max&nbsp;cylinder&nbsp;no</div>
<div class="pre"><a id="l1295" href="#l1295" class="linenr">1295</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;S(bl)&nbsp;H(bh)</div>
<div class="pre"><a id="l1296" href="#l1296" class="linenr">1296</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;ah,6</div>
<div class="pre"><a id="l1297" href="#l1297" class="linenr">1297</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;bl,ah</div>
<div class="pre"><a id="l1298" href="#l1298" class="linenr">1298</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;ax,bx</div>
<div class="pre"><a id="l1299" href="#l1299" class="linenr">1299</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;eax,16</div>
<div class="pre"><a id="l1300" href="#l1300" class="linenr">1300</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,bl</div>
<div class="pre"><a id="l1301" href="#l1301" class="linenr">1301</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Hard&nbsp;disk&nbsp;boot</div>
<div class="pre"><a id="l1302" href="#l1302" class="linenr">1302</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[dsp_drive],&nbsp;80h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Drive&nbsp;80h&nbsp;=&nbsp;hard&nbsp;disk</div>
<div class="pre"><a id="l1303" href="#l1303" class="linenr">1303</a> </div>
<div class="pre"><a id="l1304" href="#l1304" class="linenr">1304</a> .type_found:</div>
<div class="pre"><a id="l1305" href="#l1305" class="linenr">1305</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;T&#39;</div>
<div class="pre"><a id="l1306" href="#l1306" class="linenr">1306</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bl,[sp_media]</div>
<div class="pre"><a id="l1307" href="#l1307" class="linenr">1307</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;bl,0F0h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Copy&nbsp;controller&nbsp;info&nbsp;bits</div>
<div class="pre"><a id="l1308" href="#l1308" class="linenr">1308</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;al,bl</div>
<div class="pre"><a id="l1309" href="#l1309" class="linenr">1309</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[dsp_media],al&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Emulation&nbsp;type</div>
<div class="pre"><a id="l1310" href="#l1310" class="linenr">1310</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr&nbsp;eax,8</div>
<div class="pre"><a id="l1311" href="#l1311" class="linenr">1311</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[dsp_chs],eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;C/H/S&nbsp;geometry</div>
<div class="pre"><a id="l1312" href="#l1312" class="linenr">1312</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,[sp_devspec]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Copy&nbsp;device&nbsp;spec</div>
<div class="pre"><a id="l1313" href="#l1313" class="linenr">1313</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[dsp_devspec],ax</div>
<div class="pre"><a id="l1314" href="#l1314" class="linenr">1314</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,[sp_controller]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Copy&nbsp;controller&nbsp;index</div>
<div class="pre"><a id="l1315" href="#l1315" class="linenr">1315</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[dsp_controller],al</div>
<div class="pre"><a id="l1316" href="#l1316" class="linenr">1316</a> </div>
<div class="pre"><a id="l1317" href="#l1317" class="linenr">1317</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;V&#39;</div>
<div class="pre"><a id="l1318" href="#l1318" class="linenr">1318</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;vgaclearmode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Reset&nbsp;video</div>
<div class="pre"><a id="l1319" href="#l1319" class="linenr">1319</a> </div>
<div class="pre"><a id="l1320" href="#l1320" class="linenr">1320</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,4C00h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Enable&nbsp;emulation&nbsp;and&nbsp;boot</div>
<div class="pre"><a id="l1321" href="#l1321" class="linenr">1321</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,dspec_packet</div>
<div class="pre"><a id="l1322" href="#l1322" class="linenr">1322</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dl,[DriveNumber]</div>
<div class="pre"><a id="l1323" href="#l1323" class="linenr">1323</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lss&nbsp;sp,[InitStack]</div>
<div class="pre"><a id="l1324" href="#l1324" class="linenr">1324</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;X&#39;</div>
<div class="pre"><a id="l1325" href="#l1325" class="linenr">1325</a> </div>
<div class="pre"><a id="l1326" href="#l1326" class="linenr">1326</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;int13</div>
<div class="pre"><a id="l1327" href="#l1327" class="linenr">1327</a> </div>
<div class="pre"><a id="l1328" href="#l1328" class="linenr">1328</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;If&nbsp;this&nbsp;returns,&nbsp;we&nbsp;have&nbsp;problems</div>
<div class="pre"><a id="l1329" href="#l1329" class="linenr">1329</a> .bad_image:</div>
<div class="pre"><a id="l1330" href="#l1330" class="linenr">1330</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,err_disk_image</div>
<div class="pre"><a id="l1331" href="#l1331" class="linenr">1331</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;writestr</div>
<div class="pre"><a id="l1332" href="#l1332" class="linenr">1332</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;enter_command</div>
<div class="pre"><a id="l1333" href="#l1333" class="linenr">1333</a> </div>
<div class="pre"><a id="l1334" href="#l1334" class="linenr">1334</a> ;</div>
<div class="pre"><a id="l1335" href="#l1335" class="linenr">1335</a> ;&nbsp;Look&nbsp;for&nbsp;the&nbsp;highest&nbsp;seen&nbsp;H/S&nbsp;geometry</div>
<div class="pre"><a id="l1336" href="#l1336" class="linenr">1336</a> ;&nbsp;We&nbsp;compute&nbsp;cylinders&nbsp;separately</div>
<div class="pre"><a id="l1337" href="#l1337" class="linenr">1337</a> ;</div>
<div class="pre"><a id="l1338" href="#l1338" class="linenr">1338</a> .hs_check:</div>
<div class="pre"><a id="l1339" href="#l1339" class="linenr">1339</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bl,[si]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Head&nbsp;#</div>
<div class="pre"><a id="l1340" href="#l1340" class="linenr">1340</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;bl,ah</div>
<div class="pre"><a id="l1341" href="#l1341" class="linenr">1341</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jna&nbsp;.done_track</div>
<div class="pre"><a id="l1342" href="#l1342" class="linenr">1342</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,bl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;New&nbsp;highest&nbsp;head&nbsp;#</div>
<div class="pre"><a id="l1343" href="#l1343" class="linenr">1343</a> .done_track:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bl,[si+1]</div>
<div class="pre"><a id="l1344" href="#l1344" class="linenr">1344</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;bl,3Fh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Sector&nbsp;#</div>
<div class="pre"><a id="l1345" href="#l1345" class="linenr">1345</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;bl,al</div>
<div class="pre"><a id="l1346" href="#l1346" class="linenr">1346</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jna&nbsp;.done_sector</div>
<div class="pre"><a id="l1347" href="#l1347" class="linenr">1347</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;al,bl</div>
<div class="pre"><a id="l1348" href="#l1348" class="linenr">1348</a> .done_sector:&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1349" href="#l1349" class="linenr">1349</a> </div>
<div class="pre"><a id="l1350" href="#l1350" class="linenr">1350</a> ;</div>
<div class="pre"><a id="l1351" href="#l1351" class="linenr">1351</a> ;&nbsp;close_file:</div>
<div class="pre"><a id="l1352" href="#l1352" class="linenr">1352</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Deallocates&nbsp;a&nbsp;file&nbsp;structure&nbsp;(pointer&nbsp;in&nbsp;SI)</div>
<div class="pre"><a id="l1353" href="#l1353" class="linenr">1353</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assumes&nbsp;CS&nbsp;==&nbsp;DS.</div>
<div class="pre"><a id="l1354" href="#l1354" class="linenr">1354</a> ;</div>
<div class="pre"><a id="l1355" href="#l1355" class="linenr">1355</a> close_file:</div>
<div class="pre"><a id="l1356" href="#l1356" class="linenr">1356</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;si,si</div>
<div class="pre"><a id="l1357" href="#l1357" class="linenr">1357</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.closed</div>
<div class="pre"><a id="l1358" href="#l1358" class="linenr">1358</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;dword&nbsp;[si],0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;First&nbsp;dword&nbsp;==&nbsp;file_left</div>
<div class="pre"><a id="l1359" href="#l1359" class="linenr">1359</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;si,si</div>
<div class="pre"><a id="l1360" href="#l1360" class="linenr">1360</a> .closed:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1361" href="#l1361" class="linenr">1361</a> </div>
<div class="pre"><a id="l1362" href="#l1362" class="linenr">1362</a> ;</div>
<div class="pre"><a id="l1363" href="#l1363" class="linenr">1363</a> ;&nbsp;searchdir:</div>
<div class="pre"><a id="l1364" href="#l1364" class="linenr">1364</a> ;</div>
<div class="pre"><a id="l1365" href="#l1365" class="linenr">1365</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Open&nbsp;a&nbsp;file</div>
<div class="pre"><a id="l1366" href="#l1366" class="linenr">1366</a> ;</div>
<div class="pre"><a id="l1367" href="#l1367" class="linenr">1367</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;entry:</div>
<div class="pre"><a id="l1368" href="#l1368" class="linenr">1368</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS:DI&nbsp;&nbsp;&nbsp;=&nbsp;filename</div>
<div class="pre"><a id="l1369" href="#l1369" class="linenr">1369</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;successful:</div>
<div class="pre"><a id="l1370" href="#l1370" class="linenr">1370</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZF&nbsp;clear</div>
<div class="pre"><a id="l1371" href="#l1371" class="linenr">1371</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;file&nbsp;pointer</div>
<div class="pre"><a id="l1372" href="#l1372" class="linenr">1372</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;file&nbsp;length&nbsp;in&nbsp;bytes</div>
<div class="pre"><a id="l1373" href="#l1373" class="linenr">1373</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;unsuccessful</div>
<div class="pre"><a id="l1374" href="#l1374" class="linenr">1374</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZF&nbsp;set</div>
<div class="pre"><a id="l1375" href="#l1375" class="linenr">1375</a> ;</div>
<div class="pre"><a id="l1376" href="#l1376" class="linenr">1376</a> ;&nbsp;Assumes&nbsp;CS&nbsp;==&nbsp;DS&nbsp;==&nbsp;ES,&nbsp;and&nbsp;trashes&nbsp;BX&nbsp;and&nbsp;CX.</div>
<div class="pre"><a id="l1377" href="#l1377" class="linenr">1377</a> ;</div>
<div class="pre"><a id="l1378" href="#l1378" class="linenr">1378</a> ;&nbsp;searchdir_iso&nbsp;is&nbsp;a&nbsp;special&nbsp;entry&nbsp;point&nbsp;for&nbsp;ISOLINUX&nbsp;only.&nbsp;&nbsp;In&nbsp;addition</div>
<div class="pre"><a id="l1379" href="#l1379" class="linenr">1379</a> ;&nbsp;to&nbsp;the&nbsp;above,&nbsp;searchdir_iso&nbsp;passes&nbsp;a&nbsp;file&nbsp;flag&nbsp;mask&nbsp;in&nbsp;AL.&nbsp;&nbsp;This&nbsp;is&nbsp;useful</div>
<div class="pre"><a id="l1380" href="#l1380" class="linenr">1380</a> ;&nbsp;for&nbsp;searching&nbsp;for&nbsp;directories.</div>
<div class="pre"><a id="l1381" href="#l1381" class="linenr">1381</a> ;</div>
<div class="pre"><a id="l1382" href="#l1382" class="linenr">1382</a> alloc_failure:</div>
<div class="pre"><a id="l1383" href="#l1383" class="linenr">1383</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ax,ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ZF&nbsp;&lt;-&nbsp;1</div>
<div class="pre"><a id="l1384" href="#l1384" class="linenr">1384</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1385" href="#l1385" class="linenr">1385</a> </div>
<div class="pre"><a id="l1386" href="#l1386" class="linenr">1386</a> searchdir:</div>
<div class="pre"><a id="l1387" href="#l1387" class="linenr">1387</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;al,al</div>
<div class="pre"><a id="l1388" href="#l1388" class="linenr">1388</a> searchdir_iso:</div>
<div class="pre"><a id="l1389" href="#l1389" class="linenr">1389</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[ISOFlags],al</div>
<div class="pre"><a id="l1390" href="#l1390" class="linenr">1390</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;S&#39;</div>
<div class="pre"><a id="l1391" href="#l1391" class="linenr">1391</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;allocate_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Temporary&nbsp;file&nbsp;structure&nbsp;for&nbsp;directory</div>
<div class="pre"><a id="l1392" href="#l1392" class="linenr">1392</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;alloc_failure</div>
<div class="pre"><a id="l1393" href="#l1393" class="linenr">1393</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;es</div>
<div class="pre"><a id="l1394" href="#l1394" class="linenr">1394</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ds</div>
<div class="pre"><a id="l1395" href="#l1395" class="linenr">1395</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;es&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ES&nbsp;=&nbsp;DS</div>
<div class="pre"><a id="l1396" href="#l1396" class="linenr">1396</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,CurrentDir</div>
<div class="pre"><a id="l1397" href="#l1397" class="linenr">1397</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;byte&nbsp;[di],&#39;/&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;If&nbsp;filename&nbsp;begins&nbsp;with&nbsp;slash</div>
<div class="pre"><a id="l1398" href="#l1398" class="linenr">1398</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;.not_rooted</div>
<div class="pre"><a id="l1399" href="#l1399" class="linenr">1399</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Skip&nbsp;leading&nbsp;slash</div>
<div class="pre"><a id="l1400" href="#l1400" class="linenr">1400</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,RootDir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Reference&nbsp;root&nbsp;directory&nbsp;instead</div>
<div class="pre"><a id="l1401" href="#l1401" class="linenr">1401</a> .not_rooted:</div>
<div class="pre"><a id="l1402" href="#l1402" class="linenr">1402</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+dir_clust]</div>
<div class="pre"><a id="l1403" href="#l1403" class="linenr">1403</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bx+file_left],eax</div>
<div class="pre"><a id="l1404" href="#l1404" class="linenr">1404</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;eax,SECTOR_SHIFT</div>
<div class="pre"><a id="l1405" href="#l1405" class="linenr">1405</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bx+file_bytesleft],eax</div>
<div class="pre"><a id="l1406" href="#l1406" class="linenr">1406</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+dir_lba]</div>
<div class="pre"><a id="l1407" href="#l1407" class="linenr">1407</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bx+file_sector],eax</div>
<div class="pre"><a id="l1408" href="#l1408" class="linenr">1408</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;edx,[si+dir_len]</div>
<div class="pre"><a id="l1409" href="#l1409" class="linenr">1409</a> </div>
<div class="pre"><a id="l1410" href="#l1410" class="linenr">1410</a> .look_for_slash:</div>
<div class="pre"><a id="l1411" href="#l1411" class="linenr">1411</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ax,di</div>
<div class="pre"><a id="l1412" href="#l1412" class="linenr">1412</a> .scan:</div>
<div class="pre"><a id="l1413" href="#l1413" class="linenr">1413</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cl,[di]</div>
<div class="pre"><a id="l1414" href="#l1414" class="linenr">1414</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;di</div>
<div class="pre"><a id="l1415" href="#l1415" class="linenr">1415</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;cl,cl</div>
<div class="pre"><a id="l1416" href="#l1416" class="linenr">1416</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.isfile</div>
<div class="pre"><a id="l1417" href="#l1417" class="linenr">1417</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;cl,&#39;/&#39;</div>
<div class="pre"><a id="l1418" href="#l1418" class="linenr">1418</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;.scan</div>
<div class="pre"><a id="l1419" href="#l1419" class="linenr">1419</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[di-1],byte&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Terminate&nbsp;at&nbsp;directory&nbsp;name</div>
<div class="pre"><a id="l1420" href="#l1420" class="linenr">1420</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cl,02h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Search&nbsp;for&nbsp;directory</div>
<div class="pre"><a id="l1421" href="#l1421" class="linenr">1421</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;cl,[ISOFlags]</div>
<div class="pre"><a id="l1422" href="#l1422" class="linenr">1422</a> </div>
<div class="pre"><a id="l1423" href="#l1423" class="linenr">1423</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Save&nbsp;these...</div>
<div class="pre"><a id="l1424" href="#l1424" class="linenr">1424</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;cx</div>
<div class="pre"><a id="l1425" href="#l1425" class="linenr">1425</a> </div>
<div class="pre"><a id="l1426" href="#l1426" class="linenr">1426</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Create&nbsp;recursion&nbsp;stack&nbsp;frame...</div>
<div class="pre"><a id="l1427" href="#l1427" class="linenr">1427</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;word&nbsp;.resume&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Where&nbsp;to&nbsp;&quot;return&quot;&nbsp;to</div>
<div class="pre"><a id="l1428" href="#l1428" class="linenr">1428</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;es</div>
<div class="pre"><a id="l1429" href="#l1429" class="linenr">1429</a> .isfile:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;ax,di</div>
<div class="pre"><a id="l1430" href="#l1430" class="linenr">1430</a> </div>
<div class="pre"><a id="l1431" href="#l1431" class="linenr">1431</a> .getsome:</div>
<div class="pre"><a id="l1432" href="#l1432" class="linenr">1432</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Get&nbsp;a&nbsp;chunk&nbsp;of&nbsp;the&nbsp;directory</div>
<div class="pre"><a id="l1433" href="#l1433" class="linenr">1433</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;relies&nbsp;on&nbsp;the&nbsp;fact&nbsp;that&nbsp;ISOLINUX&nbsp;doesn&#39;t&nbsp;change&nbsp;SI</div>
<div class="pre"><a id="l1434" href="#l1434" class="linenr">1434</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,trackbuf</div>
<div class="pre"><a id="l1435" href="#l1435" class="linenr">1435</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;g&#39;</div>
<div class="pre"><a id="l1436" href="#l1436" class="linenr">1436</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushad</div>
<div class="pre"><a id="l1437" href="#l1437" class="linenr">1437</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;bx,si</div>
<div class="pre"><a id="l1438" href="#l1438" class="linenr">1438</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,[BufSafe]</div>
<div class="pre"><a id="l1439" href="#l1439" class="linenr">1439</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getfssec</div>
<div class="pre"><a id="l1440" href="#l1440" class="linenr">1440</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popad</div>
<div class="pre"><a id="l1441" href="#l1441" class="linenr">1441</a> </div>
<div class="pre"><a id="l1442" href="#l1442" class="linenr">1442</a> .compare:</div>
<div class="pre"><a id="l1443" href="#l1443" class="linenr">1443</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;eax,byte&nbsp;[si]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Length&nbsp;of&nbsp;directory&nbsp;entry</div>
<div class="pre"><a id="l1444" href="#l1444" class="linenr">1444</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,33</div>
<div class="pre"><a id="l1445" href="#l1445" class="linenr">1445</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jb&nbsp;.next_sector</div>
<div class="pre"><a id="l1446" href="#l1446" class="linenr">1446</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;c&#39;</div>
<div class="pre"><a id="l1447" href="#l1447" class="linenr">1447</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cl,[si+25]</div>
<div class="pre"><a id="l1448" href="#l1448" class="linenr">1448</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;cl,[ISOFlags]</div>
<div class="pre"><a id="l1449" href="#l1449" class="linenr">1449</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test&nbsp;cl,&nbsp;byte&nbsp;8Eh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Unwanted&nbsp;file&nbsp;attributes!</div>
<div class="pre"><a id="l1450" href="#l1450" class="linenr">1450</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.not_file</div>
<div class="pre"><a id="l1451" href="#l1451" class="linenr">1451</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pusha</div>
<div class="pre"><a id="l1452" href="#l1452" class="linenr">1452</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;cx,byte&nbsp;[si+32]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;File&nbsp;identifier&nbsp;length</div>
<div class="pre"><a id="l1453" href="#l1453" class="linenr">1453</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;si,byte&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;File&nbsp;identifier&nbsp;offset</div>
<div class="pre"><a id="l1454" href="#l1454" class="linenr">1454</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;i&#39;</div>
<div class="pre"><a id="l1455" href="#l1455" class="linenr">1455</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;iso_compare_names</div>
<div class="pre"><a id="l1456" href="#l1456" class="linenr">1456</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popa</div>
<div class="pre"><a id="l1457" href="#l1457" class="linenr">1457</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.success</div>
<div class="pre"><a id="l1458" href="#l1458" class="linenr">1458</a> .not_file:</div>
<div class="pre"><a id="l1459" href="#l1459" class="linenr">1459</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;edx,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Decrease&nbsp;bytes&nbsp;left</div>
<div class="pre"><a id="l1460" href="#l1460" class="linenr">1460</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbe&nbsp;.failure</div>
<div class="pre"><a id="l1461" href="#l1461" class="linenr">1461</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;si,ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Advance&nbsp;pointer</div>
<div class="pre"><a id="l1462" href="#l1462" class="linenr">1462</a> </div>
<div class="pre"><a id="l1463" href="#l1463" class="linenr">1463</a> .check_overrun:</div>
<div class="pre"><a id="l1464" href="#l1464" class="linenr">1464</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Did&nbsp;we&nbsp;finish&nbsp;the&nbsp;buffer?</div>
<div class="pre"><a id="l1465" href="#l1465" class="linenr">1465</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;si,trackbuf+trackbufsize</div>
<div class="pre"><a id="l1466" href="#l1466" class="linenr">1466</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jb&nbsp;.compare&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;No,&nbsp;keep&nbsp;going</div>
<div class="pre"><a id="l1467" href="#l1467" class="linenr">1467</a> </div>
<div class="pre"><a id="l1468" href="#l1468" class="linenr">1468</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;short&nbsp;.getsome&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Get&nbsp;some&nbsp;more&nbsp;directory</div>
<div class="pre"><a id="l1469" href="#l1469" class="linenr">1469</a> </div>
<div class="pre"><a id="l1470" href="#l1470" class="linenr">1470</a> .next_sector:</div>
<div class="pre"><a id="l1471" href="#l1471" class="linenr">1471</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Advance&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;next&nbsp;sector</div>
<div class="pre"><a id="l1472" href="#l1472" class="linenr">1472</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;ax,[si+SECTOR_SIZE-1]</div>
<div class="pre"><a id="l1473" href="#l1473" class="linenr">1473</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;ax,~(SECTOR_SIZE-1)</div>
<div class="pre"><a id="l1474" href="#l1474" class="linenr">1474</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;ax,si</div>
<div class="pre"><a id="l1475" href="#l1475" class="linenr">1475</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;short&nbsp;.not_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;We&nbsp;still&nbsp;need&nbsp;to&nbsp;do&nbsp;length&nbsp;checks</div>
<div class="pre"><a id="l1476" href="#l1476" class="linenr">1476</a> </div>
<div class="pre"><a id="l1477" href="#l1477" class="linenr">1477</a> .failure:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;eax,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ZF&nbsp;=&nbsp;1</div>
<div class="pre"><a id="l1478" href="#l1478" class="linenr">1478</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bx+file_sector],eax</div>
<div class="pre"><a id="l1479" href="#l1479" class="linenr">1479</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;es</div>
<div class="pre"><a id="l1480" href="#l1480" class="linenr">1480</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1481" href="#l1481" class="linenr">1481</a> </div>
<div class="pre"><a id="l1482" href="#l1482" class="linenr">1482</a> .success:</div>
<div class="pre"><a id="l1483" href="#l1483" class="linenr">1483</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+2]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Location&nbsp;of&nbsp;extent</div>
<div class="pre"><a id="l1484" href="#l1484" class="linenr">1484</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bx+file_sector],eax</div>
<div class="pre"><a id="l1485" href="#l1485" class="linenr">1485</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+10]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Data&nbsp;length</div>
<div class="pre"><a id="l1486" href="#l1486" class="linenr">1486</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bx+file_bytesleft],eax</div>
<div class="pre"><a id="l1487" href="#l1487" class="linenr">1487</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;eax</div>
<div class="pre"><a id="l1488" href="#l1488" class="linenr">1488</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;eax,SECTOR_SIZE-1</div>
<div class="pre"><a id="l1489" href="#l1489" class="linenr">1489</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr&nbsp;eax,SECTOR_SHIFT</div>
<div class="pre"><a id="l1490" href="#l1490" class="linenr">1490</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[bx+file_left],eax</div>
<div class="pre"><a id="l1491" href="#l1491" class="linenr">1491</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;eax</div>
<div class="pre"><a id="l1492" href="#l1492" class="linenr">1492</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.failure&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Empty&nbsp;file?</div>
<div class="pre"><a id="l1493" href="#l1493" class="linenr">1493</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ZF&nbsp;=&nbsp;0</div>
<div class="pre"><a id="l1494" href="#l1494" class="linenr">1494</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,bx</div>
<div class="pre"><a id="l1495" href="#l1495" class="linenr">1495</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;es</div>
<div class="pre"><a id="l1496" href="#l1496" class="linenr">1496</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1497" href="#l1497" class="linenr">1497</a> </div>
<div class="pre"><a id="l1498" href="#l1498" class="linenr">1498</a> .resume:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;We&nbsp;get&nbsp;here&nbsp;if&nbsp;we&nbsp;were&nbsp;only&nbsp;doing&nbsp;part&nbsp;of&nbsp;a&nbsp;lookup</div>
<div class="pre"><a id="l1499" href="#l1499" class="linenr">1499</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;relies&nbsp;on&nbsp;the&nbsp;fact&nbsp;that&nbsp;.success&nbsp;returns&nbsp;bx&nbsp;==&nbsp;si</div>
<div class="pre"><a id="l1500" href="#l1500" class="linenr">1500</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg&nbsp;edx,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Directory&nbsp;length&nbsp;in&nbsp;edx</div>
<div class="pre"><a id="l1501" href="#l1501" class="linenr">1501</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;cx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Old&nbsp;ISOFlags</div>
<div class="pre"><a id="l1502" href="#l1502" class="linenr">1502</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Next&nbsp;filename&nbsp;pointer</div>
<div class="pre"><a id="l1503" href="#l1503" class="linenr">1503</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;byte&nbsp;[di-1],&nbsp;&#39;/&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Restore&nbsp;slash</div>
<div class="pre"><a id="l1504" href="#l1504" class="linenr">1504</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[ISOFlags],cl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Restore&nbsp;the&nbsp;flags</div>
<div class="pre"><a id="l1505" href="#l1505" class="linenr">1505</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.failure&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Did&nbsp;we&nbsp;fail?&nbsp;&nbsp;If&nbsp;so&nbsp;fail&nbsp;for&nbsp;real!</div>
<div class="pre"><a id="l1506" href="#l1506" class="linenr">1506</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;.look_for_slash&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Otherwise,&nbsp;next&nbsp;level</div>
<div class="pre"><a id="l1507" href="#l1507" class="linenr">1507</a> </div>
<div class="pre"><a id="l1508" href="#l1508" class="linenr">1508</a> ;</div>
<div class="pre"><a id="l1509" href="#l1509" class="linenr">1509</a> ;&nbsp;allocate_file:&nbsp;Allocate&nbsp;a&nbsp;file&nbsp;structure</div>
<div class="pre"><a id="l1510" href="#l1510" class="linenr">1510</a> ;</div>
<div class="pre"><a id="l1511" href="#l1511" class="linenr">1511</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;successful:</div>
<div class="pre"><a id="l1512" href="#l1512" class="linenr">1512</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZF&nbsp;set</div>
<div class="pre"><a id="l1513" href="#l1513" class="linenr">1513</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BX&nbsp;=&nbsp;file&nbsp;pointer</div>
<div class="pre"><a id="l1514" href="#l1514" class="linenr">1514</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;unsuccessful:</div>
<div class="pre"><a id="l1515" href="#l1515" class="linenr">1515</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZF&nbsp;clear</div>
<div class="pre"><a id="l1516" href="#l1516" class="linenr">1516</a> ;</div>
<div class="pre"><a id="l1517" href="#l1517" class="linenr">1517</a> allocate_file:</div>
<div class="pre"><a id="l1518" href="#l1518" class="linenr">1518</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;a&#39;</div>
<div class="pre"><a id="l1519" href="#l1519" class="linenr">1519</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;cx</div>
<div class="pre"><a id="l1520" href="#l1520" class="linenr">1520</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,Files</div>
<div class="pre"><a id="l1521" href="#l1521" class="linenr">1521</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,MAX_OPEN</div>
<div class="pre"><a id="l1522" href="#l1522" class="linenr">1522</a> .check:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;dword&nbsp;[bx],&nbsp;byte&nbsp;0</div>
<div class="pre"><a id="l1523" href="#l1523" class="linenr">1523</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.found</div>
<div class="pre"><a id="l1524" href="#l1524" class="linenr">1524</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;bx,open_file_t_size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ZF&nbsp;=&nbsp;0</div>
<div class="pre"><a id="l1525" href="#l1525" class="linenr">1525</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;.check</div>
<div class="pre"><a id="l1526" href="#l1526" class="linenr">1526</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ZF&nbsp;=&nbsp;0&nbsp;if&nbsp;we&nbsp;fell&nbsp;out&nbsp;of&nbsp;the&nbsp;loop</div>
<div class="pre"><a id="l1527" href="#l1527" class="linenr">1527</a> .found:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;cx</div>
<div class="pre"><a id="l1528" href="#l1528" class="linenr">1528</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1529" href="#l1529" class="linenr">1529</a> </div>
<div class="pre"><a id="l1530" href="#l1530" class="linenr">1530</a> ;</div>
<div class="pre"><a id="l1531" href="#l1531" class="linenr">1531</a> ;&nbsp;iso_compare_names:</div>
<div class="pre"><a id="l1532" href="#l1532" class="linenr">1532</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Compare&nbsp;the&nbsp;names&nbsp;DS:SI&nbsp;and&nbsp;DS:DI&nbsp;and&nbsp;report&nbsp;if&nbsp;they&nbsp;are</div>
<div class="pre"><a id="l1533" href="#l1533" class="linenr">1533</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equal&nbsp;from&nbsp;an&nbsp;ISO&nbsp;9660&nbsp;perspective.&nbsp;&nbsp;SI&nbsp;is&nbsp;the&nbsp;name&nbsp;from</div>
<div class="pre"><a id="l1534" href="#l1534" class="linenr">1534</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;filesystem;&nbsp;CX&nbsp;indicates&nbsp;its&nbsp;length,&nbsp;and&nbsp;&#39;;&#39;&nbsp;terminates.</div>
<div class="pre"><a id="l1535" href="#l1535" class="linenr">1535</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DI&nbsp;is&nbsp;expected&nbsp;to&nbsp;end&nbsp;with&nbsp;a&nbsp;null.</div>
<div class="pre"><a id="l1536" href="#l1536" class="linenr">1536</a> ;</div>
<div class="pre"><a id="l1537" href="#l1537" class="linenr">1537</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;clobbers&nbsp;AX,&nbsp;CX,&nbsp;SI,&nbsp;DI;&nbsp;assumes&nbsp;DS&nbsp;==&nbsp;ES&nbsp;==&nbsp;base&nbsp;segment</div>
<div class="pre"><a id="l1538" href="#l1538" class="linenr">1538</a> ;</div>
<div class="pre"><a id="l1539" href="#l1539" class="linenr">1539</a> </div>
<div class="pre"><a id="l1540" href="#l1540" class="linenr">1540</a> iso_compare_names:</div>
<div class="pre"><a id="l1541" href="#l1541" class="linenr">1541</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;First,&nbsp;terminate&nbsp;and&nbsp;canonicalize&nbsp;input&nbsp;filename</div>
<div class="pre"><a id="l1542" href="#l1542" class="linenr">1542</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di</div>
<div class="pre"><a id="l1543" href="#l1543" class="linenr">1543</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;di,ISOFileName</div>
<div class="pre"><a id="l1544" href="#l1544" class="linenr">1544</a> .canon_loop:&nbsp;&nbsp;&nbsp;&nbsp;jcxz&nbsp;.canon_end</div>
<div class="pre"><a id="l1545" href="#l1545" class="linenr">1545</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lodsb</div>
<div class="pre"><a id="l1546" href="#l1546" class="linenr">1546</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;cx</div>
<div class="pre"><a id="l1547" href="#l1547" class="linenr">1547</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,&#39;;&#39;</div>
<div class="pre"><a id="l1548" href="#l1548" class="linenr">1548</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.canon_end</div>
<div class="pre"><a id="l1549" href="#l1549" class="linenr">1549</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;al,al</div>
<div class="pre"><a id="l1550" href="#l1550" class="linenr">1550</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.canon_end</div>
<div class="pre"><a id="l1551" href="#l1551" class="linenr">1551</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stosb</div>
<div class="pre"><a id="l1552" href="#l1552" class="linenr">1552</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;di,ISOFileNameEnd-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Guard&nbsp;against&nbsp;buffer&nbsp;overrun</div>
<div class="pre"><a id="l1553" href="#l1553" class="linenr">1553</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jb&nbsp;.canon_loop</div>
<div class="pre"><a id="l1554" href="#l1554" class="linenr">1554</a> .canon_end:</div>
<div class="pre"><a id="l1555" href="#l1555" class="linenr">1555</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;di,ISOFileName</div>
<div class="pre"><a id="l1556" href="#l1556" class="linenr">1556</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbe&nbsp;.canon_done</div>
<div class="pre"><a id="l1557" href="#l1557" class="linenr">1557</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;byte&nbsp;[di-1],&#39;.&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Remove&nbsp;terminal&nbsp;dots</div>
<div class="pre"><a id="l1558" href="#l1558" class="linenr">1558</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;.canon_done</div>
<div class="pre"><a id="l1559" href="#l1559" class="linenr">1559</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;di</div>
<div class="pre"><a id="l1560" href="#l1560" class="linenr">1560</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;short&nbsp;.canon_end</div>
<div class="pre"><a id="l1561" href="#l1561" class="linenr">1561</a> .canon_done:</div>
<div class="pre"><a id="l1562" href="#l1562" class="linenr">1562</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[di],byte&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Null-terminate&nbsp;string</div>
<div class="pre"><a id="l1563" href="#l1563" class="linenr">1563</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;di</div>
<div class="pre"><a id="l1564" href="#l1564" class="linenr">1564</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,ISOFileName</div>
<div class="pre"><a id="l1565" href="#l1565" class="linenr">1565</a> .compare:</div>
<div class="pre"><a id="l1566" href="#l1566" class="linenr">1566</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lodsb</div>
<div class="pre"><a id="l1567" href="#l1567" class="linenr">1567</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,[di]</div>
<div class="pre"><a id="l1568" href="#l1568" class="linenr">1568</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;di</div>
<div class="pre"><a id="l1569" href="#l1569" class="linenr">1569</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;ax,ax</div>
<div class="pre"><a id="l1570" href="#l1570" class="linenr">1570</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.success&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;End&nbsp;of&nbsp;string&nbsp;for&nbsp;both</div>
<div class="pre"><a id="l1571" href="#l1571" class="linenr">1571</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;al,al&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Is&nbsp;either&nbsp;one&nbsp;end&nbsp;of&nbsp;string?</div>
<div class="pre"><a id="l1572" href="#l1572" class="linenr">1572</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.failure&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;If&nbsp;so,&nbsp;failure</div>
<div class="pre"><a id="l1573" href="#l1573" class="linenr">1573</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;ah,ah</div>
<div class="pre"><a id="l1574" href="#l1574" class="linenr">1574</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jz&nbsp;.failure</div>
<div class="pre"><a id="l1575" href="#l1575" class="linenr">1575</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;ax,2020h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;to&nbsp;lower&nbsp;case</div>
<div class="pre"><a id="l1576" href="#l1576" class="linenr">1576</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,ah</div>
<div class="pre"><a id="l1577" href="#l1577" class="linenr">1577</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.compare</div>
<div class="pre"><a id="l1578" href="#l1578" class="linenr">1578</a> .failure:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;ax,ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ZF&nbsp;=&nbsp;0&nbsp;(at&nbsp;least&nbsp;one&nbsp;will&nbsp;be&nbsp;nonzero)</div>
<div class="pre"><a id="l1579" href="#l1579" class="linenr">1579</a> .success:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1580" href="#l1580" class="linenr">1580</a> </div>
<div class="pre"><a id="l1581" href="#l1581" class="linenr">1581</a> ;</div>
<div class="pre"><a id="l1582" href="#l1582" class="linenr">1582</a> ;&nbsp;mangle_name:&nbsp;Mangle&nbsp;a&nbsp;filename&nbsp;pointed&nbsp;to&nbsp;by&nbsp;DS:SI&nbsp;into&nbsp;a&nbsp;buffer&nbsp;pointed</div>
<div class="pre"><a id="l1583" href="#l1583" class="linenr">1583</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;by&nbsp;ES:DI;&nbsp;ends&nbsp;on&nbsp;encountering&nbsp;any&nbsp;whitespace.</div>
<div class="pre"><a id="l1584" href="#l1584" class="linenr">1584</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DI&nbsp;is&nbsp;preserved.</div>
<div class="pre"><a id="l1585" href="#l1585" class="linenr">1585</a> ;</div>
<div class="pre"><a id="l1586" href="#l1586" class="linenr">1586</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;verifies&nbsp;that&nbsp;a&nbsp;filename&nbsp;is&nbsp;&lt;&nbsp;FILENAME_MAX&nbsp;characters,</div>
<div class="pre"><a id="l1587" href="#l1587" class="linenr">1587</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doesn&#39;t&nbsp;contain&nbsp;whitespace,&nbsp;zero-pads&nbsp;the&nbsp;output&nbsp;buffer,</div>
<div class="pre"><a id="l1588" href="#l1588" class="linenr">1588</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;removes&nbsp;trailing&nbsp;dots&nbsp;and&nbsp;redundant&nbsp;slashes,</div>
<div class="pre"><a id="l1589" href="#l1589" class="linenr">1589</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;&quot;repe&nbsp;cmpsb&quot;&nbsp;can&nbsp;do&nbsp;a&nbsp;compare,&nbsp;and&nbsp;the</div>
<div class="pre"><a id="l1590" href="#l1590" class="linenr">1590</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path-searching&nbsp;routine&nbsp;gets&nbsp;a&nbsp;bit&nbsp;of&nbsp;an&nbsp;easier&nbsp;job.</div>
<div class="pre"><a id="l1591" href="#l1591" class="linenr">1591</a> ;</div>
<div class="pre"><a id="l1592" href="#l1592" class="linenr">1592</a> mangle_name:</div>
<div class="pre"><a id="l1593" href="#l1593" class="linenr">1593</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;di</div>
<div class="pre"><a id="l1594" href="#l1594" class="linenr">1594</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;bx</div>
<div class="pre"><a id="l1595" href="#l1595" class="linenr">1595</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ax,ax</div>
<div class="pre"><a id="l1596" href="#l1596" class="linenr">1596</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;cx,FILENAME_MAX-1</div>
<div class="pre"><a id="l1597" href="#l1597" class="linenr">1597</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bx,di</div>
<div class="pre"><a id="l1598" href="#l1598" class="linenr">1598</a> </div>
<div class="pre"><a id="l1599" href="#l1599" class="linenr">1599</a> .mn_loop:</div>
<div class="pre"><a id="l1600" href="#l1600" class="linenr">1600</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lodsb</div>
<div class="pre"><a id="l1601" href="#l1601" class="linenr">1601</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,&#39;&nbsp;&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;If&nbsp;control&nbsp;or&nbsp;space,&nbsp;end</div>
<div class="pre"><a id="l1602" href="#l1602" class="linenr">1602</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jna&nbsp;.mn_end</div>
<div class="pre"><a id="l1603" href="#l1603" class="linenr">1603</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,ah&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Repeated&nbsp;slash?</div>
<div class="pre"><a id="l1604" href="#l1604" class="linenr">1604</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.mn_skip</div>
<div class="pre"><a id="l1605" href="#l1605" class="linenr">1605</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ah,ah</div>
<div class="pre"><a id="l1606" href="#l1606" class="linenr">1606</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;al,&#39;/&#39;</div>
<div class="pre"><a id="l1607" href="#l1607" class="linenr">1607</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;.mn_ok</div>
<div class="pre"><a id="l1608" href="#l1608" class="linenr">1608</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ah,al</div>
<div class="pre"><a id="l1609" href="#l1609" class="linenr">1609</a> .mn_ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stosb</div>
<div class="pre"><a id="l1610" href="#l1610" class="linenr">1610</a> .mn_skip:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;.mn_loop</div>
<div class="pre"><a id="l1611" href="#l1611" class="linenr">1611</a> .mn_end:</div>
<div class="pre"><a id="l1612" href="#l1612" class="linenr">1612</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;bx,di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;At&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;buffer?</div>
<div class="pre"><a id="l1613" href="#l1613" class="linenr">1613</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jbe&nbsp;.mn_zero</div>
<div class="pre"><a id="l1614" href="#l1614" class="linenr">1614</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;byte&nbsp;[es:di-1],&#39;.&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Terminal&nbsp;dot?</div>
<div class="pre"><a id="l1615" href="#l1615" class="linenr">1615</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je&nbsp;.mn_kill</div>
<div class="pre"><a id="l1616" href="#l1616" class="linenr">1616</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;byte&nbsp;[es:di-1],&#39;/&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Terminal&nbsp;slash?</div>
<div class="pre"><a id="l1617" href="#l1617" class="linenr">1617</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jne&nbsp;.mn_zero</div>
<div class="pre"><a id="l1618" href="#l1618" class="linenr">1618</a> .mn_kill:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;If&nbsp;so,&nbsp;remove&nbsp;it</div>
<div class="pre"><a id="l1619" href="#l1619" class="linenr">1619</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;cx</div>
<div class="pre"><a id="l1620" href="#l1620" class="linenr">1620</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;short&nbsp;.mn_end</div>
<div class="pre"><a id="l1621" href="#l1621" class="linenr">1621</a> .mn_zero:</div>
<div class="pre"><a id="l1622" href="#l1622" class="linenr">1622</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inc&nbsp;cx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;At&nbsp;least&nbsp;one&nbsp;null&nbsp;byte</div>
<div class="pre"><a id="l1623" href="#l1623" class="linenr">1623</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;ax,ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Zero-fill&nbsp;name</div>
<div class="pre"><a id="l1624" href="#l1624" class="linenr">1624</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rep&nbsp;stosb</div>
<div class="pre"><a id="l1625" href="#l1625" class="linenr">1625</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;bx</div>
<div class="pre"><a id="l1626" href="#l1626" class="linenr">1626</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;di</div>
<div class="pre"><a id="l1627" href="#l1627" class="linenr">1627</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Done</div>
<div class="pre"><a id="l1628" href="#l1628" class="linenr">1628</a> </div>
<div class="pre"><a id="l1629" href="#l1629" class="linenr">1629</a> ;</div>
<div class="pre"><a id="l1630" href="#l1630" class="linenr">1630</a> ;&nbsp;unmangle_name:&nbsp;Does&nbsp;the&nbsp;opposite&nbsp;of&nbsp;mangle_name;&nbsp;converts&nbsp;a&nbsp;DOS-mangled</div>
<div class="pre"><a id="l1631" href="#l1631" class="linenr">1631</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;to&nbsp;the&nbsp;conventional&nbsp;representation.&nbsp;&nbsp;This&nbsp;is&nbsp;needed</div>
<div class="pre"><a id="l1632" href="#l1632" class="linenr">1632</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;the&nbsp;BOOT_IMAGE=&nbsp;parameter&nbsp;for&nbsp;the&nbsp;kernel.</div>
<div class="pre"><a id="l1633" href="#l1633" class="linenr">1633</a> ;</div>
<div class="pre"><a id="l1634" href="#l1634" class="linenr">1634</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS:SI&nbsp;-&gt;&nbsp;input&nbsp;mangled&nbsp;file&nbsp;name</div>
<div class="pre"><a id="l1635" href="#l1635" class="linenr">1635</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ES:DI&nbsp;-&gt;&nbsp;output&nbsp;buffer</div>
<div class="pre"><a id="l1636" href="#l1636" class="linenr">1636</a> ;</div>
<div class="pre"><a id="l1637" href="#l1637" class="linenr">1637</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;return,&nbsp;DI&nbsp;points&nbsp;to&nbsp;the&nbsp;first&nbsp;byte&nbsp;after&nbsp;the&nbsp;output&nbsp;name,</div>
<div class="pre"><a id="l1638" href="#l1638" class="linenr">1638</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;is&nbsp;set&nbsp;to&nbsp;a&nbsp;null&nbsp;byte.</div>
<div class="pre"><a id="l1639" href="#l1639" class="linenr">1639</a> ;</div>
<div class="pre"><a id="l1640" href="#l1640" class="linenr">1640</a> unmangle_name:&nbsp;&nbsp;call&nbsp;strcpy</div>
<div class="pre"><a id="l1641" href="#l1641" class="linenr">1641</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dec&nbsp;di&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Point&nbsp;to&nbsp;final&nbsp;null&nbsp;byte</div>
<div class="pre"><a id="l1642" href="#l1642" class="linenr">1642</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1643" href="#l1643" class="linenr">1643</a> </div>
<div class="pre"><a id="l1644" href="#l1644" class="linenr">1644</a> ;</div>
<div class="pre"><a id="l1645" href="#l1645" class="linenr">1645</a> ;&nbsp;getfssec:&nbsp;Get&nbsp;multiple&nbsp;clusters&nbsp;from&nbsp;a&nbsp;file,&nbsp;given&nbsp;the&nbsp;file&nbsp;pointer.</div>
<div class="pre"><a id="l1646" href="#l1646" class="linenr">1646</a> ;</div>
<div class="pre"><a id="l1647" href="#l1647" class="linenr">1647</a> ;&nbsp;&nbsp;On&nbsp;entry:</div>
<div class="pre"><a id="l1648" href="#l1648" class="linenr">1648</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ES:BX&nbsp;&nbsp;&nbsp;-&gt;&nbsp;Buffer</div>
<div class="pre"><a id="l1649" href="#l1649" class="linenr">1649</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;File&nbsp;pointer</div>
<div class="pre"><a id="l1650" href="#l1650" class="linenr">1650</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;Cluster&nbsp;count</div>
<div class="pre"><a id="l1651" href="#l1651" class="linenr">1651</a> ;&nbsp;&nbsp;On&nbsp;exit:</div>
<div class="pre"><a id="l1652" href="#l1652" class="linenr">1652</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;File&nbsp;pointer&nbsp;(or&nbsp;0&nbsp;on&nbsp;EOF)</div>
<div class="pre"><a id="l1653" href="#l1653" class="linenr">1653</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CF&nbsp;=&nbsp;1&nbsp;&nbsp;-&gt;&nbsp;Hit&nbsp;EOF</div>
<div class="pre"><a id="l1654" href="#l1654" class="linenr">1654</a> ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ECX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;Bytes&nbsp;actually&nbsp;read</div>
<div class="pre"><a id="l1655" href="#l1655" class="linenr">1655</a> ;</div>
<div class="pre"><a id="l1656" href="#l1656" class="linenr">1656</a> getfssec:</div>
<div class="pre"><a id="l1657" href="#l1657" class="linenr">1657</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;F&#39;</div>
<div class="pre"><a id="l1658" href="#l1658" class="linenr">1658</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;ds</div>
<div class="pre"><a id="l1659" href="#l1659" class="linenr">1659</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;cs</div>
<div class="pre"><a id="l1660" href="#l1660" class="linenr">1660</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;DS&nbsp;&lt;-&nbsp;CS</div>
<div class="pre"><a id="l1661" href="#l1661" class="linenr">1661</a> </div>
<div class="pre"><a id="l1662" href="#l1662" class="linenr">1662</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movzx&nbsp;ecx,cx</div>
<div class="pre"><a id="l1663" href="#l1663" class="linenr">1663</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;ecx,[si+file_left]</div>
<div class="pre"><a id="l1664" href="#l1664" class="linenr">1664</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jna&nbsp;.ok_size</div>
<div class="pre"><a id="l1665" href="#l1665" class="linenr">1665</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ecx,[si+file_left]</div>
<div class="pre"><a id="l1666" href="#l1666" class="linenr">1666</a> .ok_size:</div>
<div class="pre"><a id="l1667" href="#l1667" class="linenr">1667</a> </div>
<div class="pre"><a id="l1668" href="#l1668" class="linenr">1668</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushad</div>
<div class="pre"><a id="l1669" href="#l1669" class="linenr">1669</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;eax,[si+file_sector]</div>
<div class="pre"><a id="l1670" href="#l1670" class="linenr">1670</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;bp,cx</div>
<div class="pre"><a id="l1671" href="#l1671" class="linenr">1671</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;l&#39;</div>
<div class="pre"><a id="l1672" href="#l1672" class="linenr">1672</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;getlinsec</div>
<div class="pre"><a id="l1673" href="#l1673" class="linenr">1673</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popad</div>
<div class="pre"><a id="l1674" href="#l1674" class="linenr">1674</a> </div>
<div class="pre"><a id="l1675" href="#l1675" class="linenr">1675</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;ECX[31:16]&nbsp;==&nbsp;0&nbsp;here...</div>
<div class="pre"><a id="l1676" href="#l1676" class="linenr">1676</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;[si+file_sector],ecx</div>
<div class="pre"><a id="l1677" href="#l1677" class="linenr">1677</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;[si+file_left],ecx</div>
<div class="pre"><a id="l1678" href="#l1678" class="linenr">1678</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shl&nbsp;ecx,SECTOR_SHIFT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Convert&nbsp;to&nbsp;bytes</div>
<div class="pre"><a id="l1679" href="#l1679" class="linenr">1679</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;ecx,[si+file_bytesleft]</div>
<div class="pre"><a id="l1680" href="#l1680" class="linenr">1680</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jb&nbsp;.not_all</div>
<div class="pre"><a id="l1681" href="#l1681" class="linenr">1681</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;ecx,[si+file_bytesleft]</div>
<div class="pre"><a id="l1682" href="#l1682" class="linenr">1682</a> .not_all:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;[si+file_bytesleft],ecx</div>
<div class="pre"><a id="l1683" href="#l1683" class="linenr">1683</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;.ret&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;CF&nbsp;=&nbsp;0&nbsp;in&nbsp;this&nbsp;case...</div>
<div class="pre"><a id="l1684" href="#l1684" class="linenr">1684</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;eax</div>
<div class="pre"><a id="l1685" href="#l1685" class="linenr">1685</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;eax,eax</div>
<div class="pre"><a id="l1686" href="#l1686" class="linenr">1686</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;[si+file_sector],eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Unused</div>
<div class="pre"><a id="l1687" href="#l1687" class="linenr">1687</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;si,ax</div>
<div class="pre"><a id="l1688" href="#l1688" class="linenr">1688</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;eax</div>
<div class="pre"><a id="l1689" href="#l1689" class="linenr">1689</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stc</div>
<div class="pre"><a id="l1690" href="#l1690" class="linenr">1690</a> .ret:</div>
<div class="pre"><a id="l1691" href="#l1691" class="linenr">1691</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop&nbsp;ds</div>
<div class="pre"><a id="l1692" href="#l1692" class="linenr">1692</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRACER&nbsp;&#39;f&#39;</div>
<div class="pre"><a id="l1693" href="#l1693" class="linenr">1693</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</div>
<div class="pre"><a id="l1694" href="#l1694" class="linenr">1694</a> </div>
<div class="pre"><a id="l1695" href="#l1695" class="linenr">1695</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1696" href="#l1696" class="linenr">1696</a> ;&nbsp;&nbsp;Common&nbsp;modules</div>
<div class="pre"><a id="l1697" href="#l1697" class="linenr">1697</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1698" href="#l1698" class="linenr">1698</a> </div>
<div class="pre"><a id="l1699" href="#l1699" class="linenr">1699</a> %include&nbsp;&quot;getc.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;getc&nbsp;et&nbsp;al</div>
<div class="pre"><a id="l1700" href="#l1700" class="linenr">1700</a> %include&nbsp;&quot;conio.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Console&nbsp;I/O</div>
<div class="pre"><a id="l1701" href="#l1701" class="linenr">1701</a> %include&nbsp;&quot;configinit.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Initialize&nbsp;configuration</div>
<div class="pre"><a id="l1702" href="#l1702" class="linenr">1702</a> %include&nbsp;&quot;parseconfig.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;High-level&nbsp;config&nbsp;file&nbsp;handling</div>
<div class="pre"><a id="l1703" href="#l1703" class="linenr">1703</a> %include&nbsp;&quot;parsecmd.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Low-level&nbsp;config&nbsp;file&nbsp;handling</div>
<div class="pre"><a id="l1704" href="#l1704" class="linenr">1704</a> %include&nbsp;&quot;bcopy32.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;32-bit&nbsp;bcopy</div>
<div class="pre"><a id="l1705" href="#l1705" class="linenr">1705</a> %include&nbsp;&quot;loadhigh.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load&nbsp;a&nbsp;file&nbsp;into&nbsp;high&nbsp;memory</div>
<div class="pre"><a id="l1706" href="#l1706" class="linenr">1706</a> %include&nbsp;&quot;font.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;VGA&nbsp;font&nbsp;stuff</div>
<div class="pre"><a id="l1707" href="#l1707" class="linenr">1707</a> %include&nbsp;&quot;graphics.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;VGA&nbsp;graphics</div>
<div class="pre"><a id="l1708" href="#l1708" class="linenr">1708</a> %include&nbsp;&quot;highmem.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;High&nbsp;memory&nbsp;sizing</div>
<div class="pre"><a id="l1709" href="#l1709" class="linenr">1709</a> %include&nbsp;&quot;strcpy.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;strcpy()</div>
<div class="pre"><a id="l1710" href="#l1710" class="linenr">1710</a> %include&nbsp;&quot;rawcon.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Console&nbsp;I/O&nbsp;w/o&nbsp;using&nbsp;the&nbsp;console&nbsp;functions</div>
<div class="pre"><a id="l1711" href="#l1711" class="linenr">1711</a> %include&nbsp;&quot;idle.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Idle&nbsp;handling</div>
<div class="pre"><a id="l1712" href="#l1712" class="linenr">1712</a> %include&nbsp;&quot;adv.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Auxillary&nbsp;Data&nbsp;Vector</div>
<div class="pre"><a id="l1713" href="#l1713" class="linenr">1713</a> %include&nbsp;&quot;localboot.inc&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Disk-based&nbsp;local&nbsp;boot</div>
<div class="pre"><a id="l1714" href="#l1714" class="linenr">1714</a> </div>
<div class="pre"><a id="l1715" href="#l1715" class="linenr">1715</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1716" href="#l1716" class="linenr">1716</a> ;&nbsp;&nbsp;Begin&nbsp;data&nbsp;section</div>
<div class="pre"><a id="l1717" href="#l1717" class="linenr">1717</a> ;&nbsp;-----------------------------------------------------------------------------</div>
<div class="pre"><a id="l1718" href="#l1718" class="linenr">1718</a> </div>
<div class="pre"><a id="l1719" href="#l1719" class="linenr">1719</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;section&nbsp;.data</div>
<div class="pre"><a id="l1720" href="#l1720" class="linenr">1720</a> </div>
<div class="pre"><a id="l1721" href="#l1721" class="linenr">1721</a> default_str&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;default&#39;,&nbsp;0</div>
<div class="pre"><a id="l1722" href="#l1722" class="linenr">1722</a> default_len&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equ&nbsp;($-default_str)</div>
<div class="pre"><a id="l1723" href="#l1723" class="linenr">1723</a> boot_dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;/boot&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;/boot/isolinux</div>
<div class="pre"><a id="l1724" href="#l1724" class="linenr">1724</a> isolinux_dir&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;/isolinux&#39;,&nbsp;0</div>
<div class="pre"><a id="l1725" href="#l1725" class="linenr">1725</a> config_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;isolinux.cfg&#39;,&nbsp;0</div>
<div class="pre"><a id="l1726" href="#l1726" class="linenr">1726</a> err_disk_image&nbsp;&nbsp;db&nbsp;&#39;Cannot&nbsp;load&nbsp;disk&nbsp;image&nbsp;(invalid&nbsp;file)?&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1727" href="#l1727" class="linenr">1727</a> </div>
<div class="pre"><a id="l1728" href="#l1728" class="linenr">1728</a> %ifdef&nbsp;DEBUG_MESSAGES</div>
<div class="pre"><a id="l1729" href="#l1729" class="linenr">1729</a> dbg_rootdir_msg&nbsp;db&nbsp;&#39;Root&nbsp;directory&nbsp;at&nbsp;LBA&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1730" href="#l1730" class="linenr">1730</a> dbg_isodir_msg&nbsp;&nbsp;db&nbsp;&#39;isolinux&nbsp;directory&nbsp;at&nbsp;LBA&nbsp;=&nbsp;&#39;,&nbsp;0</div>
<div class="pre"><a id="l1731" href="#l1731" class="linenr">1731</a> dbg_config_msg&nbsp;&nbsp;db&nbsp;&#39;About&nbsp;to&nbsp;load&nbsp;config&nbsp;file...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1732" href="#l1732" class="linenr">1732</a> dbg_configok_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;Configuration&nbsp;file&nbsp;opened...&#39;,&nbsp;CR,&nbsp;LF,&nbsp;0</div>
<div class="pre"><a id="l1733" href="#l1733" class="linenr">1733</a> %endif</div>
<div class="pre"><a id="l1734" href="#l1734" class="linenr">1734</a> </div>
<div class="pre"><a id="l1735" href="#l1735" class="linenr">1735</a> ;</div>
<div class="pre"><a id="l1736" href="#l1736" class="linenr">1736</a> ;&nbsp;Config&nbsp;file&nbsp;keyword&nbsp;table</div>
<div class="pre"><a id="l1737" href="#l1737" class="linenr">1737</a> ;</div>
<div class="pre"><a id="l1738" href="#l1738" class="linenr">1738</a> %include&nbsp;&quot;keywords.inc&quot;</div>
<div class="pre"><a id="l1739" href="#l1739" class="linenr">1739</a> </div>
<div class="pre"><a id="l1740" href="#l1740" class="linenr">1740</a> ;</div>
<div class="pre"><a id="l1741" href="#l1741" class="linenr">1741</a> ;&nbsp;Extensions&nbsp;to&nbsp;search&nbsp;for&nbsp;(in&nbsp;*forward*&nbsp;order).</div>
<div class="pre"><a id="l1742" href="#l1742" class="linenr">1742</a> ;</div>
<div class="pre"><a id="l1743" href="#l1743" class="linenr">1743</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignz&nbsp;4</div>
<div class="pre"><a id="l1744" href="#l1744" class="linenr">1744</a> exten_table:&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;.cbt&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;COMBOOT&nbsp;(specific)</div>
<div class="pre"><a id="l1745" href="#l1745" class="linenr">1745</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;.img&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Disk&nbsp;image</div>
<div class="pre"><a id="l1746" href="#l1746" class="linenr">1746</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;.bin&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;CD&nbsp;boot&nbsp;sector</div>
<div class="pre"><a id="l1747" href="#l1747" class="linenr">1747</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;.com&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;COMBOOT&nbsp;(same&nbsp;as&nbsp;DOS)</div>
<div class="pre"><a id="l1748" href="#l1748" class="linenr">1748</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;&#39;.c32&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;COM32</div>
<div class="pre"><a id="l1749" href="#l1749" class="linenr">1749</a> exten_table_end:</div>
<div class="pre"><a id="l1750" href="#l1750" class="linenr">1750</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;0,&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Need&nbsp;8&nbsp;null&nbsp;bytes&nbsp;here</div>
<div class="pre"><a id="l1751" href="#l1751" class="linenr">1751</a> </div>
<div class="pre"><a id="l1752" href="#l1752" class="linenr">1752</a> ;</div>
<div class="pre"><a id="l1753" href="#l1753" class="linenr">1753</a> ;&nbsp;Floppy&nbsp;image&nbsp;table</div>
<div class="pre"><a id="l1754" href="#l1754" class="linenr">1754</a> ;</div>
<div class="pre"><a id="l1755" href="#l1755" class="linenr">1755</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignz&nbsp;4</div>
<div class="pre"><a id="l1756" href="#l1756" class="linenr">1756</a> img_table_count&nbsp;equ&nbsp;3</div>
<div class="pre"><a id="l1757" href="#l1757" class="linenr">1757</a> img_table:</div>
<div class="pre"><a id="l1758" href="#l1758" class="linenr">1758</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;1200*1024&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;1200K&nbsp;floppy</div>
<div class="pre"><a id="l1759" href="#l1759" class="linenr">1759</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Emulation&nbsp;type</div>
<div class="pre"><a id="l1760" href="#l1760" class="linenr">1760</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;80-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;cylinder</div>
<div class="pre"><a id="l1761" href="#l1761" class="linenr">1761</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;sector</div>
<div class="pre"><a id="l1762" href="#l1762" class="linenr">1762</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;2-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;head</div>
<div class="pre"><a id="l1763" href="#l1763" class="linenr">1763</a> </div>
<div class="pre"><a id="l1764" href="#l1764" class="linenr">1764</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;1440*1024&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;1440K&nbsp;floppy</div>
<div class="pre"><a id="l1765" href="#l1765" class="linenr">1765</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Emulation&nbsp;type</div>
<div class="pre"><a id="l1766" href="#l1766" class="linenr">1766</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;80-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;cylinder</div>
<div class="pre"><a id="l1767" href="#l1767" class="linenr">1767</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;sector</div>
<div class="pre"><a id="l1768" href="#l1768" class="linenr">1768</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;2-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;head</div>
<div class="pre"><a id="l1769" href="#l1769" class="linenr">1769</a> </div>
<div class="pre"><a id="l1770" href="#l1770" class="linenr">1770</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dd&nbsp;2880*1024&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;2880K&nbsp;floppy</div>
<div class="pre"><a id="l1771" href="#l1771" class="linenr">1771</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Emulation&nbsp;type</div>
<div class="pre"><a id="l1772" href="#l1772" class="linenr">1772</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;80-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;cylinder</div>
<div class="pre"><a id="l1773" href="#l1773" class="linenr">1773</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;sector</div>
<div class="pre"><a id="l1774" href="#l1774" class="linenr">1774</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;db&nbsp;2-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Max&nbsp;head</div>
<div class="pre"><a id="l1775" href="#l1775" class="linenr">1775</a> </div>
<div class="pre"><a id="l1776" href="#l1776" class="linenr">1776</a> ;</div>
<div class="pre"><a id="l1777" href="#l1777" class="linenr">1777</a> ;&nbsp;Misc&nbsp;initialized&nbsp;(data)&nbsp;variables</div>
<div class="pre"><a id="l1778" href="#l1778" class="linenr">1778</a> ;</div>
<div class="pre"><a id="l1779" href="#l1779" class="linenr">1779</a> </div>
<div class="pre"><a id="l1780" href="#l1780" class="linenr">1780</a> ;</div>
<div class="pre"><a id="l1781" href="#l1781" class="linenr">1781</a> ;&nbsp;Variables&nbsp;that&nbsp;are&nbsp;uninitialized&nbsp;in&nbsp;SYSLINUX&nbsp;but&nbsp;initialized&nbsp;here</div>
<div class="pre"><a id="l1782" href="#l1782" class="linenr">1782</a> ;</div>
<div class="pre"><a id="l1783" href="#l1783" class="linenr">1783</a> ;&nbsp;****&nbsp;ISOLINUX::&nbsp;We&nbsp;may&nbsp;have&nbsp;to&nbsp;make&nbsp;this&nbsp;flexible,&nbsp;based&nbsp;on&nbsp;what&nbsp;the</div>
<div class="pre"><a id="l1784" href="#l1784" class="linenr">1784</a> ;&nbsp;****&nbsp;BIOS&nbsp;expects&nbsp;our&nbsp;&quot;sector&nbsp;size&quot;&nbsp;to&nbsp;be.</div>
<div class="pre"><a id="l1785" href="#l1785" class="linenr">1785</a> ;</div>
<div class="pre"><a id="l1786" href="#l1786" class="linenr">1786</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alignz&nbsp;4</div>
<div class="pre"><a id="l1787" href="#l1787" class="linenr">1787</a> BufSafe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dw&nbsp;trackbufsize/SECTOR_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Clusters&nbsp;we&nbsp;can&nbsp;load&nbsp;into&nbsp;trackbuf</div>
<div class="pre"><a id="l1788" href="#l1788" class="linenr">1788</a> BufSafeBytes&nbsp;&nbsp;&nbsp;&nbsp;dw&nbsp;trackbufsize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;=&nbsp;how&nbsp;many&nbsp;bytes?</div>
<div class="pre"><a id="l1789" href="#l1789" class="linenr">1789</a> %ifndef&nbsp;DEPEND</div>
<div class="pre"><a id="l1790" href="#l1790" class="linenr">1790</a> %if&nbsp;(&nbsp;trackbufsize&nbsp;%&nbsp;SECTOR_SIZE&nbsp;)&nbsp;!=&nbsp;0</div>
<div class="pre"><a id="l1791" href="#l1791" class="linenr">1791</a> %error&nbsp;trackbufsize&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;SECTOR_SIZE</div>
<div class="pre"><a id="l1792" href="#l1792" class="linenr">1792</a> %endif</div>
<div class="pre"><a id="l1793" href="#l1793" class="linenr">1793</a> %endif</div>
</div><div class="page_footer">
<div class="page_footer_text">The Syslinux boot loader suite</div>
<a class="rss_logo" href="/?p=boot/syslinux/syslinux.git;a=rss">RSS</a> <a class="rss_logo" href="/?p=boot/syslinux/syslinux.git;a=atom">Atom</a>
</div>
</body>
</html>